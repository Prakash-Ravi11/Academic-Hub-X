<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Academic Hub X - Complete Academic File Management PWA</title>
  <link rel="manifest" href="data:application/json,{%22name%22:%22Academic%20Hub%20X%22,%22short_name%22:%22AHX%22,%22start_url%22:%22./%22,%22display%22:%22standalone%22,%22background_color%22:%22%23ffffff%22,%22theme_color%22:%22%23007AFF%22,%22icons%22:[{%22src%22:%22data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==%22,%22sizes%22:%22192x192%22,%22type%22:%22image/png%22}]}">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎓</text></svg>">
  <meta name="theme-color" content="#007AFF">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>
  <style>
    /* =================== APPLE-STYLE DESIGN SYSTEM =================== */
    :root {
      --sf-pro: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, system-ui, sans-serif;
      --primary: #007AFF;
      --primary-dark: #0056CC;
      --success: #34C759;
      --warning: #FF9500;
      --danger: #FF3B30;
      --gray-50: #F9F9F9;
      --gray-100: #F2F2F7;
      --gray-200: #E5E5EA;
      --gray-300: #D1D1D6;
      --gray-400: #C7C7CC;
      --gray-500: #8E8E93;
      --gray-600: #6D6D70;
      --gray-700: #48484A;
      --gray-800: #1C1C1E;
      --gray-900: #000000;
      --blur: blur(20px);
      --shadow-light: 0 1px 3px rgba(0,0,0,0.1);
      --shadow-medium: 0 4px 20px rgba(0,0,0,0.15);
      --shadow-heavy: 0 16px 60px rgba(0,0,0,0.3);
      --radius-small: 6px;
      --radius-medium: 12px;
      --radius-large: 20px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    * {
      box-sizing: border-box;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    body {
      font-family: var(--sf-pro);
      margin: 0;
      padding: 0;
      background: var(--gray-50);
      min-height: 100vh;
      line-height: 1.6;
      color: var(--gray-800);
    }

    /* =================== LOADING SCREEN =================== */
    .loading-screen {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, var(--primary) 0%, #667eea 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      color: white;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .loading-logo {
      font-size: 4rem;
      margin-bottom: 2rem;
      animation: logoFloat 3s ease-in-out infinite;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255,255,255,0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 2rem;
    }

    .loading-text {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 1rem;
      animation: textPulse 2s ease-in-out infinite;
    }

    .loading-progress {
      width: 300px;
      height: 4px;
      background: rgba(255,255,255,0.3);
      border-radius: 2px;
      overflow: hidden;
      margin-bottom: 1rem;
    }

    .loading-progress-bar {
      height: 100%;
      background: white;
      width: 0%;
      border-radius: 2px;
      animation: progressLoad 3s ease-out;
    }

    .loading-steps {
      text-align: center;
      opacity: 0.8;
      font-size: 0.9rem;
    }

    @keyframes logoFloat {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes textPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    @keyframes progressLoad {
      0% { width: 0%; }
      25% { width: 30%; }
      50% { width: 60%; }
      75% { width: 85%; }
      100% { width: 100%; }
    }

    /* =================== LANDING PAGE =================== */
    .landing-hero {
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      position: relative;
      overflow: hidden;
    }

    .floating-shapes {
      position: absolute;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: 0;
    }

    .shape {
      position: absolute;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      backdrop-filter: var(--blur);
      animation: float 6s ease-in-out infinite;
    }

    .shape:nth-child(1) { 
      width: 80px; height: 80px; 
      top: 10%; left: 10%; 
      animation-delay: 0s; 
    }
    .shape:nth-child(2) { 
      width: 120px; height: 120px; 
      top: 70%; left: 80%; 
      animation-delay: 2s; 
    }
    .shape:nth-child(3) { 
      width: 60px; height: 60px; 
      top: 40%; right: 10%; 
      animation-delay: 4s; 
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(180deg); }
    }

    .hero-content {
      text-align: center;
      max-width: 800px;
      padding: 2rem;
      position: relative;
      z-index: 2;
    }

    .hero-title {
      font-size: clamp(3rem, 8vw, 5rem);
      font-weight: 700;
      margin-bottom: 1.5rem;
      background: linear-gradient(45deg, white, rgba(255,255,255,0.8));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: titleSlide 1s ease-out;
    }

    .hero-subtitle {
      font-size: 1.3rem;
      margin-bottom: 3rem;
      opacity: 0.9;
      line-height: 1.6;
      animation: subtitleFade 1s ease-out 0.3s both;
    }

    .cta-container {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      animation: ctaSlide 1s ease-out 0.6s both;
    }

    @keyframes titleSlide {
      from { opacity: 0; transform: translateY(50px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes subtitleFade {
      from { opacity: 0; }
      to { opacity: 0.9; }
    }

    @keyframes ctaSlide {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* =================== BUTTONS =================== */
    .btn {
      padding: 1rem 2rem;
      border-radius: var(--radius-medium);
      font-weight: 600;
      text-decoration: none;
      transition: var(--transition);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1rem;
      border: none;
      font-family: inherit;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
      box-shadow: var(--shadow-medium);
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: var(--shadow-heavy);
    }

    .btn-secondary {
      background: rgba(255,255,255,0.15);
      color: white;
      backdrop-filter: var(--blur);
      border: 1px solid rgba(255,255,255,0.2);
    }

    .btn-secondary:hover {
      background: rgba(255,255,255,0.25);
      transform: translateY(-2px);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      background: #e63946;
      transform: translateY(-1px);
    }

    /* =================== AUTHENTICATION MODAL =================== */
    .auth-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      backdrop-filter: var(--blur);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .auth-modal.active {
      opacity: 1;
      visibility: visible;
    }

    .auth-panel {
      background: white;
      border-radius: var(--radius-large);
      padding: 2.5rem;
      max-width: 420px;
      width: calc(100% - 2rem);
      box-shadow: var(--shadow-heavy);
      transform: translateY(20px) scale(0.95);
      transition: transform 0.3s var(--spring);
      position: relative;
    }

    .auth-modal.active .auth-panel {
      transform: translateY(0) scale(1);
    }

    .close-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--gray-500);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: var(--transition);
    }

    .close-btn:hover {
      background: var(--gray-100);
    }

    .auth-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .auth-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--gray-900);
      margin-bottom: 0.5rem;
    }

    .auth-subtitle {
      color: var(--gray-500);
      font-size: 1rem;
    }

    .auth-tabs {
      display: flex;
      background: var(--gray-100);
      border-radius: var(--radius-medium);
      padding: 4px;
      margin-bottom: 2rem;
    }

    .auth-tab {
      flex: 1;
      padding: 0.75rem;
      border-radius: var(--radius-small);
      background: transparent;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      color: var(--gray-500);
      font-family: inherit;
    }

    .auth-tab.active {
      background: white;
      color: var(--primary);
      box-shadow: var(--shadow-light);
    }

    /* =================== FORMS =================== */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      font-weight: 600;
      color: var(--gray-700);
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }

    .form-input {
      width: 100%;
      padding: 1rem;
      border: 2px solid var(--gray-200);
      border-radius: var(--radius-medium);
      font-size: 1rem;
      transition: var(--transition);
      background: white;
      font-family: inherit;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }

    .form-button {
      width: 100%;
      padding: 1rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: var(--radius-medium);
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-family: inherit;
    }

    .form-button:hover {
      background: var(--primary-dark);
    }

    .form-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* =================== DASHBOARD LAYOUT =================== */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 280px 1fr;
      min-height: 100vh;
      gap: 0;
    }

    @media (max-width: 768px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      .sidebar {
        display: none !important;
      }
    }

    .sidebar {
      background: linear-gradient(180deg, var(--gray-900) 0%, var(--gray-800) 100%);
      color: white;
      padding: 2rem 1rem;
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .brand {
      width: 40px;
      height: 40px;
      background: var(--primary);
      border-radius: var(--radius-medium);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: white;
      font-size: 1.2rem;
    }

    .brand-text {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      border-radius: var(--radius-medium);
      color: rgba(255,255,255,0.7);
      text-decoration: none;
      transition: var(--transition);
      margin-bottom: 0.5rem;
      cursor: pointer;
    }

    .nav-item:hover, .nav-item.active {
      background: rgba(255,255,255,0.1);
      color: white;
      transform: translateX(8px);
    }

    .nav-icon {
      font-size: 1.2rem;
      width: 24px;
      text-align: center;
    }

    /* =================== MAIN CONTENT =================== */
    .main-content {
      background: var(--gray-50);
      padding: 2rem;
      overflow-y: auto;
      max-height: 100vh;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .header-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--gray-900);
      margin: 0;
    }

    .header-subtitle {
      color: var(--gray-500);
      margin: 0.5rem 0 0 0;
      font-size: 1.1rem;
    }

    .header-actions {
      display: flex;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
    }

    /* =================== STATS GRID =================== */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: white;
      padding: 2rem;
      border-radius: var(--radius-large);
      box-shadow: var(--shadow-light);
      border: 1px solid var(--gray-200);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--primary-dark));
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-medium);
    }

    .stat-card:hover::before {
      transform: scaleX(1);
    }

    .stat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-medium);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      background: linear-gradient(45deg, var(--primary), var(--primary-dark));
      color: white;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--gray-900);
      margin-bottom: 0.5rem;
    }

    .stat-label {
      color: var(--gray-500);
      font-size: 0.9rem;
    }

    /* =================== CONTENT GRID =================== */
    .content-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 2rem;
    }

    @media (max-width: 1024px) {
      .content-grid {
        grid-template-columns: 1fr;
      }
    }

    /* =================== CARDS =================== */
    .card {
      background: white;
      border-radius: var(--radius-large);
      padding: 2rem;
      box-shadow: var(--shadow-light);
      border: 1px solid var(--gray-200);
      transition: var(--transition);
    }

    .card:hover {
      box-shadow: var(--shadow-medium);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--gray-200);
    }

    .card-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--gray-900);
      margin: 0;
    }

    /* =================== FILE SYSTEM =================== */
    .file-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      border-radius: var(--radius-medium);
      transition: var(--transition);
      cursor: pointer;
      margin-bottom: 0.5rem;
    }

    .file-item:hover {
      background: var(--gray-100);
      transform: translateX(4px);
    }

    .file-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-small);
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(45deg, #06b6d4, #0891b2);
      color: white;
      font-size: 1.2rem;
    }

    .file-info {
      flex: 1;
    }

    .file-name {
      font-weight: 600;
      color: var(--gray-900);
      margin-bottom: 0.25rem;
    }

    .file-meta {
      font-size: 0.8rem;
      color: var(--gray-500);
    }

    /* =================== QUICK ACTIONS =================== */
    .action-btn {
      display: flex;
      align-items: center;
      gap: 1rem;
      width: 100%;
      padding: 1rem;
      border-radius: var(--radius-medium);
      background: transparent;
      border: 1px solid var(--gray-200);
      text-align: left;
      transition: var(--transition);
      margin-bottom: 0.75rem;
      cursor: pointer;
      font-family: inherit;
    }

    .action-btn:hover {
      background: var(--gray-50);
      border-color: var(--primary);
      transform: translateY(-2px);
    }

    /* =================== FLOATING ACTION BUTTON =================== */
    .fab {
      position: fixed;
      right: 2rem;
      bottom: 2rem;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: var(--shadow-heavy);
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .fab:hover {
      transform: scale(1.1);
      background: var(--primary-dark);
    }

    /* =================== MODALS =================== */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      backdrop-filter: var(--blur);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-panel {
      background: white;
      border-radius: var(--radius-large);
      padding: 2rem;
      max-width: 500px;
      width: calc(100% - 2rem);
      box-shadow: var(--shadow-heavy);
      transform: translateY(20px) scale(0.95);
      transition: transform 0.3s var(--spring);
    }

    .modal.active .modal-panel {
      transform: translateY(0) scale(1);
    }

    /* =================== DRAG AND DROP =================== */
    .drop-zone {
      border: 2px dashed var(--gray-300);
      border-radius: var(--radius-medium);
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
      background: var(--gray-50);
    }

    .drop-zone:hover {
      border-color: var(--primary);
      background: rgba(0, 122, 255, 0.05);
    }

    .drop-zone.drag-over {
      border-color: var(--primary);
      background: rgba(0, 122, 255, 0.1);
    }

    /* =================== NOTIFICATIONS =================== */
    .notification {
      position: fixed;
      top: 2rem;
      right: 2rem;
      background: white;
      padding: 1rem 1.5rem;
      border-radius: var(--radius-medium);
      box-shadow: var(--shadow-heavy);
      border-left: 4px solid var(--primary);
      z-index: 2000;
      transform: translateX(100%);
      transition: transform 0.3s var(--spring);
      max-width: 400px;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.error {
      border-left-color: var(--danger);
    }

    .notification.success {
      border-left-color: var(--success);
    }

    .notification.warning {
      border-left-color: var(--warning);
    }

    /* =================== LOADING STATES =================== */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      color: var(--gray-500);
    }

    .spinner {
      width: 32px;
      height: 32px;
      border: 3px solid var(--gray-200);
      border-top: 3px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 1rem;
    }

    /* =================== EMPTY STATES =================== */
    .empty-state {
      text-align: center;
      padding: 3rem 2rem;
      color: var(--gray-500);
    }

    .empty-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    /* =================== ERROR STATES =================== */
    .error-state {
      text-align: center;
      padding: 3rem 2rem;
      color: var(--danger);
    }

    .error-message {
      background: #FFE6E6;
      color: var(--danger);
      padding: 1rem;
      border-radius: var(--radius-medium);
      margin-bottom: 1rem;
      font-size: 0.9rem;
      border-left: 4px solid var(--danger);
    }

    .success-message {
      background: #E6F7E6;
      color: var(--success);
      padding: 1rem;
      border-radius: var(--radius-medium);
      margin-bottom: 1rem;
      font-size: 0.9rem;
      border-left: 4px solid var(--success);
    }

    /* =================== RESPONSIVE =================== */
    @media (max-width: 768px) {
      .hero-title {
        font-size: 2.5rem;
      }
      
      .hero-subtitle {
        font-size: 1.1rem;
      }
      
      .cta-container {
        flex-direction: column;
        align-items: center;
      }
      
      .btn {
        width: 100%;
        max-width: 280px;
      }
      
      .auth-panel {
        padding: 2rem;
        margin: 1rem;
      }

      .header {
        flex-direction: column;
        align-items: flex-start;
      }

      .main-content {
        padding: 1rem;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }
    }

    /* =================== UTILITIES =================== */
    .hidden { display: none !important; }
    .fade-in { animation: fadeIn 0.5s ease-out; }
    .slide-up { animation: slideUp 0.5s ease-out; }
    .bounce-in { animation: bounceIn 0.6s ease-out; }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes bounceIn {
      0% { opacity: 0; transform: scale(0.3); }
      50% { opacity: 1; transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { opacity: 1; transform: scale(1); }
    }

    /* =================== DARK MODE SUPPORT =================== */
    @media (prefers-color-scheme: dark) {
      :root {
        --gray-50: #1C1C1E;
        --gray-100: #2C2C2E;
        --gray-200: #3A3A3C;
        --gray-800: #F2F2F7;
        --gray-900: #FFFFFF;
      }
    }
  </style>
</head>
<body>
  <!-- =================== LOADING SCREEN =================== -->
  <div id="loadingScreen" class="loading-screen">
    <div class="loading-logo">🎓</div>
    <div class="loading-spinner"></div>
    <div class="loading-text" id="loadingText">Initializing Academic Hub X...</div>
    <div class="loading-progress">
      <div class="loading-progress-bar"></div>
    </div>
    <div class="loading-steps" id="loadingSteps">Starting application...</div>
  </div>

  <!-- =================== LANDING PAGE =================== -->
  <div id="landingPage" class="landing-hero hidden">
    <div class="floating-shapes">
      <div class="shape"></div>
      <div class="shape"></div>
      <div class="shape"></div>
    </div>
    
    <div class="hero-content">
      <h1 class="hero-title">Academic Hub X</h1>
      <p class="hero-subtitle">
        The future of academic file management. Organize, sync, and access your study materials with intelligent categorization and seamless collaboration.
      </p>
      <div class="cta-container">
        <button class="btn btn-primary" onclick="openAuth()">
          Get Started Free
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8-8-8z"/>
          </svg>
        </button>
        <button class="btn btn-secondary" onclick="showFeatures()">
          Learn More
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
            <path d="M7 10l5 5 5-5z"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- =================== AUTHENTICATION MODAL =================== -->
  <div id="authModal" class="auth-modal">
    <div class="auth-panel">
      <button class="close-btn" onclick="closeAuth()">×</button>
      
      <div class="auth-header">
        <h2 class="auth-title">Welcome to Academic Hub X</h2>
        <p class="auth-subtitle">Sign in to access your academic files</p>
      </div>

      <div class="auth-tabs">
        <button class="auth-tab active" onclick="switchAuthTab('signin')">Sign In</button>
        <button class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</button>
      </div>

      <div id="authError" class="error-message hidden"></div>
      <div id="authSuccess" class="success-message hidden"></div>

      <!-- Sign In Form -->
      <form id="signinForm" onsubmit="handleSignIn(event)">
        <div class="form-group">
          <label class="form-label">Email Address</label>
          <input type="email" class="form-input" id="signin-email" placeholder="Enter your email" required>
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-input" id="signin-password" placeholder="Enter your password" required>
        </div>
        <button type="submit" class="form-button" id="signinBtn">
          <span>Sign In</span>
        </button>
      </form>

      <!-- Sign Up Form -->
      <form id="signupForm" class="hidden" onsubmit="handleSignUp(event)">
        <div class="form-group">
          <label class="form-label">Full Name</label>
          <input type="text" class="form-input" id="signup-name" placeholder="Enter your full name" required>
        </div>
        <div class="form-group">
          <label class="form-label">Email Address</label>
          <input type="email" class="form-input" id="signup-email" placeholder="Enter your email" required>
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-input" id="signup-password" placeholder="Create a password" required minlength="6">
        </div>
        <button type="submit" class="form-button" id="signupBtn">
          <span>Create Account</span>
        </button>
      </form>
    </div>
  </div>

  <!-- =================== MAIN APPLICATION =================== -->
  <div id="app" class="hidden">
    <div class="dashboard-grid">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <div class="brand">🎓</div>
          <div>
            <div class="brand-text">Academic Hub X</div>
            <div style="font-size: 0.8rem; opacity: 0.6;">Dashboard</div>
          </div>
        </div>
        
        <nav class="sidebar-nav">
          <div class="nav-item active" onclick="navigateTo('dashboard')">
            <span class="nav-icon">🏠</span>
            <span>Dashboard</span>
          </div>
          <div class="nav-item" onclick="navigateTo('subjects')">
            <span class="nav-icon">📚</span>
            <span>Subjects</span>
          </div>
          <div class="nav-item" onclick="navigateTo('files')">
            <span class="nav-icon">📄</span>
            <span>All Files</span>
          </div>
          <div class="nav-item" onclick="navigateTo('search')">
            <span class="nav-icon">🔍</span>
            <span>Search</span>
          </div>
          <div class="nav-item" onclick="navigateTo('qr')">
            <span class="nav-icon">📷</span>
            <span>QR Scanner</span>
          </div>
          <div class="nav-item" onclick="navigateTo('settings')">
            <span class="nav-icon">⚙️</span>
            <span>Settings</span>
          </div>
        </nav>
        
        <div style="margin-top: auto; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1);">
          <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: var(--radius-medium);">
            <div style="width: 32px; height: 32px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;">
              U
            </div>
            <div style="flex: 1;">
              <div id="sidebarUserName" style="font-weight: 600; font-size: 0.9rem;">User</div>
              <div style="font-size: 0.7rem; opacity: 0.6;">Premium Plan</div>
            </div>
          </div>
        </div>
      </aside>
      
      <!-- Main Content Area -->
      <main class="main-content">
        <div id="viewContent">
          <!-- Dynamic content will be loaded here -->
        </div>
      </main>
    </div>
  </div>
  
  <!-- =================== FLOATING ACTION BUTTON =================== -->
  <button id="fab" class="fab hidden" title="Upload Files" onclick="openUploadModal()">+</button>
  
  <!-- =================== UPLOAD MODAL =================== -->
  <div id="uploadModal" class="modal">
    <div class="modal-panel">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h3 style="margin: 0; font-size: 1.5rem; color: var(--gray-900);">Upload Files</h3>
        <button onclick="closeUploadModal()" class="close-btn">×</button>
      </div>
      
      <div style="display: grid; gap: 1.5rem;">
        <div>
          <label class="form-label">Subject</label>
          <select id="uploadSubject" class="form-input">
            <option value="">Select a subject...</option>
            <option value="math">Mathematics</option>
            <option value="science">Science</option>
            <option value="english">English</option>
            <option value="history">History</option>
            <option value="scanned">Scanned Notes</option>
          </select>
        </div>
        
        <div>
          <label class="form-label">Files</label>
          <div class="drop-zone" id="dropZone">
            <input type="file" id="uploadFiles" multiple accept=".pdf,.doc,.docx,.ppt,.pptx,.txt,.jpg,.png,.gif" style="display: none;">
            <div style="font-size: 2rem; margin-bottom: 1rem;">📁</div>
            <p style="margin: 0; color: var(--gray-600);">Drop files here or click to browse</p>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.8rem; color: var(--gray-500);">Supports PDF, DOC, PPT, images (max 50MB each)</p>
          </div>
        </div>
        
        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
          <button class="btn" onclick="closeUploadModal()">Cancel</button>
          <button class="btn btn-primary" onclick="uploadFiles()">Upload Files</button>
        </div>
      </div>
    </div>
  </div>

  <!-- =================== QR SCANNER MODAL =================== -->
  <div id="qrModal" class="modal">
    <div class="modal-panel">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h3 style="margin: 0; font-size: 1.5rem; color: var(--gray-900);">QR Code Scanner</h3>
        <button onclick="closeQRModal()" class="close-btn">×</button>
      </div>
      
      <p style="color: var(--gray-500); margin-bottom: 1rem; text-align: center;">Position the QR code within the frame to scan notes from your college</p>
      <div id="qr-reader" style="width: 100%; border-radius: var(--radius-medium); overflow: hidden; margin: 1rem 0;"></div>
      
      <button class="btn btn-primary" onclick="closeQRModal()" style="width: 100%;">Close Scanner</button>
    </div>
  </div>

  <script>
    // =================== CONFIGURATION ===================
    const SUPABASE_URL = 'https://yvlspahwnnzfctqqlmbu.supabase.co';
    const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl2bHNwYWh3bm56ZmN0cXFsbWJ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzNjQ4NzUsImV4cCI6MjA2OTk0MDg3NX0.5j6phM4WCe7XZo5xHdajwAShkV-hibECc_sp31JI6SQ';

    // =================== GLOBAL STATE ===================
    window.AHX = {
      state: {
        subjects: [
          { key: 'math', name: 'Mathematics', code: 'MATH', icon: '🔢' },
          { key: 'science', name: 'Science', code: 'SCI', icon: '🔬' },
          { key: 'english', name: 'English', code: 'ENG', icon: '📚' },
          { key: 'history', name: 'History', code: 'HIST', icon: '📜' },
          { key: 'scanned', name: 'Scanned Notes', code: 'SCAN', icon: '📷' }
        ],
        db: null,
        user: null,
        currentView: 'dashboard',
        files: [],
        isOnline: navigator.onLine
      }
    };

    let supabase = null;
    let qrScanner = null;

    // =================== INITIALIZATION ===================
    document.addEventListener('DOMContentLoaded', initializeApp);

    async function initializeApp() {
      console.log('🚀 Initializing Academic Hub X...');
      
      const loadingSteps = [
        'Loading core systems...',
        'Initializing database...',
        'Setting up authentication...',
        'Loading user interface...',
        'Ready to launch!'
      ];

      let currentStep = 0;
      const loadingText = document.getElementById('loadingText');
      const loadingSteps_el = document.getElementById('loadingSteps');

      const stepInterval = setInterval(() => {
        if (currentStep < loadingSteps.length) {
          loadingText.textContent = loadingSteps[currentStep];
          loadingSteps_el.textContent = loadingSteps[currentStep];
          currentStep++;
        } else {
          clearInterval(stepInterval);
        }
      }, 600);

      try {
        // Initialize Supabase
        await initializeSupabase();
        
        // Initialize IndexedDB
        await initializeDatabase();
        
        // Setup service worker
        await registerServiceWorker();
        
        // Check authentication
        const user = getCurrentUser();
        
        setTimeout(() => {
          document.getElementById('loadingScreen').style.opacity = '0';
          setTimeout(() => {
            document.getElementById('loadingScreen').style.display = 'none';
            
            if (user) {
              AHX.state.user = user;
              showApp();
            } else {
              showLanding();
            }
          }, 500);
        }, 3500);
        
      } catch (error) {
        console.error('❌ App initialization failed:', error);
        setTimeout(() => {
          document.getElementById('loadingScreen').style.display = 'none';
          showLanding();
        }, 2000);
      }
    }

    async function initializeSupabase() {
      try {
        if (typeof window.supabase !== 'undefined' && window.supabase.createClient) {
          supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON, {
            auth: {
              autoRefreshToken: true,
              persistSession: true,
              detectSessionInUrl: false
            }
          });
          console.log('✅ Supabase initialized');
        } else {
          console.warn('⚠️ Supabase SDK not loaded');
        }
      } catch (error) {
        console.warn('⚠️ Supabase initialization failed:', error);
      }
    }

    async function initializeDatabase() {
      try {
        AHX.state.db = await openIndexedDB();
        console.log('✅ IndexedDB initialized');
      } catch (error) {
        console.warn('⚠️ IndexedDB initialization failed:', error);
      }
    }

    async function registerServiceWorker() {
      if ('serviceWorker' in navigator) {
        try {
          // Create an inline service worker for basic caching
          const swCode = `
            const CACHE_NAME = 'ahx-cache-v1';
            const urlsToCache = ['/'];
            
            self.addEventListener('install', event => {
              event.waitUntil(
                caches.open(CACHE_NAME).then(cache => cache.addAll(urlsToCache))
              );
            });
            
            self.addEventListener('fetch', event => {
              event.respondWith(
                caches.match(event.request).then(response => response || fetch(event.request))
              );
            });
          `;
          
          const blob = new Blob([swCode], { type: 'application/javascript' });
          const swURL = URL.createObjectURL(blob);
          
          await navigator.serviceWorker.register(swURL);
          console.log('✅ Service Worker registered');
        } catch (error) {
          console.warn('⚠️ Service Worker registration failed:', error);
        }
      }
    }

    // =================== DATABASE OPERATIONS ===================
    function openIndexedDB() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open('ahx_db', 1);
        
        request.onupgradeneeded = (event) => {
          const db = event.target.result;
          
          if (!db.objectStoreNames.contains('files')) {
            const store = db.createObjectStore('files', { keyPath: 'id' });
            store.createIndex('by_subject', 'subjectKey', { unique: false });
            store.createIndex('by_name', 'name', { unique: false });
          }
        };
        
        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
      });
    }

    async function addFiles(files) {
      if (!AHX.state.db) return [];
      
      const tx = AHX.state.db.transaction(['files'], 'readwrite');
      const store = tx.objectStore('files');
      
      const results = await Promise.all(files.map(file => {
        return new Promise((resolve, reject) => {
          const request = store.put(file);
          request.onsuccess = () => resolve(file);
          request.onerror = () => reject(request.error);
        });
      }));
      
      return results;
    }

    async function getAllFiles() {
      if (!AHX.state.db) return [];
      
      return new Promise((resolve) => {
        const results = [];
        const tx = AHX.state.db.transaction(['files'], 'readonly');
        const store = tx.objectStore('files');
        const request = store.openCursor();
        
        request.onsuccess = (event) => {
          const cursor = event.target.result;
          if (cursor) {
            results.push(cursor.value);
            cursor.continue();
          } else {
            resolve(results.sort((a, b) => b.addedAt - a.addedAt));
          }
        };
        
        request.onerror = () => resolve([]);
      });
    }

    async function getFilesBySubject(subjectKey) {
      const allFiles = await getAllFiles();
      return allFiles.filter(file => file.subjectKey === subjectKey);
    }

    async function deleteFile(id) {
      if (!AHX.state.db) return false;
      
      const tx = AHX.state.db.transaction(['files'], 'readwrite');
      const store = tx.objectStore('files');
      
      return new Promise((resolve) => {
        const request = store.delete(id);
        request.onsuccess = () => resolve(true);
        request.onerror = () => resolve(false);
      });
    }

    // =================== AUTHENTICATION ===================
    function getCurrentUser() {
      try {
        const raw = localStorage.getItem('ahx_user');
        return raw ? JSON.parse(raw) : null;
      } catch {
        return null;
      }
    }

    async function handleSignIn(event) {
      event.preventDefault();
      const email = document.getElementById('signin-email').value.trim();
      const password = document.getElementById('signin-password').value;
      const button = document.getElementById('signinBtn');
      
      button.disabled = true;
      button.querySelector('span').textContent = 'Signing in...';
      clearAuthMessages();
      
      try {
        // Demo login for testing
        if (email === 'demo@academichub.com' && password === 'demo123') {
          const user = { id: 'demo', email, name: 'Demo User' };
          localStorage.setItem('ahx_user', JSON.stringify(user));
          AHX.state.user = user;
          
          showAuthMessage('Welcome back! Redirecting...', 'success');
          setTimeout(() => {
            closeAuth();
            showApp();
          }, 1500);
          return;
        }
        
        if (!supabase) {
          throw new Error('Authentication service not available');
        }
        
        const { data, error } = await supabase.auth.signInWithPassword({
          email, password
        });
        
        if (error) throw error;
        
        if (data?.user) {
          const user = {
            id: data.user.id,
            email: data.user.email,
            name: data.user.user_metadata?.full_name || data.user.email.split('@')[0]
          };
          
          localStorage.setItem('ahx_user', JSON.stringify(user));
          AHX.state.user = user;
          
          showAuthMessage('Welcome back! Redirecting...', 'success');
          setTimeout(() => {
            closeAuth();
            showApp();
          }, 1500);
        }
        
      } catch (error) {
        console.error('Sign in error:', error);
        showAuthMessage(error.message || 'Sign in failed. Try demo@academichub.com / demo123', 'error');
      } finally {
        button.disabled = false;
        button.querySelector('span').textContent = 'Sign In';
      }
    }

    async function handleSignUp(event) {
      event.preventDefault();
      const name = document.getElementById('signup-name').value.trim();
      const email = document.getElementById('signup-email').value.trim();
      const password = document.getElementById('signup-password').value;
      const button = document.getElementById('signupBtn');
      
      button.disabled = true;
      button.querySelector('span').textContent = 'Creating account...';
      clearAuthMessages();
      
      try {
        if (!supabase) {
          throw new Error('Authentication service not available');
        }
        
        const { data, error } = await supabase.auth.signUp({
          email, password,
          options: { data: { full_name: name } }
        });
        
        if (error) throw error;
        
        showAuthMessage('Account created! Please check your email to verify.', 'success');
        setTimeout(() => switchAuthTab('signin'), 3000);
        
      } catch (error) {
        console.error('Sign up error:', error);
        showAuthMessage(error.message || 'Sign up failed. Please try again.', 'error');
      } finally {
        button.disabled = false;
        button.querySelector('span').textContent = 'Create Account';
      }
    }

    function signOut() {
      localStorage.removeItem('ahx_user');
      AHX.state.user = null;
      showLanding();
    }

    // =================== UI MANAGEMENT ===================
    function showLanding() {
      document.getElementById('landingPage').classList.remove('hidden');
      document.getElementById('app').classList.add('hidden');
      document.getElementById('fab').classList.add('hidden');
    }

    function showApp() {
      document.getElementById('landingPage').classList.add('hidden');
      document.getElementById('app').classList.remove('hidden');
      document.getElementById('fab').classList.remove('hidden');
      
      if (AHX.state.user) {
        document.getElementById('sidebarUserName').textContent = AHX.state.user.name;
      }
      
      renderView(AHX.state.currentView);
    }

    function openAuth() {
      document.getElementById('authModal').classList.add('active');
    }

    function closeAuth() {
      document.getElementById('authModal').classList.remove('active');
      clearAuthMessages();
    }

    function switchAuthTab(tab) {
      const signinForm = document.getElementById('signinForm');
      const signupForm = document.getElementById('signupForm');
      const signinTab = document.querySelector('.auth-tab');
      const signupTab = document.querySelector('.auth-tab:last-child');
      
      if (tab === 'signin') {
        signinTab.classList.add('active');
        signupTab.classList.remove('active');
        signinForm.classList.remove('hidden');
        signupForm.classList.add('hidden');
      } else {
        signinTab.classList.remove('active');
        signupTab.classList.add('active');
        signinForm.classList.add('hidden');
        signupForm.classList.remove('hidden');
      }
      
      clearAuthMessages();
    }

    function showAuthMessage(message, type) {
      const errorEl = document.getElementById('authError');
      const successEl = document.getElementById('authSuccess');
      
      if (type === 'error') {
        errorEl.textContent = message;
        errorEl.classList.remove('hidden');
        successEl.classList.add('hidden');
      } else {
        successEl.textContent = message;
        successEl.classList.remove('hidden');
        errorEl.classList.add('hidden');
      }
    }

    function clearAuthMessages() {
      document.getElementById('authError').classList.add('hidden');
      document.getElementById('authSuccess').classList.add('hidden');
    }

    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <div style="display: flex; align-items: center; justify-content: space-between;">
          <span>${message}</span>
          <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; font-size: 1.2rem; cursor: pointer; margin-left: 1rem;">×</button>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => notification.classList.add('show'), 100);
      
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
      }, 5000);
    }

    // =================== NAVIGATION ===================
    function navigateTo(view) {
      AHX.state.currentView = view;
      
      // Update navigation
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      event.currentTarget.classList.add('active');
      
      renderView(view);
    }

    async function renderView(view) {
      const content = document.getElementById('viewContent');
      content.innerHTML = '<div class="loading"><div class="spinner"></div>Loading...</div>';
      
      try {
        let html = '';
        
        switch (view) {
          case 'dashboard':
            html = await renderDashboard();
            break;
          case 'subjects':
            html = await renderSubjects();
            break;
          case 'files':
            html = await renderAllFiles();
            break;
          case 'search':
            html = renderSearch();
            break;
          case 'qr':
            html = renderQRScanner();
            break;
          case 'settings':
            html = await renderSettings();
            break;
          default:
            html = await renderDashboard();
        }
        
        content.innerHTML = html;
        content.classList.add('fade-in');
        
      } catch (error) {
        console.error('Render error:', error);
        content.innerHTML = `
          <div class="error-state">
            <div style="font-size: 3rem; margin-bottom: 1rem;">⚠️</div>
            <h2>Something went wrong</h2>
            <p>Please try refreshing the page</p>
            <button class="btn btn-primary" onclick="location.reload()">Refresh</button>
          </div>
        `;
      }
    }

    // =================== VIEW RENDERERS ===================
    async function renderDashboard() {
      const files = await getAllFiles();
      const recentFiles = files.slice(0, 5);
      const totalSize = files.reduce((sum, file) => sum + (file.size || 0), 0);
      
      return `
        <div class="header">
          <div>
            <h1 class="header-title">Dashboard</h1>
            <p class="header-subtitle">Welcome back, ${AHX.state.user?.name || 'User'}! Here's your academic overview.</p>
          </div>
          <div class="header-actions">
            <button class="btn" onclick="toggleTheme()">🌓</button>
            <button class="btn btn-primary" onclick="openUploadModal()">Upload Files</button>
          </div>
        </div>
        
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon">📁</div>
            </div>
            <div class="stat-value">${files.length}</div>
            <div class="stat-label">Total Files</div>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon">📚</div>
            </div>
            <div class="stat-value">${AHX.state.subjects.length}</div>
            <div class="stat-label">Subjects</div>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon">💾</div>
            </div>
            <div class="stat-value">${formatBytes(totalSize)}</div>
            <div class="stat-label">Storage Used</div>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon">📈</div>
            </div>
            <div class="stat-value">${files.filter(f => Date.now() - f.addedAt < 7 * 24 * 60 * 60 * 1000).length}</div>
            <div class="stat-label">This Week</div>
          </div>
        </div>
        
        <div class="content-grid">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Recent Files</h2>
            </div>
            <div>
              ${recentFiles.length > 0 ? recentFiles.map(file => `
                <div class="file-item" onclick="openFile('${file.id}')">
                  <div class="file-icon">${getFileIcon(file.type)}</div>
                  <div class="file-info">
                    <div class="file-name">${file.name}</div>
                    <div class="file-meta">${formatDate(file.addedAt)} • ${formatBytes(file.size)}</div>
                  </div>
                </div>
              `).join('') : '<div class="empty-state"><div class="empty-icon">📁</div><p>No files uploaded yet</p><button class="btn btn-primary" onclick="openUploadModal()">Upload Your First File</button></div>'}
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Quick Actions</h2>
            </div>
            <div>
              <button class="action-btn" onclick="openUploadModal()">
                <span style="font-size: 1.5rem;">📤</span>
                <div>
                  <div style="font-weight: 600;">Upload Files</div>
                  <div style="font-size: 0.8rem; color: var(--gray-500);">Add new documents</div>
                </div>
              </button>
              
              <button class="action-btn" onclick="openQRModal()">
                <span style="font-size: 1.5rem;">📷</span>
                <div>
                  <div style="font-weight: 600;">QR Scanner</div>
                  <div style="font-size: 0.8rem; color: var(--gray-500);">Scan college notes</div>
                </div>
              </button>
              
              <button class="action-btn" onclick="navigateTo('search')">
                <span style="font-size: 1.5rem;">🔍</span>
                <div>
                  <div style="font-weight: 600;">Search Files</div>
                  <div style="font-size: 0.8rem; color: var(--gray-500);">Find documents</div>
                </div>
              </button>
            </div>
          </div>
        </div>
      `;
    }

    async function renderSubjects() {
      const files = await getAllFiles();
      const subjectCounts = {};
      files.forEach(file => {
        subjectCounts[file.subjectKey] = (subjectCounts[file.subjectKey] || 0) + 1;
      });
      
      return `
        <div class="header">
          <div>
            <h1 class="header-title">Subjects</h1>
            <p class="header-subtitle">Organize your files by subject categories</p>
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
          ${AHX.state.subjects.map(subject => `
            <div class="card" style="cursor: pointer; transition: var(--transition);" onclick="navigateToSubject('${subject.key}')">
              <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                <div style="font-size: 2rem;">${subject.icon}</div>
                <div>
                  <div style="font-size: 1.2rem; font-weight: 600; color: var(--gray-900);">${subject.name}</div>
                  <div style="font-size: 0.9rem; color: var(--gray-500);">${subject.code}</div>
                </div>
              </div>
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="color: var(--gray-600);">${subjectCounts[subject.key] || 0} files</span>
                <button class="btn btn-primary" onclick="event.stopPropagation(); openUploadModal('${subject.key}')" style="padding: 0.5rem 1rem; font-size: 0.8rem;">Add Files</button>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    async function renderAllFiles() {
      const files = await getAllFiles();
      
      return `
        <div class="header">
          <div>
            <h1 class="header-title">All Files</h1>
            <p class="header-subtitle">Browse all your uploaded documents</p>
          </div>
        </div>
        
        ${files.length > 0 ? `
          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
            ${files.map(file => `
              <div class="card" style="cursor: pointer;" onclick="openFile('${file.id}')">
                <div class="file-item">
                  <div class="file-icon">${getFileIcon(file.type)}</div>
                  <div class="file-info">
                    <div class="file-name">${file.name}</div>
                    <div class="file-meta">${getSubjectName(file.subjectKey)} • ${formatDate(file.addedAt)}</div>
                  </div>
                </div>
                <div style="display: flex; justify-content: flex-end; margin-top: 1rem;">
                  <button onclick="event.stopPropagation(); deleteFileById('${file.id}')" class="btn btn-danger" style="padding: 0.4rem 0.8rem; font-size: 0.8rem;">Delete</button>
                </div>
              </div>
            `).join('')}
          </div>
        ` : `
          <div class="empty-state">
            <div class="empty-icon">📁</div>
            <h3>No files uploaded yet</h3>
            <p>Start by uploading your first document</p>
            <button class="btn btn-primary" onclick="openUploadModal()">Upload Files</button>
          </div>
        `}
      `;
    }

    function renderSearch() {
      return `
        <div class="header">
          <div>
            <h1 class="header-title">Search Files</h1>
            <p class="header-subtitle">Find your documents quickly</p>
          </div>
        </div>
        
        <div class="card" style="margin-bottom: 2rem;">
          <div style="display: flex; gap: 1rem;">
            <input type="text" id="searchInput" placeholder="Search by filename, content, or tags..." style="flex: 1;" class="form-input" oninput="performSearch()">
            <button class="btn btn-primary" onclick="performSearch()">Search</button>
          </div>
        </div>
        
        <div id="searchResults">
          <div class="empty-state">
            <div class="empty-icon">🔍</div>
            <p>Enter a search term to find your files</p>
          </div>
        </div>
      `;
    }

    function renderQRScanner() {
      return `
        <div class="header">
          <div>
            <h1 class="header-title">QR Code Scanner</h1>
            <p class="header-subtitle">Scan QR codes to save notes and links</p>
          </div>
        </div>
        
        <div class="card">
          <div style="text-align: center; padding: 2rem;">
            <div style="font-size: 4rem; margin-bottom: 2rem;">📷</div>
            <h3>Ready to Scan</h3>
            <p style="margin: 1rem 0 2rem 0; color: var(--gray-500);">Click the button below to start scanning QR codes from your classmates or professors</p>
            <button class="btn btn-primary" onclick="openQRModal()">Start QR Scanner</button>
          </div>
        </div>
      `;
    }

    async function renderSettings() {
      const files = await getAllFiles();
      const totalSize = files.reduce((sum, file) => sum + (file.size || 0), 0);
      
      return `
        <div class="header">
          <div>
            <h1 class="header-title">Settings</h1>
            <p class="header-subtitle">Manage your app preferences and data</p>
          </div>
        </div>
        
        <div style="display: grid; gap: 2rem;">
          <div class="card">
            <h2 style="margin-bottom: 1rem; color: var(--gray-900);">Account Information</h2>
            <div style="display: grid; gap: 1rem;">
              <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid var(--gray-200);">
                <div>
                  <div style="font-weight: 600;">Email</div>
                  <div style="color: var(--gray-500); font-size: 0.9rem;">${AHX.state.user?.email || 'Not available'}</div>
                </div>
              </div>
              <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid var(--gray-200);">
                <div>
                  <div style="font-weight: 600;">Name</div>
                  <div style="color: var(--gray-500); font-size: 0.9rem;">${AHX.state.user?.name || 'Not available'}</div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card">
            <h2 style="margin-bottom: 1rem; color: var(--gray-900);">Storage</h2>
            <div style="display: grid; gap: 1rem;">
              <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid var(--gray-200);">
                <div>
                  <div style="font-weight: 600;">Total Files</div>
                  <div style="color: var(--gray-500); font-size: 0.9rem;">Documents stored locally</div>
                </div>
                <div style="font-weight: 600;">${files.length}</div>
              </div>
              <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid var(--gray-200);">
                <div>
                  <div style="font-weight: 600;">Storage Used</div>
                  <div style="color: var(--gray-500); font-size: 0.9rem;">Space occupied by files</div>
                </div>
                <div style="font-weight: 600;">${formatBytes(totalSize)}</div>
              </div>
            </div>
          </div>
          
          <div class="card">
            <h2 style="margin-bottom: 1rem; color: var(--gray-900);">Actions</h2>
            <div style="display: grid; gap: 1rem;">
              <button class="btn" onclick="exportData()">Export All Data</button>
              <button class="btn btn-danger" onclick="clearAllData()">Clear All Local Data</button>
              <button class="btn btn-danger" onclick="signOut()">Sign Out</button>
            </div>
          </div>
        </div>
      `;
    }

    // =================== FILE OPERATIONS ===================
    function openUploadModal(subjectKey = '') {
      if (subjectKey) {
        document.getElementById('uploadSubject').value = subjectKey;
      }
      document.getElementById('uploadModal').classList.add('active');
      setupDragDrop();
    }

    function closeUploadModal() {
      document.getElementById('uploadModal').classList.remove('active');
      document.getElementById('uploadFiles').value = '';
    }

    function setupDragDrop() {
      const dropZone = document.getElementById('dropZone');
      const fileInput = document.getElementById('uploadFiles');
      
      dropZone.onclick = () => fileInput.click();
      
      dropZone.ondragover = (e) => {
        e.preventDefault();
        dropZone.classList.add('drag-over');
      };
      
      dropZone.ondragleave = () => {
        dropZone.classList.remove('drag-over');
      };
      
      dropZone.ondrop = (e) => {
        e.preventDefault();
        dropZone.classList.remove('drag-over');
        fileInput.files = e.dataTransfer.files;
      };
    }

    async function uploadFiles() {
      const subjectKey = document.getElementById('uploadSubject').value;
      const fileInput = document.getElementById('uploadFiles');
      const files = Array.from(fileInput.files || []);
      
      if (!files.length) {
        showNotification('Please select at least one file', 'warning');
        return;
      }
      
      if (!subjectKey) {
        showNotification('Please select a subject', 'warning');
        return;
      }
      
      try {
        const fileRecords = await Promise.all(files.map(async (file) => {
          const buffer = await file.arrayBuffer();
          return {
            id: generateId(),
            subjectKey,
            name: file.name,
            type: file.type,
            size: file.size,
            addedAt: Date.now(),
            blob: new Blob([buffer], { type: file.type })
          };
        }));
        
        await addFiles(fileRecords);
        showNotification(`Successfully uploaded ${files.length} file(s)`, 'success');
        closeUploadModal();
        
        if (AHX.state.currentView === 'dashboard' || AHX.state.currentView === 'files') {
          renderView(AHX.state.currentView);
        }
        
      } catch (error) {
        console.error('Upload error:', error);
        showNotification('Upload failed. Please try again.', 'error');
      }
    }

    async function openFile(id) {
      try {
        const files = await getAllFiles();
        const file = files.find(f => f.id === id);
        
        if (!file) {
          showNotification('File not found', 'error');
          return;
        }
        
        if (file.blob) {
          const url = URL.createObjectURL(file.blob);
          window.open(url, '_blank');
          setTimeout(() => URL.revokeObjectURL(url), 1000);
        } else {
          showNotification('File content not available', 'warning');
        }
        
      } catch (error) {
        console.error('Open file error:', error);
        showNotification('Failed to open file', 'error');
      }
    }

    async function deleteFileById(id) {
      if (!confirm('Are you sure you want to delete this file?')) return;
      
      try {
        await deleteFile(id);
        showNotification('File deleted successfully', 'success');
        renderView(AHX.state.currentView);
      } catch (error) {
        console.error('Delete error:', error);
        showNotification('Failed to delete file', 'error');
      }
    }

    // =================== QR SCANNER ===================
    function openQRModal() {
      document.getElementById('qrModal').classList.add('active');
      startQRScanner();
    }

    function closeQRModal() {
      document.getElementById('qrModal').classList.remove('active');
      stopQRScanner();
    }

    async function startQRScanner() {
      try {
        if (typeof Html5Qrcode === 'undefined') {
          showNotification('QR Scanner library not loaded', 'error');
          return;
        }
        
        qrScanner = new Html5Qrcode("qr-reader");
        const cameras = await Html5Qrcode.getCameras();
        
        if (!cameras.length) {
          showNotification('No cameras found', 'error');
          return;
        }
        
        const camera = cameras.find(c => c.label.toLowerCase().includes('back')) || cameras[0];
        
        await qrScanner.start(
          camera.id,
          { fps: 10, qrbox: { width: 250, height: 250 } },
          (decodedText) => {
            handleQRResult(decodedText);
            closeQRModal();
          },
          () => {} // Silent error handling
        );
        
      } catch (error) {
        console.error('QR Scanner error:', error);
        showNotification('Failed to start camera', 'error');
      }
    }

    async function stopQRScanner() {
      try {
        if (qrScanner) {
          await qrScanner.stop();
          qrScanner.clear();
          qrScanner = null;
        }
      } catch (error) {
        console.warn('QR scanner stop error:', error);
      }
    }

    async function handleQRResult(qrData) {
      try {
        let fileInfo;
        
        if (qrData.startsWith('http')) {
          fileInfo = {
            name: 'Scanned Link',
            content: qrData,
            type: 'url'
          };
        } else {
          fileInfo = {
            name: 'Scanned Note',
            content: qrData,
            type: 'note'
          };
        }
        
        const record = {
          id: generateId(),
          subjectKey: 'scanned',
          name: fileInfo.name,
          type: fileInfo.type,
          size: new Blob([qrData]).size,
          addedAt: Date.now(),
          content: qrData,
          blob: new Blob([qrData], { type: 'text/plain' })
        };
        
        await addFiles([record]);
        showNotification('QR content saved successfully!', 'success');
        
      } catch (error) {
        console.error('QR processing error:', error);
        showNotification('Failed to process QR code', 'error');
      }
    }

    // =================== SEARCH ===================
    async function performSearch() {
      const query = document.getElementById('searchInput')?.value?.trim();
      const resultsContainer = document.getElementById('searchResults');
      
      if (!query) {
        resultsContainer.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">🔍</div>
            <p>Enter a search term to find your files</p>
          </div>
        `;
        return;
      }
      
      resultsContainer.innerHTML = '<div class="loading"><div class="spinner"></div>Searching...</div>';
      
      try {
        const files = await getAllFiles();
        const results = files.filter(file => 
          file.name.toLowerCase().includes(query.toLowerCase()) ||
          (file.content && file.content.toLowerCase().includes(query.toLowerCase()))
        );
        
        if (results.length === 0) {
          resultsContainer.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">🔍</div>
              <p>No files found for "${query}"</p>
            </div>
          `;
          return;
        }
        
        resultsContainer.innerHTML = `
          <div style="display: grid; gap: 1rem;">
            ${results.map(file => `
              <div class="file-item" onclick="openFile('${file.id}')">
                <div class="file-icon">${getFileIcon(file.type)}</div>
                <div class="file-info">
                  <div class="file-name">${file.name}</div>
                  <div class="file-meta">${getSubjectName(file.subjectKey)} • ${formatDate(file.addedAt)}</div>
                </div>
              </div>
            `).join('')}
          </div>
        `;
        
      } catch (error) {
        console.error('Search error:', error);
        resultsContainer.innerHTML = '<div class="error-state">Search failed. Please try again.</div>';
      }
    }

    // =================== UTILITY FUNCTIONS ===================
    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    function formatBytes(bytes) {
      if (!bytes) return '0 B';
      const k = 1024;
      const sizes = ['B', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return `${parseFloat((bytes / Math.pow(k, i)).toFixed(2))} ${sizes[i]}`;
    }

    function formatDate(timestamp) {
      const date = new Date(timestamp);
      const now = new Date();
      const diff = now - date;
      
      if (diff < 60000) return 'Just now';
      if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
      if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
      
      return date.toLocaleDateString();
    }

    function getFileIcon(type) {
      const icons = {
        'application/pdf': '📄',
        'application/msword': '📝',
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document': '📝',
        'text/plain': '📄',
        'image/jpeg': '🖼️',
        'image/png': '🖼️',
        'url': '🔗',
        'note': '📝'
      };
      return icons[type] || '📄';
    }
        function getSubjectName(key) {
      const subject = AHX.state.subjects.find(s => s.key === key);
      return subject ? subject.name : key;
    }

    function navigateToSubject(key) {
      renderView(`subject:${key}`);
    }

    async function renderSubject(subjectKey) {
      const subject = AHX.state.subjects.find(s => s.key === subjectKey);
      if (!subject) {
        navigateTo('subjects');
        return;
      }
      
      const files = await getFilesBySubject(subjectKey);
      
      return `
        <div class="header">
          <div style="display: flex; align-items: center; gap: 1rem;">
            <button onclick="navigateTo('subjects')" style="background: none; border: 1px solid var(--gray-300); border-radius: var(--radius-small); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer;">←</button>
            <div>
              <h1 class="header-title" style="display: flex; align-items: center; gap: 1rem;">
                <span style="font-size: 2rem;">${subject.icon}</span>
                ${subject.name}
              </h1>
              <p class="header-subtitle">${subject.code} • ${files.length} files</p>
            </div>
          </div>
          <div class="header-actions">
            <button class="btn btn-primary" onclick="openUploadModal('${subject.key}')">Add Files</button>
          </div>
        </div>
        
        ${files.length > 0 ? `
          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
            ${files.map(file => `
              <div class="card" style="cursor: pointer; transition: var(--transition);" onclick="openFile('${file.id}')">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                  <div class="file-icon">${getFileIcon(file.type)}</div>
                  <div style="flex: 1; min-width: 0;">
                    <div style="font-weight: 600; color: var(--gray-900); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${file.name}</div>
                    <div style="font-size: 0.8rem; color: var(--gray-500);">${formatDate(file.addedAt)} • ${formatBytes(file.size)}</div>
                  </div>
                </div>
                <div style="display: flex; justify-content: flex-end;">
                  <button onclick="event.stopPropagation(); deleteFileById('${file.id}')" class="btn btn-danger" style="padding: 0.4rem 0.8rem; font-size: 0.8rem;">Delete</button>
                </div>
              </div>
            `).join('')}
          </div>
        ` : `
          <div class="empty-state">
            <div class="empty-icon">${subject.icon}</div>
            <h3>No files in ${subject.name} yet</h3>
            <p>Upload your first ${subject.name.toLowerCase()} file to get started</p>
            <button class="btn btn-primary" onclick="openUploadModal('${subject.key}')">Upload Files</button>
          </div>
        `}
      `;
    }

    // Theme toggle function
    function toggleTheme() {
      const root = document.documentElement;
      const isDark = root.classList.contains('dark');
      
      if (isDark) {
        root.classList.remove('dark');
        localStorage.setItem('ahx_theme', 'light');
      } else {
        root.classList.add('dark');
        localStorage.setItem('ahx_theme', 'dark');
      }
      
      showNotification(`Switched to ${isDark ? 'light' : 'dark'} theme`, 'success', 3000);
    }

    // Export data function
    async function exportData() {
      try {
        const files = await getAllFiles();
        const data = {
          version: '1.0.0',
          exportDate: new Date().toISOString(),
          user: AHX.state.user,
          subjects: AHX.state.subjects,
          totalFiles: files.length,
          files: files.map(f => ({
            ...f,
            blob: undefined // Don't export blob data
          }))
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `academic-hub-x-export-${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        URL.revokeObjectURL(url);
        showNotification('Data exported successfully!', 'success');
        
      } catch (error) {
        console.error('Export error:', error);
        showNotification('Export failed. Please try again.', 'error');
      }
    }

    // Clear all data function
    async function clearAllData() {
      if (!confirm('Are you sure you want to clear ALL local data? This cannot be undone.')) {
        return;
      }
      
      try {
        if (AHX.state.db) {
          const tx = AHX.state.db.transaction(['files'], 'readwrite');
          const store = tx.objectStore('files');
          
          await new Promise((resolve, reject) => {
            const clearRequest = store.clear();
            
            tx.oncomplete = () => {
              showNotification('All data cleared successfully!', 'success');
              renderView(AHX.state.currentView);
              resolve();
            };
            
            tx.onerror = () => reject(new Error('Transaction failed'));
            clearRequest.onerror = () => reject(new Error('Clear operation failed'));
          });
        } else {
          throw new Error('Database not available');
        }
        
      } catch (error) {
        console.error('Clear data error:', error);
        showNotification('Failed to clear data: ' + error.message, 'error');
      }
    }

    // Features demonstration function
    function showFeatures() {
      const features = [
        '📚 Smart subject organization',
        '📱 Progressive Web App support',
        '📷 QR code scanner for notes',
        '🔍 Advanced search functionality',
        '💾 Offline file storage',
        '🔐 Secure authentication',
        '📤 File upload with drag & drop',
        '🌓 Dark/Light theme support',
        '📊 Usage analytics',
        '⚙️ Data export/import'
      ];
      
      showNotification(`Academic Hub X Features:\n${features.join('\n')}`, 'info', 8000);
    }

    // Network status monitoring
    function setupNetworkHandlers() {
      window.addEventListener('online', () => {
        AHX.state.isOnline = true;
        showNotification('Internet connection restored', 'success', 3000);
      });
      
      window.addEventListener('offline', () => {
        AHX.state.isOnline = false;
        showNotification('You are now offline. App will continue to work locally.', 'warning', 5000);
      });
    }

    // PWA install handler
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      window.deferredPrompt = e;
      
      // Show install button or notification
      showNotification('Academic Hub X can be installed as an app! Look for the install option in your browser.', 'info', 10000);
    });

    window.addEventListener('appinstalled', () => {
      showNotification('Academic Hub X installed successfully! 🎉', 'success', 5000);
      window.deferredPrompt = null;
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      // Ctrl/Cmd + K for search
      if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
        e.preventDefault();
        navigateTo('search');
        setTimeout(() => {
          const searchInput = document.getElementById('searchInput');
          if (searchInput) searchInput.focus();
        }, 100);
      }
      
      // Ctrl/Cmd + U for upload
      if ((e.ctrlKey || e.metaKey) && e.key === 'u') {
        e.preventDefault();
        openUploadModal();
      }
      
      // Ctrl/Cmd + T for theme toggle
      if ((e.ctrlKey || e.metaKey) && e.key === 't') {
        e.preventDefault();
        toggleTheme();
      }
    });

    // Final initialization and setup
    function finalizeSetup() {
      // Setup network monitoring
      setupNetworkHandlers();
      
      // Load saved theme
      const savedTheme = localStorage.getItem('ahx_theme');
      if (savedTheme === 'dark') {
        document.documentElement.classList.add('dark');
      }
      
      // Expose functions globally for UI event handlers
      window.navigateTo = navigateTo;
      window.navigateToSubject = navigateToSubject;
      window.openFile = openFile;
      window.deleteFileById = deleteFileById;
      window.toggleTheme = toggleTheme;
      window.exportData = exportData;
      window.clearAllData = clearAllData;
      window.signOut = signOut;
      window.openUploadModal = openUploadModal;
      window.closeUploadModal = closeUploadModal;
      window.uploadFiles = uploadFiles;
      window.openQRModal = openQRModal;
      window.closeQRModal = closeQRModal;
      window.performSearch = performSearch;
      window.handleSignIn = handleSignIn;
      window.handleSignUp = handleSignUp;
      window.switchAuthTab = switchAuthTab;
      window.openAuth = openAuth;
      window.closeAuth = closeAuth;
      window.showFeatures = showFeatures;
      
      console.log('✅ Academic Hub X fully loaded and ready!');
      console.log('📱 PWA features enabled');
      console.log('🔑 Keyboard shortcuts: Ctrl+K (search), Ctrl+U (upload), Ctrl+T (theme)');
      console.log('💡 Use demo@academichub.com / demo123 for testing');
    }

    // Call final setup
    finalizeSetup();

  </script>
</body>
</html>

