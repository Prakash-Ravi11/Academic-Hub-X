<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Academic Hub X - SRM KTR Smart Student Portal</title>
    
    <!-- Enhanced PWA Manifest with Custom Logo -->
    <link rel="manifest" href="data:application/json,{%22name%22:%22Academic%20Hub%20X%20-%20SRM%20KTR%22,%22short_name%22:%22AHX%22,%22start_url%22:%22./%22,%22display%22:%22standalone%22,%22background_color%22:%22%23667eea%22,%22theme_color%22:%22%23764ba2%22,%22orientation%22:%22portrait%22,%22categories%22:[%22education%22,%22productivity%22],%22icons%22:[{%22src%22:%22data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='192' height='192' viewBox='0 0 192 192'%3E%3Cdefs%3E%3ClinearGradient id='logoGrad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23667eea'/%3E%3Cstop offset='50%25' stop-color='%23764ba2'/%3E%3Cstop offset='100%25' stop-color='%23f093fb'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='192' height='192' rx='48' fill='url(%23logoGrad)'/%3E%3Ccircle cx='96' cy='60' r='16' fill='white' opacity='0.9'/%3E%3Crect x='64' y='88' width='64' height='8' rx='4' fill='white' opacity='0.9'/%3E%3Crect x='64' y='104' width='48' height='6' rx='3' fill='white' opacity='0.7'/%3E%3Crect x='64' y='118' width='56' height='6' rx='3' fill='white' opacity='0.7'/%3E%3Crect x='64' y='140' width='40' height='8' rx='4' fill='white' opacity='0.5'/%3E%3Cpath d='M48 168h96v8a8 8 0 0 1-8 8H56a8 8 0 0 1-8-8v-8z' fill='white' opacity='0.6'/%3E%3C/svg%3E%22,%22sizes%22:%22192x192%22,%22type%22:%22image/svg+xml%22,%22purpose%22:%22any%20maskable%22},{%22src%22:%22data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 512 512'%3E%3Cdefs%3E%3ClinearGradient id='logoGrad2' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23667eea'/%3E%3Cstop offset='50%25' stop-color='%23764ba2'/%3E%3Cstop offset='100%25' stop-color='%23f093fb'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='512' height='512' rx='128' fill='url(%23logoGrad2)'/%3E%3Ccircle cx='256' cy='160' r='42' fill='white' opacity='0.9'/%3E%3Crect x='170' y='234' width='172' height='22' rx='11' fill='white' opacity='0.9'/%3E%3Crect x='170' y='278' width='128' height='16' rx='8' fill='white' opacity='0.7'/%3E%3Crect x='170' y='314' width='150' height='16' rx='8' fill='white' opacity='0.7'/%3E%3Crect x='170' y='374' width='106' height='22' rx='11' fill='white' opacity='0.5'/%3E%3Cpath d='M128 448h256v22a22 22 0 0 1-22 22H150a22 22 0 0 1-22-22v-22z' fill='white' opacity='0.6'/%3E%3C/svg%3E%22,%22sizes%22:%22512x512%22,%22type%22:%22image/svg+xml%22,%22purpose%22:%22any%20maskable%22}]}">
    
    <!-- App Icons -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3ClinearGradient id='iconGrad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23667eea'/%3E%3Cstop offset='100%25' stop-color='%23764ba2'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='64' height='64' rx='16' fill='url(%23iconGrad)'/%3E%3Ccircle cx='32' cy='20' r='6' fill='white'/%3E%3Crect x='20' y='30' width='24' height='3' rx='1.5' fill='white'/%3E%3Crect x='20' y='36' width='18' height='2' rx='1' fill='white' opacity='0.8'/%3E%3Crect x='20' y='40' width='20' height='2' rx='1' fill='white' opacity='0.8'/%3E%3Crect x='20' y='48' width='16' height='3' rx='1.5' fill='white' opacity='0.6'/%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Cdefs%3E%3ClinearGradient id='appleGrad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23667eea'/%3E%3Cstop offset='100%25' stop-color='%23764ba2'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='180' height='180' rx='40' fill='url(%23appleGrad)'/%3E%3Ccircle cx='90' cy='54' r='16' fill='white'/%3E%3Crect x='60' y='82' width='60' height='8' rx='4' fill='white'/%3E%3Crect x='60' y='98' width='45' height='6' rx='3' fill='white' opacity='0.8'/%3E%3Crect x='60' y='112' width='50' height='6' rx='3' fill='white' opacity='0.8'/%3E%3Crect x='60' y='134' width='38' height='8' rx='4' fill='white' opacity='0.6'/%3E%3C/svg%3E">
    
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Academic Hub X">
    <meta name="msapplication-TileColor" content="#667eea">
    
    <!-- External Libraries with Error Handling -->
    <script>
        window.scriptLoadErrors = [];
        function handleScriptError(scriptName) {
            window.scriptLoadErrors.push(scriptName);
            console.warn(`Failed to load ${scriptName}, using fallback`);
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js" 
            onerror="handleScriptError('supabase')" async></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js" 
            onerror="handleScriptError('html5-qrcode')" async></script>
    
    <style>
        /* =================== ULTRA MODERN DESIGN SYSTEM 2025 =================== */
        :root {
            /* Premium Font Stack */
            --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            --font-display: 'SF Pro Display', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            --font-mono: 'JetBrains Mono', 'Fira Code', Consolas, monospace;
            
            /* Enhanced Color Palette */
            --primary: #667eea;
            --primary-dark: #764ba2;
            --primary-light: #f093fb;
            --secondary: #4facfe;
            --accent: #43e97b;
            --warning: #ffa726;
            --error: #ff5722;
            --success: #00e676;
            --info: #2196f3;
            
            /* Neural Network Gradients */
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-accent: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --gradient-cosmic: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            --gradient-neural: radial-gradient(circle at 30% 40%, rgba(120, 119, 198, 0.3), transparent 50%),
                              radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3), transparent 50%),
                              radial-gradient(circle at 40% 80%, rgba(120, 219, 255, 0.3), transparent 50%);
            
            /* Glass Morphism */
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            
            /* Background System */
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-tertiary: #1a1a1a;
            --bg-modal: rgba(0, 0, 0, 0.8);
            
            /* Text Colors */
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --text-tertiary: #666666;
            --text-accent: #667eea;
            --text-inverse: #000000;
            
            /* Enhanced Shadows */
            --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --shadow-neural: 0 0 50px rgba(102, 126, 234, 0.3);
            --shadow-cosmic: 0 20px 60px rgba(118, 75, 162, 0.4);
            
            /* Border Radius */
            --radius-xs: 4px;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-2xl: 20px;
            --radius-3xl: 24px;
            --radius-full: 9999px;
            
            /* Animations */
            --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --transition-spring: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            
            /* Z-Index Scale */
            --z-base: 0;
            --z-dropdown: 1000;
            --z-sticky: 1010;
            --z-fixed: 1020;
            --z-modal-backdrop: 1030;
            --z-modal: 1040;
            --z-popover: 1050;
            --z-tooltip: 1060;
            --z-toast: 1070;
            --z-loading: 9999;
        }

        /* Light Mode Override */
        .light-mode {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --bg-modal: rgba(0, 0, 0, 0.6);
            --glass-bg: rgba(0, 0, 0, 0.05);
            --glass-border: rgba(0, 0, 0, 0.1);
            --text-primary: #1a1a1a;
            --text-secondary: #4a5568;
            --text-tertiary: #a0aec0;
            --text-inverse: #ffffff;
            --shadow-neural: 0 0 50px rgba(102, 126, 234, 0.1);
            --shadow-cosmic: 0 20px 60px rgba(118, 75, 162, 0.15);
        }

        /* Modern Reset */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-size-adjust: 100%;
        }

        body {
            font-family: var(--font-primary);
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* =================== ULTRA FUTURISTIC LOADING SCREEN =================== */
        .loading-screen {
            position: fixed;
            inset: 0;
            background: var(--gradient-cosmic);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: var(--z-loading);
            opacity: 1;
            visibility: visible;
            transition: opacity 1s ease, visibility 1s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .loading-screen::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--gradient-neural);
            animation: neuralPulse 4s ease-in-out infinite;
        }

        @keyframes neuralPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .loading-container {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .loading-logo {
            width: 140px;
            height: 140px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-3xl);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
            animation: logoFloat 3s ease-in-out infinite, logoGlow 2s ease-in-out infinite alternate;
        }

        .loading-logo::before {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: var(--radius-3xl);
            background: var(--gradient-cosmic);
            z-index: -1;
            animation: logoBorderRotate 4s linear infinite;
        }

        .loading-logo-icon {
            width: 70px;
            height: 70px;
            background: var(--gradient-primary);
            border-radius: var(--radius-2xl);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: 800;
        }

        .loading-logo-icon::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 8px;
            animation: logoIconPulse 1.5s ease-in-out infinite;
        }

        .loading-title {
            font-family: var(--font-display);
            font-size: clamp(2rem, 6vw, 3.5rem);
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            animation: titleGlow 2s ease-in-out infinite alternate;
        }

        .loading-subtitle {
            font-size: clamp(1rem, 3vw, 1.4rem);
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 3rem;
            animation: subtitlePulse 3s ease-in-out infinite;
            max-width: 500px;
            line-height: 1.6;
        }

        .loading-progress-container {
            width: 300px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            overflow: hidden;
            position: relative;
            margin-bottom: 1rem;
        }

        .loading-progress-bar {
            height: 100%;
            background: var(--gradient-accent);
            border-radius: var(--radius-full);
            animation: progressFill 3s ease-in-out infinite;
            position: relative;
        }

        .loading-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: progressShine 2s ease-in-out infinite;
        }

        .loading-status {
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.7);
            animation: statusPulse 2s ease-in-out infinite;
        }

        /* Loading Animations */
        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-15px) scale(1.05); }
        }

        @keyframes logoGlow {
            0% { box-shadow: var(--shadow-neural); }
            100% { box-shadow: var(--shadow-cosmic); }
        }

        @keyframes logoBorderRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes logoIconPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        @keyframes titleGlow {
            0% { filter: drop-shadow(0 0 10px rgba(102, 126, 234, 0.5)); }
            100% { filter: drop-shadow(0 0 20px rgba(118, 75, 162, 0.8)); }
        }

        @keyframes subtitlePulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        @keyframes progressFill {
            0% { width: 0%; }
            50% { width: 70%; }
            100% { width: 100%; }
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        /* =================== MODERN LANDING PAGE =================== */
        .landing-hero {
            min-height: 100vh;
            background: var(--gradient-cosmic);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            color: white;
            text-align: center;
            padding: 2rem;
        }

        .landing-hero::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--gradient-neural);
            animation: heroBackground 15s ease-in-out infinite;
        }

        .hero-content {
            position: relative;
            z-index: 10;
            max-width: 900px;
        }

        .hero-title {
            font-family: var(--font-display);
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 900;
            line-height: 1.1;
            margin-bottom: 2rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: heroTitleGlow 3s ease-in-out infinite alternate;
            letter-spacing: -0.02em;
        }

        .hero-subtitle {
            font-size: clamp(1.1rem, 3vw, 1.6rem);
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 3rem;
            line-height: 1.6;
            animation: heroSubtitleFloat 4s ease-in-out infinite;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-cta {
            display: inline-flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem 3rem;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-3xl);
            color: white;
            text-decoration: none;
            font-weight: 700;
            font-size: 1.2rem;
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .hero-cta::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--gradient-accent);
            opacity: 0;
            transition: var(--transition-normal);
        }

        .hero-cta:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: var(--shadow-cosmic);
        }

        .hero-cta:hover::before {
            opacity: 0.1;
        }

        @keyframes heroBackground {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        @keyframes heroTitleGlow {
            0% { filter: drop-shadow(0 0 20px rgba(102, 126, 234, 0.5)); }
            100% { filter: drop-shadow(0 0 40px rgba(118, 75, 162, 0.8)); }
        }

        @keyframes heroSubtitleFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* =================== GLASS MORPHISM AUTH MODAL =================== */
        .auth-modal {
            position: fixed;
            inset: 0;
            background: var(--bg-modal);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-normal);
            padding: 1rem;
        }

        .auth-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .auth-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-3xl);
            padding: 3rem;
            max-width: 480px;
            width: 100%;
            box-shadow: var(--shadow-2xl);
            transform: translateY(50px) scale(0.9);
            transition: var(--transition-spring);
            position: relative;
            overflow: hidden;
        }

        .auth-modal.active .auth-panel {
            transform: translateY(0) scale(1);
        }

        .auth-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-cosmic);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .auth-title {
            font-family: var(--font-display);
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .auth-subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 500;
        }

        .auth-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-xl);
            padding: 6px;
            margin-bottom: 2rem;
        }

        .auth-tab {
            flex: 1;
            padding: 1rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-weight: 600;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: var(--transition-normal);
            font-family: inherit;
            font-size: 0.95rem;
        }

        .auth-tab.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-neural);
        }

        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition-normal);
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        /* =================== ENHANCED FORM ELEMENTS =================== */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 1.25rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition-normal);
            font-family: inherit;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }

        .form-error {
            display: none;
            background: rgba(255, 87, 34, 0.1);
            color: var(--error);
            padding: 1rem;
            border-radius: var(--radius-lg);
            margin-bottom: 1rem;
            border-left: 4px solid var(--error);
            font-size: 0.9rem;
        }

        .form-success {
            display: none;
            background: rgba(0, 230, 118, 0.1);
            color: var(--success);
            padding: 1rem;
            border-radius: var(--radius-lg);
            margin-bottom: 1rem;
            border-left: 4px solid var(--success);
            font-size: 0.9rem;
        }

        /* =================== MODERN BUTTONS =================== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 1.25rem 2rem;
            border: none;
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
            font-family: inherit;
            text-decoration: none;
            line-height: 1;
            white-space: nowrap;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn:disabled::before {
            display: none;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--gradient-accent);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--error), #d32f2f);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
            border: none;
        }

        .btn-ghost:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        .btn-sm {
            padding: 0.75rem 1.5rem;
            font-size: 0.875rem;
        }

        .btn-lg {
            padding: 1.5rem 3rem;
            font-size: 1.125rem;
        }

        .btn-icon {
            padding: 1rem;
            aspect-ratio: 1;
        }

        /* =================== DASHBOARD LAYOUT =================== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            min-height: 100vh;
            background: var(--bg-primary);
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: fixed;
                left: -100%;
                transition: left 0.3s ease;
                z-index: var(--z-fixed);
                width: 300px;
            }
            
            .sidebar.open {
                left: 0;
            }
            
            .mobile-menu-btn {
                display: flex !important;
            }
            
            .mobile-overlay {
                display: block !important;
            }
        }

        /* =================== ENHANCED SIDEBAR =================== */
        .sidebar {
            background: var(--bg-secondary);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem 1rem;
            position: relative;
            overflow-y: auto;
            height: 100vh;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: var(--gradient-neural);
            opacity: 0.05;
            pointer-events: none;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 3rem;
            position: relative;
            z-index: 10;
        }

        .brand-logo {
            width: 52px;
            height: 52px;
            background: var(--gradient-primary);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            animation: brandPulse 3s ease-in-out infinite;
            color: white;
            font-weight: 800;
            font-size: 1.5rem;
        }

        .brand-logo::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            top: 6px;
            opacity: 0.9;
        }

        .brand-text h1 {
            font-family: var(--font-display);
            font-size: 1.4rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
        }

        .brand-text p {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin: 0.25rem 0 0 0;
            font-weight: 500;
        }

        .nav-section {
            margin-bottom: 2.5rem;
            position: relative;
            z-index: 10;
        }

        .nav-section h3 {
            color: var(--text-tertiary);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
            padding: 0 1rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--radius-xl);
            transition: var(--transition-normal);
            margin-bottom: 0.5rem;
            cursor: pointer;
            border: none;
            background: transparent;
            width: 100%;
            font-family: inherit;
            font-size: 0.95rem;
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--gradient-primary);
            transform: scaleY(0);
            transition: var(--transition-normal);
        }

        .nav-item:hover,
        .nav-item.active {
            background: rgba(102, 126, 234, 0.1);
            color: var(--text-primary);
            transform: translateX(8px);
        }

        .nav-item.active::before {
            transform: scaleY(1);
        }

        .nav-icon {
            font-size: 1.25rem;
            width: 28px;
            text-align: center;
            flex-shrink: 0;
        }

        .nav-text {
            font-weight: 500;
        }

        .user-profile {
            position: absolute;
            bottom: 2rem;
            left: 1rem;
            right: 1rem;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-2xl);
            padding: 1.5rem;
            z-index: 10;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            background: var(--gradient-accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            margin-bottom: 1rem;
            font-size: 1.25rem;
        }

        .user-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
            font-size: 0.95rem;
        }

        .user-role {
            color: var(--text-secondary);
            font-size: 0.8rem;
            font-weight: 500;
        }

        @keyframes brandPulse {
            0%, 100% { box-shadow: var(--shadow-neural); }
            50% { box-shadow: var(--shadow-cosmic); }
        }

        /* =================== MOBILE MENU =================== */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: calc(var(--z-fixed) + 1);
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: 1rem;
            cursor: pointer;
            transition: var(--transition-normal);
            color: var(--text-primary);
        }

        .mobile-menu-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.05);
        }

        .mobile-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: calc(var(--z-fixed) - 1);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .mobile-overlay.show {
            opacity: 1;
        }

        /* =================== MAIN CONTENT AREA =================== */
        .main-content {
            background: var(--bg-primary);
            padding: 2rem;
            overflow-y: auto;
            position: relative;
            min-height: 100vh;
        }

        .main-content::before {
            content: '';
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-neural);
            opacity: 0.02;
            pointer-events: none;
            z-index: 0;
        }

        .content-wrapper {
            position: relative;
            z-index: 10;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 3rem;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .page-title {
            font-family: var(--font-display);
            font-size: clamp(2.5rem, 5vw, 3.5rem);
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
            margin: 0;
            letter-spacing: -0.025em;
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 1.15rem;
            margin: 0.75rem 0 0 0;
            line-height: 1.5;
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        /* =================== GLASS CARDS =================== */
        .card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-2xl);
            padding: 2rem;
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: var(--transition-normal);
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-cosmic);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .card:hover::before {
            transform: scaleX(1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-2xl);
            padding: 2rem;
            transition: var(--transition-normal);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--gradient-primary);
            opacity: 0;
            transition: var(--transition-normal);
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: var(--shadow-cosmic);
        }

        .stat-card:hover::before {
            opacity: 0.05;
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .stat-icon {
            width: 64px;
            height: 64px;
            background: var(--gradient-accent);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            box-shadow: var(--shadow-neural);
            animation: statIconFloat 4s ease-in-out infinite;
        }

        .stat-value {
            font-family: var(--font-display);
            font-size: 2.75rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            line-height: 1;
        }

        .stat-label {
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 1rem;
        }

        .stat-change {
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            background: rgba(0, 230, 118, 0.1);
            color: var(--success);
            border-radius: var(--radius-full);
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }

        @keyframes statIconFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        /* =================== NOTIFICATIONS =================== */
        .notification-container {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: calc(var(--z-modal) + 100);
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 420px;
            width: 100%;
        }

        .notification {
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-xl);
            padding: 1.5rem;
            transform: translateX(120%);
            transition: var(--transition-spring);
            position: relative;
            overflow: hidden;
            color: var(--text-primary);
        }

        .notification::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--gradient-primary);
        }

        .notification.success::before { background: var(--gradient-accent); }
        .notification.error::before { background: var(--error); }
        .notification.warning::before { background: var(--warning); }
        .notification.info::before { background: var(--info); }

        .notification.show {
            transform: translateX(0);
        }

        .notification-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }

        .notification-text {
            flex: 1;
            font-weight: 500;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.25rem;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition-normal);
            flex-shrink: 0;
        }

        .notification-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        /* =================== MODAL SYSTEM =================== */
        .modal {
            position: fixed;
            inset: 0;
            background: var(--bg-modal);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-normal);
            padding: 1rem;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-3xl);
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9) translateY(50px);
            transition: var(--transition-spring);
            position: relative;
        }

        .modal.active .modal-panel {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            font-family: var(--font-display);
            font-size: 1.75rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        /* =================== QR SCANNER STYLES =================== */
        .qr-scanner-container {
            position: relative;
            border-radius: var(--radius-2xl);
            overflow: hidden;
            background: var(--bg-tertiary);
            border: 2px solid var(--glass-border);
        }

        #qr-reader {
            width: 100% !important;
            border: none !important;
            border-radius: var(--radius-2xl) !important;
        }

        #qr-reader video {
            border-radius: var(--radius-2xl) !important;
            object-fit: cover;
        }

        .qr-status {
            padding: 1rem;
            text-align: center;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            margin-top: 1rem;
            border: 1px solid var(--glass-border);
        }

        @keyframes qrIconFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }

        /* =================== TIMETABLE STYLES =================== */
        .timetable-container {
            overflow-x: auto;
            border-radius: var(--radius-2xl);
            background: var(--bg-tertiary);
            padding: 1rem;
        }

        .timetable-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            min-width: 900px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-2xl);
        }

        .timetable-header {
            background: var(--gradient-primary);
            color: white;
            font-weight: 700;
        }

        .timetable-cell {
            padding: 1.5rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition-normal);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .timetable-cell:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }

        /* =================== UPLOAD ZONE STYLES =================== */
        .upload-zone {
            border: 2px dashed var(--glass-border);
            border-radius: var(--radius-2xl);
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition-normal);
            background: var(--glass-bg);
        }

        .upload-zone:hover,
        .upload-zone.drag-over {
            border-color: var(--primary);
            background: rgba(102, 126, 234, 0.1);
        }

        .upload-zone-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.7;
        }

        /* =================== UTILITY CLASSES =================== */
        .hidden { 
            display: none !important; 
        }
        
        .sr-only { 
            position: absolute; 
            width: 1px; 
            height: 1px; 
            padding: 0; 
            margin: -1px; 
            overflow: hidden; 
            clip: rect(0, 0, 0, 0); 
            white-space: nowrap; 
            border: 0; 
        }
        
        .fade-in { 
            animation: fadeIn 0.6s ease-out; 
        }
        
        .slide-up { 
            animation: slideUp 0.6s ease-out; 
        }
        
        .bounce-in { 
            animation: bounceIn 0.8s ease-out; 
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* =================== RESPONSIVE DESIGN =================== */
        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .page-title {
                font-size: 2.5rem;
            }

            .main-content {
                padding: 1rem;
                padding-top: 5rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .stat-card,
            .card {
                padding: 1.5rem;
            }

            .notification-container {
                top: 1rem;
                right: 1rem;
                left: 1rem;
            }

            .notification {
                transform: translateY(-100%);
            }

            .notification.show {
                transform: translateY(0);
            }

            .auth-panel {
                padding: 2rem;
                margin: 1rem;
            }

            .auth-title {
                font-size: 1.8rem;
            }

            .hero-title {
                font-size: clamp(2.5rem, 10vw, 4rem);
            }

            .loading-logo {
                width: 100px;
                height: 100px;
            }

            .loading-title {
                font-size: 2rem;
            }

            .timetable-container {
                padding: 0.5rem;
            }

            .upload-zone {
                padding: 2rem 1rem;
            }
        }

        @media (max-width: 480px) {
            .modal-panel {
                margin: 0.5rem;
                padding: 1.5rem;
            }

            .btn-lg {
                padding: 1.25rem 2rem;
                font-size: 1rem;
            }

            .stat-value {
                font-size: 2.25rem;
            }

            .brand-text h1 {
                font-size: 1.2rem;
            }

            .nav-item {
                padding: 0.75rem;
            }
        }

        /* =================== SCROLLBAR STYLING =================== */
        ::-webkit-scrollbar { 
            width: 8px; 
            height: 8px; 
        }
        
        ::-webkit-scrollbar-track { 
            background: rgba(255, 255, 255, 0.05); 
            border-radius: var(--radius-sm); 
        }
        
        ::-webkit-scrollbar-thumb { 
            background: var(--gradient-primary); 
            border-radius: var(--radius-sm); 
            transition: var(--transition-normal);
        }
        
        ::-webkit-scrollbar-thumb:hover { 
            background: var(--gradient-accent); 
        }

        /* =================== ACCESSIBILITY =================== */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        @media (prefers-contrast: high) {
            :root {
                --glass-bg: rgba(255, 255, 255, 0.15);
                --glass-border: rgba(255, 255, 255, 0.3);
                --text-secondary: #cccccc;
            }
        }

        /* Focus styles for keyboard navigation */
        .btn:focus-visible,
        .nav-item:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        .form-input:focus-visible,
        .form-select:focus-visible,
        .form-textarea:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: -2px;
        }
    </style>
</head>
<body>
    <!-- =================== ULTRA FUTURISTIC LOADING SCREEN =================== -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-container">
            <div class="loading-logo">
                <div class="loading-logo-icon">S</div>
            </div>
            
            <h1 class="loading-title">Academic Hub X</h1>
            <p class="loading-subtitle">Initializing Neural Academic Network for SRM KTR</p>
            
            <div class="loading-progress-container">
                <div class="loading-progress-bar"></div>
            </div>
            
            <div class="loading-status" id="loadingStatus">Establishing quantum connections...</div>
        </div>
    </div>

    <!-- =================== MODERN LANDING PAGE =================== -->
    <div id="landingPage" class="landing-hero hidden">
        <div class="hero-content">
            <h1 class="hero-title">Academic Hub X</h1>
            <p class="hero-subtitle">
                Next-generation academic management for SRM KTR students. Organize files, scan QR codes, 
                manage timetables, and sync across devices with quantum-speed efficiency.
            </p>
            <a href="#" class="hero-cta" onclick="openAuth()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                </svg>
                Launch Neural Interface
            </a>
        </div>
    </div>

    <!-- =================== ENHANCED AUTH MODAL =================== -->
    <div id="authModal" class="auth-modal">
        <div class="auth-panel">
            <button class="close-btn" onclick="closeAuth()" aria-label="Close">×</button>
            
            <div class="auth-header">
                <h2 class="auth-title">Neural Access Portal</h2>
                <p class="auth-subtitle">SRM KTR Quantum Authentication</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('signin')" data-tab="signin">
                    Quantum Sign In
                </button>
                <button class="auth-tab" onclick="switchAuthTab('signup')" data-tab="signup">
                    Neural Register
                </button>
            </div>

            <div id="authError" class="form-error"></div>
            <div id="authSuccess" class="form-success"></div>

            <!-- Sign In Form -->
            <form id="signinForm" onsubmit="handleSignIn(event)">
                <div class="form-group">
                    <label class="form-label">Neural Email Interface</label>
                    <input type="email" class="form-input" id="signin-email" 
                           placeholder="Enter your quantum email" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label class="form-label">Security Passphrase</label>
                    <input type="password" class="form-input" id="signin-password" 
                           placeholder="Enter your neural passphrase" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn btn-primary" id="signinBtn" style="width: 100%;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                    </svg>
                    <span>Establish Neural Link</span>
                </button>
            </form>

            <!-- Sign Up Form -->
            <form id="signupForm" class="hidden" onsubmit="handleSignUp(event)">
                <div class="form-group">
                    <label class="form-label">Neural Identity</label>
                    <input type="text" class="form-input" id="signup-name" 
                           placeholder="Enter your quantum name" required autocomplete="name">
                </div>
                <div class="form-group">
                    <label class="form-label">Quantum Email</label>
                    <input type="email" class="form-input" id="signup-email" 
                           placeholder="Enter your neural email" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label class="form-label">Security Matrix</label>
                    <input type="password" class="form-input" id="signup-password" 
                           placeholder="Create neural passphrase" required minlength="6" autocomplete="new-password">
                </div>
                <button type="submit" class="btn btn-primary" id="signupBtn" style="width: 100%;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                    <span>Initialize Neural Core</span>
                </button>
            </form>
        </div>
    </div>

    <!-- =================== MAIN APPLICATION =================== -->
    <div id="app" class="hidden">
        <div class="dashboard-grid">
            <!-- Enhanced Sidebar -->
            <aside class="sidebar" id="sidebar">
                <div class="brand">
                    <div class="brand-logo">S</div>
                    <div class="brand-text">
                        <h1>Academic Hub X</h1>
                        <p>Neural SRM Portal</p>
                    </div>
                </div>
                
                <nav>
                    <div class="nav-section">
                        <h3>Core Modules</h3>
                        <button class="nav-item active" onclick="navigateTo('dashboard')" data-route="dashboard">
                            <span class="nav-icon">🏠</span>
                            <span class="nav-text">Neural Dashboard</span>
                        </button>
                        <button class="nav-item" onclick="navigateTo('subjects')" data-route="subjects">
                            <span class="nav-icon">📚</span>
                            <span class="nav-text">Subject Matrix</span>
                        </button>
                        <button class="nav-item" onclick="navigateTo('files')" data-route="files">
                            <span class="nav-icon">📄</span>
                            <span class="nav-text">File Quantum</span>
                        </button>
                    </div>

                    <div class="nav-section">
                        <h3>Quantum Tools</h3>
                        <button class="nav-item" onclick="navigateTo('search')" data-route="search">
                            <span class="nav-icon">🔍</span>
                            <span class="nav-text">Neural Search</span>
                        </button>
                        <button class="nav-item" onclick="navigateTo('qr')" data-route="qr">
                            <span class="nav-icon">📷</span>
                            <span class="nav-text">QR Neural Scan</span>
                        </button>
                        <button class="nav-item" onclick="navigateTo('timetable')" data-route="timetable">
                            <span class="nav-icon">🗓️</span>
                            <span class="nav-text">Time Matrix</span>
                        </button>
                    </div>

                    <div class="nav-section">
                        <h3>System Core</h3>
                        <button class="nav-item" onclick="navigateTo('settings')" data-route="settings">
                            <span class="nav-icon">⚙️</span>
                            <span class="nav-text">Neural Settings</span>
                        </button>
                    </div>
                </nav>
                
                <div class="user-profile">
                    <div class="user-avatar" id="userInitial">Q</div>
                    <div class="user-name" id="sidebarUserName">Quantum User</div>
                    <div class="user-role">SRM Neural Student</div>
                </div>
            </aside>
            
            <!-- Mobile Menu Button -->
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle Menu">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>

            <!-- Mobile Overlay -->
            <div class="mobile-overlay" onclick="closeMobileMenu()"></div>
            
            <!-- Main Content Area -->
            <main class="main-content">
                <div class="content-wrapper">
                    <div id="viewContent">
                        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 4rem 2rem; text-align: center;">
                            <div style="width: 60px; height: 60px; border: 4px solid rgba(102, 126, 234, 0.2); border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 2rem;"></div>
                            <span style="color: var(--text-secondary); font-size: 1.1rem;">Initializing neural dashboard...</span>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Notification Container -->
    <div id="notificationContainer" class="notification-container"></div>

    <script>
        // =================== ENHANCED CONFIGURATION =================== 
        const SUPABASE_URL = 'https://yvlspahwnnzfctqqlmbu.supabase.co';
        const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl2bHNwYWh3bm56ZmN0cXFsbWJ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzNjQ4NzUsImV4cCI6MjA2OTk0MDg3NX0.5j6phM4WCe7XZo5xHdajwAShkV-hibECc_sp31JI6SQ';
        
        // Global Neural State Management
        window.AHX = {
            state: {
                // SRM KTR Academic Subjects based on your timetable
                subjects: [
                    { key: 'transforms_bvp', name: 'Transforms & Boundary Value Problems', code: '21MAB201T', icon: '📊', faculty: 'Dr. P. Godhandaraman', room: 'CLS619' },
                    { key: 'data_structures', name: 'Data Structures & Algorithms', code: '21CSC201J', icon: '🔢', faculty: 'Dr. Kalpana C', room: 'CLS619' },
                    { key: 'computer_org', name: 'Computer Organization & Architecture', code: '21CSS201T', icon: '💻', faculty: 'Dr. Meenakshi M', room: 'CLS619' },
                    { key: 'advanced_programming', name: 'Advanced Programming Practice', code: '21CSC203P', icon: '⚡', faculty: 'Dr. Prince Chelladurai S', room: 'CLS619' },
                    { key: 'operating_systems', name: 'Operating Systems', code: '21CSC202J', icon: '🔧', faculty: 'Dr. G. Priyadharshini', room: 'CLS619' },
                    { key: 'uhv_ii', name: 'UHV-II: Universal Human Values', code: '21LEM202T', icon: '🌟', faculty: 'Mr. D. Boopathi', room: 'TBA' },
                    { key: 'professional_ethics', name: 'Professional Ethics', code: '21LEM201T', icon: '⚖️', faculty: 'Dr. B. Monika Nair', room: 'Online' },
                    { key: 'scanned', name: 'Neural Scanned Notes', code: 'SCAN', icon: '📷', faculty: 'Smart Board', room: 'Various' }
                ],
                
                // SRM KTR Timetable Structure based on your documents
                srmTimetableSlots: {
                    'Day1': { 1: 'P1', 2: 'P2/X', 3: 'P3/X', 4: 'P4', 5: 'P5', 6: 'A', 7: 'A', 8: 'F', 9: 'F', 10: 'G', 11: 'L11', 12: 'L12' },
                    'Day2': { 1: 'B', 2: 'B/X', 3: 'G/X', 4: 'G', 5: 'A', 6: 'P16', 7: 'P17', 8: 'P18', 9: 'P19', 10: 'P20', 11: 'L21', 12: 'L22' },
                    'Day3': { 1: 'P21', 2: 'P22/X', 3: 'P23/X', 4: 'P24', 5: 'P25', 6: 'C', 7: 'C', 8: 'A', 9: 'D', 10: 'B', 11: 'L31', 12: 'L32' },
                    'Day4': { 1: 'D', 2: 'D/X', 3: 'B/X', 4: 'E', 5: 'C', 6: 'P36', 7: 'P37', 8: 'P38', 9: 'P39', 10: 'P40', 11: 'L41', 12: 'L42' },
                    'Day5': { 1: 'P41', 2: 'P42/X', 3: 'P43/X', 4: 'P44', 5: 'P45', 6: 'E', 7: 'E', 8: 'C', 9: 'F', 10: 'D', 11: 'L51', 12: 'L52' }
                },
                
                // Application state
                db: null,
                user: null,
                currentView: 'dashboard',
                files: [],
                isOnline: navigator.onLine,
                realtimeChannel: null,
                timetable: null,
                theme: localStorage.getItem('ahx_theme') || 'dark',
                qrScanner: null,
                selectedFiles: []
            }
        };

        let supabase = null;
        let loadingMessages = [
            'Establishing quantum connections...',
            'Initializing neural networks...',
            'Syncing with SRM matrix...',
            'Loading academic algorithms...',
            'Preparing holographic interface...',
            'Finalizing neural pathways...'
        ];
        let messageIndex = 0;
        let loadingTimeout = null;

        // =================== ENHANCED INITIALIZATION =================== 
        document.addEventListener('DOMContentLoaded', initializeNeuralApp);

        async function initializeNeuralApp() {
            try {
                console.log('🚀 Initializing Academic Hub X Neural Interface...');
                
                // Set loading timeout to prevent infinite loading
                loadingTimeout = setTimeout(() => {
                    console.warn('⚠️ Loading timeout, showing app anyway');
                    hideLoadingScreen();
                    showLanding();
                }, 15000); // 15 seconds timeout
                
                // Enhanced loading sequence with messages
                const statusElement = document.getElementById('loadingStatus');
                const loadingInterval = setInterval(() => {
                    if (messageIndex < loadingMessages.length) {
                        statusElement.textContent = loadingMessages[messageIndex];
                        messageIndex++;
                    } else {
                        clearInterval(loadingInterval);
                    }
                }, 800);
                
                // Apply saved theme immediately
                applyQuantumTheme();
                
                // Initialize core systems
                await initializeSupabase();
                await initializeDatabase();
                await setupEventListeners();
                await setupPWA();
                
                // Check authentication
                const user = await checkSession();
                
                // Clear intervals and timeout
                clearInterval(loadingInterval);
                clearTimeout(loadingTimeout);
                
                setTimeout(async () => {
                    hideLoadingScreen();
                    
                    if (!user) {
                        showLanding();
                    } else {
                        AHX.state.user = user;
                        await setupUserData();
                        showApp();
                    }
                }, 2500); // Enhanced loading experience
                
                console.log('✅ Neural interface initialization complete');
                
            } catch (error) {
                console.error('❌ Neural initialization failed:', error);
                clearTimeout(loadingTimeout);
                setTimeout(() => {
                    hideLoadingScreen();
                    showLanding();
                }, 2000);
                showNotification('Failed to initialize app. Please refresh the page.', 'error');
            }
        }

        // =================== SUPABASE INTEGRATION WITH ERROR HANDLING =================== 
        async function initializeSupabase() {
            try {
                if (typeof window.supabase !== 'undefined') {
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON, {
                        auth: {
                            autoRefreshToken: true,
                            persistSession: true,
                            detectSessionInUrl: false,
                            flowType: 'pkce'
                        },
                        global: {
                            fetch: async (input, init) => {
                                if (!navigator.onLine) {
                                    throw new Error('No internet connection');
                                }
                                return fetch(input, init);
                            }
                        }
                    });
                    
                    // Setup auth state listener
                    supabase.auth.onAuthStateChange((event, session) => {
                        console.log('🔐 Auth state changed:', event);
                        
                        switch (event) {
                            case 'SIGNED_IN':
                                if (session?.user) {
                                    const userData = {
                                        id: session.user.id,
                                        email: session.user.email,
                                        name: session.user.user_metadata?.full_name || session.user.email.split('@')[0],
                                        regNumber: session.user.user_metadata?.regNumber || 'SRM Student'
                                    };
                                    
                                    localStorage.setItem('ahx_user', JSON.stringify(userData));
                                    AHX.state.user = userData;
                                }
                                break;
                                
                            case 'SIGNED_OUT':
                                localStorage.removeItem('ahx_user');
                                AHX.state.user = null;
                                break;
                                
                            case 'TOKEN_REFRESHED':
                                console.log('🔄 Token refreshed successfully');
                                break;
                        }
                    });
                    
                    // Setup real-time subscriptions
                    await setupRealtimeSync();
                    
                    console.log('✅ Supabase neural connection established');
                } else {
                    console.warn('⚠️ Supabase library not available, using offline mode');
                }
            } catch (error) {
                console.warn('⚠️ Supabase initialization failed, using offline mode:', error);
            }
        }

        async function setupRealtimeSync() {
            if (!supabase) return;
            
            try {
                AHX.state.realtimeChannel = supabase
                    .channel('academic_hub_sync')
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'files'
                    }, handleRealtimeUpdate)
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'timetables'
                    }, handleTimetableUpdate)
                    .subscribe();
                    
                console.log('🔄 Real-time sync activated');
            } catch (error) {
                console.warn('Real-time setup failed:', error);
            }
        }

        function handleRealtimeUpdate(payload) {
            try {
                const { eventType, new: newRecord, old: oldRecord } = payload;
                
                switch (eventType) {
                    case 'INSERT':
                        if (newRecord.user_id === AHX.state.user?.id) {
                            AHX.state.files.unshift(transformFileRecord(newRecord));
                            showNotification('📄 New file synced from neural network!', 'success');
                            refreshCurrentView();
                        }
                        break;
                        
                    case 'UPDATE':
                        const updateIndex = AHX.state.files.findIndex(f => f.id === newRecord.id);
                        if (updateIndex !== -1) {
                            AHX.state.files[updateIndex] = transformFileRecord(newRecord);
                            showNotification('📄 File updated via neural sync!', 'info');
                            refreshCurrentView();
                        }
                        break;
                        
                    case 'DELETE':
                        AHX.state.files = AHX.state.files.filter(f => f.id !== oldRecord.id);
                        showNotification('🗑️ File removed from neural network!', 'warning');
                        refreshCurrentView();
                        break;
                }
            } catch (error) {
                console.error('Real-time update error:', error);
            }
        }

        function handleTimetableUpdate(payload) {
            if (payload.new?.user_id === AHX.state.user?.id) {
                AHX.state.timetable = payload.new;
                showNotification('🗓️ Timetable updated in real-time!', 'info');
                if (AHX.state.currentView === 'timetable') {
                    refreshCurrentView();
                }
            }
        }

        function transformFileRecord(record) {
            return {
                id: record.id,
                name: record.name,
                subjectKey: record.subject_key,
                type: record.file_type,
                size: record.file_size,
                addedAt: new Date(record.created_at).getTime(),
                description: record.description,
                publicUrl: record.public_url,
                isCloudStored: true
            };
        }

        // =================== DATABASE OPERATIONS WITH INDEXEDDB =================== 
        async function initializeDatabase() {
            try {
                AHX.state.db = await openIndexedDB();
                console.log('✅ Neural database initialized');
            } catch (error) {
                console.warn('⚠️ Database initialization failed:', error);
            }
        }

        function openIndexedDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('ahx_neural_db', 6);
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    
                    // Files store
                    if (!db.objectStoreNames.contains('files')) {
                        const filesStore = db.createObjectStore('files', { keyPath: 'id' });
                        filesStore.createIndex('by_subject', 'subjectKey', { unique: false });
                        filesStore.createIndex('by_date', 'addedAt', { unique: false });
                        filesStore.createIndex('by_type', 'type', { unique: false });
                    }
                    
                    // Settings store
                    if (!db.objectStoreNames.contains('settings')) {
                        db.createObjectStore('settings', { keyPath: 'key' });
                    }
                    
                    // Sync log store
                    if (!db.objectStoreNames.contains('sync_log')) {
                        const syncStore = db.createObjectStore('sync_log', { keyPath: 'id', autoIncrement: true });
                        syncStore.createIndex('by_timestamp', 'timestamp', { unique: false });
                    }
                    
                    // Timetable store
                    if (!db.objectStoreNames.contains('timetables')) {
                        db.createObjectStore('timetables', { keyPath: 'id' });
                    }
                };
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        // =================== AUTHENTICATION SYSTEM WITH REAL SUPABASE =================== 
        async function handleSignIn(event) {
            event.preventDefault();
            const email = document.getElementById('signin-email').value.trim();
            const password = document.getElementById('signin-password').value;
            const button = document.getElementById('signinBtn');
            const span = button.querySelector('span');
            
            setButtonLoading(button, span, 'Establishing neural link...');
            clearAuthMessages();
            
            try {
                if (!supabase) {
                    // Offline mode fallback
                    const mockUser = {
                        id: 'offline_' + Date.now(),
                        email: email,
                        name: email.split('@')[0],
                        regNumber: 'SRM' + Date.now().toString(36).toUpperCase()
                    };
                    
                    localStorage.setItem('ahx_user', JSON.stringify(mockUser));
                    AHX.state.user = mockUser;
                    
                    showAuthMessage('Neural link established in offline mode!', 'success');
                    setTimeout(() => {
                        closeAuth();
                        showApp();
                        showNotification(`Welcome to the neural network, ${mockUser.name}!`, 'success');
                    }, 2000);
                    return;
                }
                
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                });
                
                if (error) throw error;
                
                if (data?.user && data?.session) {
                    const userData = {
                        id: data.user.id,
                        email: data.user.email,
                        name: data.user.user_metadata?.full_name || data.user.email.split('@')[0],
                        regNumber: data.user.user_metadata?.regNumber || 'SRM Student'
                    };
                    
                    localStorage.setItem('ahx_user', JSON.stringify(userData));
                    AHX.state.user = userData;
                    
                    showAuthMessage('Neural link established! Initializing quantum interface...', 'success');
                    
                    setTimeout(() => {
                        closeAuth();
                        showApp();
                        showNotification(`Welcome to the neural network, ${userData.name}!`, 'success');
                    }, 2000);
                }
                
            } catch (error) {
                console.error('Authentication error:', error);
                let message = error.message;
                
                if (message.includes('Invalid login credentials')) {
                    message = 'Neural authentication failed. Please verify your quantum credentials.';
                } else if (message.includes('Email not confirmed')) {
                    message = 'Please confirm your email address before signing in.';
                }
                
                showAuthMessage(message, 'error');
            } finally {
                setButtonLoading(button, span, 'Establish Neural Link', false);
            }
        }

        async function handleSignUp(event) {
            event.preventDefault();
            const name = document.getElementById('signup-name').value.trim();
            const email = document.getElementById('signup-email').value.trim();
            const password = document.getElementById('signup-password').value;
            const button = document.getElementById('signupBtn');
            const span = button.querySelector('span');
            
            setButtonLoading(button, span, 'Initializing neural core...');
            clearAuthMessages();
            
            try {
                if (!supabase) {
                    // Offline mode fallback
                    const mockUser = {
                        id: 'offline_' + Date.now(),
                        email: email,
                        name: name,
                        regNumber: 'SRM' + Date.now().toString(36).toUpperCase()
                    };
                    
                    localStorage.setItem('ahx_user', JSON.stringify(mockUser));
                    AHX.state.user = mockUser;
                    
                    showAuthMessage('Neural core initialized in offline mode!', 'success');
                    setTimeout(() => {
                        closeAuth();
                        showApp();
                        showNotification(`Welcome to the neural network, ${mockUser.name}!`, 'success');
                    }, 2000);
                    return;
                }
                
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password,
                    options: {
                        data: {
                            full_name: name,
                            regNumber: 'SRM_' + Date.now().toString(36).toUpperCase()
                        }
                    }
                });
                
                if (error) throw error;
                
                if (data?.user) {
                    if (data.user.email_confirmed_at) {
                        const userData = {
                            id: data.user.id,
                            email: data.user.email,
                            name: name,
                            regNumber: data.user.user_metadata?.regNumber || 'SRM Student'
                        };
                        
                        localStorage.setItem('ahx_user', JSON.stringify(userData));
                        AHX.state.user = userData;
                        
                        showAuthMessage('Neural core initialized! Welcome to the network!', 'success');
                        setTimeout(() => {
                            closeAuth();
                            showApp();
                            showNotification(`Welcome to the neural network, ${userData.name}!`, 'success');
                        }, 2000);
                    } else {
                        showAuthMessage('Neural core initialized! Please verify your quantum email to complete the process.', 'success');
                        setTimeout(() => switchAuthTab('signin'), 3000);
                    }
                }
                
            } catch (error) {
                console.error('Registration error:', error);
                let message = error.message;
                
                if (message.includes('User already registered')) {
                    message = 'Neural identity already exists. Please use the sign in portal.';
                }
                
                showAuthMessage(message, 'error');
            } finally {
                setButtonLoading(button, span, 'Initialize Neural Core', false);
            }
        }

        async function checkSession() {
            try {
                const localUser = localStorage.getItem('ahx_user');
                if (localUser) {
                    return JSON.parse(localUser);
                }
                
                if (supabase) {
                    const { data: { session } } = await supabase.auth.getSession();
                    if (session?.user) {
                        const userData = {
                            id: session.user.id,
                            email: session.user.email,
                            name: session.user.user_metadata?.full_name || session.user.email.split('@')[0],
                            regNumber: session.user.user_metadata?.regNumber || 'SRM Student'
                        };
                        localStorage.setItem('ahx_user', JSON.stringify(userData));
                        return userData;
                    }
                }
                
                return null;
            } catch (error) {
                console.error('Session check failed:', error);
                return null;
            }
        }

        // =================== UI MANAGEMENT FUNCTIONS =================== 
        function hideLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) {
                loadingScreen.classList.add('hidden');
            }
        }

        function showLanding() {
            document.getElementById('landingPage').classList.remove('hidden');
            document.getElementById('app').classList.add('hidden');
        }

        function showApp() {
            document.getElementById('landingPage').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            updateUserDisplay();
            navigateTo('dashboard');
        }

        function updateUserDisplay() {
            if (AHX.state.user) {
                const userName = AHX.state.user.name || 'Neural User';
                document.getElementById('sidebarUserName').textContent = userName;
                document.getElementById('userInitial').textContent = userName.charAt(0).toUpperCase();
            }
        }

        // =================== NAVIGATION SYSTEM =================== 
        function navigateTo(view) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-route') === view) {
                    item.classList.add('active');
                }
            });
            
            AHX.state.currentView = view;
            renderView(view);
            closeMobileMenu();
            
            window.location.hash = view;
        }

        async function renderView(view) {
            const content = document.getElementById('viewContent');
            
            content.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 4rem 2rem; text-align: center;">
                    <div style="width: 60px; height: 60px; border: 4px solid rgba(102, 126, 234, 0.2); border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 2rem;"></div>
                    <span style="color: var(--text-secondary); font-size: 1.1rem;">Loading neural ${view} interface...</span>
                </div>
            `;
            
                        if (!document.querySelector('#spinAnimation')) {
                const style = document.createElement('style');
                style.id = 'spinAnimation';
                style.textContent = '@keyframes spin { to { transform: rotate(360deg); } }';
                document.head.appendChild(style);
            }
            
            try {
                let html = '';
                
                switch (view) {
                    case 'dashboard':
                        html = await renderNeuralDashboard();
                        break;
                    case 'subjects':
                        html = await renderSubjectMatrix();
                        break;
                    case 'files':
                        html = await renderFileQuantum();
                        break;
                    case 'search':
                        html = renderNeuralSearch();
                        break;
                    case 'qr':
                        html = renderQRNeuralScan();
                        break;
                    case 'timetable':
                        html = renderTimeMatrix();
                        break;
                    case 'settings':
                        html = renderNeuralSettings();
                        break;
                    default:
                        html = await renderNeuralDashboard();
                }
                
                content.innerHTML = html;
                
            } catch (error) {
                console.error('Render error:', error);
                content.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 4rem 2rem; text-align: center;">
                        <div style="font-size: 4rem; margin-bottom: 2rem; opacity: 0.6;">⚠️</div>
                        <h3 style="color: var(--text-primary); margin-bottom: 1rem; font-size: 1.5rem;">Neural Interface Error</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 2rem; line-height: 1.6;">Failed to load quantum interface. Please refresh the neural connection.</p>
                        <button class="btn btn-primary" onclick="location.reload()">Restart Neural Interface</button>
                    </div>
                `;
            }
        }

        // =================== VIEW RENDERERS WITH FULL FUNCTIONALITY =================== 
        async function renderNeuralDashboard() {
            const totalFiles = AHX.state.files.length;
            const totalSize = AHX.state.files.reduce((sum, file) => sum + (file.size || 0), 0);
            const recentFiles = AHX.state.files.slice(0, 3);
            const weeklyFiles = AHX.state.files.filter(f => Date.now() - f.addedAt < 7 * 24 * 60 * 60 * 1000).length;
            
            const today = new Date().toLocaleDateString('en-IN', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            return `
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Neural Dashboard</h1>
                        <p class="page-subtitle">Welcome to the quantum academic interface, ${AHX.state.user?.name || 'Neural User'}! Today is ${today}</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="toggleQuantumTheme()" title="Toggle Neural Theme">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="5"/>
                                <line x1="12" y1="1" x2="12" y2="3"/>
                                <line x1="12" y1="21" x2="12" y2="23"/>
                                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                                <line x1="1" y1="12" x2="3" y2="12"/>
                                <line x1="21" y1="12" x2="23" y2="12"/>
                                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                            </svg>
                        </button>
                        <button class="btn btn-primary" onclick="openUploadModal()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="7,10 12,15 17,10"/>
                                <line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                            Neural Upload
                        </button>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card" onclick="navigateTo('files')">
                        <div class="stat-header">
                            <div class="stat-icon">📁</div>
                        </div>
                        <div class="stat-value">${totalFiles}</div>
                        <div class="stat-label">Quantum Files</div>
                        <div class="stat-change">Neural Archive Active</div>
                    </div>
                    
                    <div class="stat-card" onclick="navigateTo('subjects')">
                        <div class="stat-header">
                            <div class="stat-icon">🧠</div>
                        </div>
                        <div class="stat-value">${AHX.state.subjects.length}</div>
                        <div class="stat-label">Neural Subjects</div>
                        <div class="stat-change">SRM Matrix Synced</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon">⚡</div>
                        </div>
                        <div class="stat-value">${formatBytes(totalSize)}</div>
                        <div class="stat-label">Quantum Storage</div>
                        <div class="stat-change">Cloud + Neural Cache</div>
                    </div>
                    
                    <div class="stat-card" onclick="navigateTo('qr')">
                        <div class="stat-header">
                            <div class="stat-icon">📱</div>
                        </div>
                        <div class="stat-value">${weeklyFiles}</div>
                        <div class="stat-label">Weekly Scans</div>
                        <div class="stat-change">Smart Board Integration</div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-top: 2rem;">
                    <div class="card">
                        <h3 style="margin-bottom: 2rem; color: var(--text-primary); font-family: var(--font-display); font-weight: 700;">Recent Neural Activity</h3>
                        ${recentFiles.length > 0 ? recentFiles.map(file => `
                            <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(255, 255, 255, 0.03); border-radius: var(--radius-lg); margin-bottom: 1rem; cursor: pointer; transition: var(--transition-normal);" onclick="openFile('${file.id}')">
                                <div style="width: 48px; height: 48px; background: var(--gradient-accent); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">
                                    ${getFileIcon(file.type)}
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.25rem;">${file.name}</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">${getSubjectName(file.subjectKey)} • ${formatDate(file.addedAt)}</div>
                                </div>
                            </div>
                        `).join('') : `
                            <div style="text-align: center; padding: 3rem;">
                                <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.6;">🧠</div>
                                <h4 style="color: var(--text-primary); margin-bottom: 1rem;">Neural Network Empty</h4>
                                <p style="color: var(--text-secondary); margin-bottom: 2rem;">Upload your first file to begin neural processing</p>
                                <button class="btn btn-primary" onclick="openUploadModal()">Initialize Neural Upload</button>
                            </div>
                        `}
                    </div>
                    
                    <div class="card">
                        <h3 style="margin-bottom: 2rem; color: var(--text-primary); font-family: var(--font-display); font-weight: 700;">Quantum Actions</h3>
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            <button class="btn btn-primary" onclick="openUploadModal()" style="justify-content: flex-start; width: 100%;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7,10 12,15 17,10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Neural File Upload
                            </button>
                            
                            <button class="btn btn-secondary" onclick="navigateTo('qr')" style="justify-content: flex-start; width: 100%;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M23 7l-7-7-3 3 7 7 3-3z"/>
                                    <path d="M20.1 20.1l-2.3-2.3m-6.4 6.4L9 21.8 3 15.8l2.4-2.4"/>
                                </svg>
                                QR Neural Scan
                            </button>
                            
                            <button class="btn btn-secondary" onclick="navigateTo('timetable')" style="justify-content: flex-start; width: 100%;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                    <line x1="16" y1="2" x2="16" y2="6"/>
                                    <line x1="8" y1="2" x2="8" y2="6"/>
                                    <line x1="3" y1="10" x2="21" y2="10"/>
                                </svg>
                                Time Matrix Access
                            </button>
                        </div>
                        
                        <div style="margin-top: 2rem; padding: 1.5rem; background: var(--gradient-primary); border-radius: var(--radius-2xl); color: white;">
                            <h4 style="margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;">
                                <span>🧠</span> Neural Tip
                            </h4>
                            <p style="margin: 0; line-height: 1.6; font-size: 0.9rem;">
                                Use QR Neural Scan during lectures to instantly capture and organize smart board content. Your files are automatically processed through our quantum algorithms!
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        async function renderSubjectMatrix() {
            const subjectStats = {};
            AHX.state.files.forEach(file => {
                if (!subjectStats[file.subjectKey]) {
                    subjectStats[file.subjectKey] = { count: 0, size: 0, recent: 0 };
                }
                subjectStats[file.subjectKey].count++;
                subjectStats[file.subjectKey].size += file.size || 0;
                if (Date.now() - file.addedAt < 7 * 24 * 60 * 60 * 1000) {
                    subjectStats[file.subjectKey].recent++;
                }
            });
            
            return `
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Subject Matrix</h1>
                        <p class="page-subtitle">Neural Academic Network • SRM KTR Quantum Campus</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="openAddSubjectModal()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"/>
                                <line x1="5" y1="12" x2="19" y2="12"/>
                            </svg>
                            Add Neural Subject
                        </button>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem;">
                    ${AHX.state.subjects.map(subject => {
                        const stats = subjectStats[subject.key] || { count: 0, size: 0, recent: 0 };
                        return `
                            <div class="card" onclick="navigateToSubject('${subject.key}')" style="cursor: pointer; transition: var(--transition-normal);">
                                <div style="display: flex; align-items: center; gap: 1.5rem; margin-bottom: 2rem;">
                                    <div style="width: 60px; height: 60px; background: var(--gradient-accent); border-radius: var(--radius-2xl); display: flex; align-items: center; justify-content: center; font-size: 2rem; box-shadow: var(--shadow-neural); animation: statIconFloat 4s ease-in-out infinite;">
                                        ${subject.icon}
                                    </div>
                                    <div style="flex: 1;">
                                        <h3 style="margin: 0 0 0.5rem 0; font-size: 1.4rem; font-weight: 700; color: var(--text-primary);">${subject.name}</h3>
                                        <p style="margin: 0; color: var(--text-secondary); font-weight: 500;">${subject.code}</p>
                                        <p style="margin: 0.25rem 0 0 0; color: var(--text-tertiary); font-size: 0.85rem;">${subject.faculty}</p>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                                    <div style="text-align: center; padding: 1rem; background: rgba(102, 126, 234, 0.1); border-radius: var(--radius-lg);">
                                        <div style="font-size: 1.8rem; font-weight: 800; color: var(--primary);">${stats.count}</div>
                                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem;">Neural Files</div>
                                    </div>
                                    <div style="text-align: center; padding: 1rem; background: rgba(0, 230, 118, 0.1); border-radius: var(--radius-lg);">
                                        <div style="font-size: 1.8rem; font-weight: 800; color: var(--success);">${formatBytes(stats.size)}</div>
                                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem;">Quantum Size</div>
                                    </div>
                                    <div style="text-align: center; padding: 1rem; background: rgba(255, 167, 38, 0.1); border-radius: var(--radius-lg);">
                                        <div style="font-size: 1.8rem; font-weight: 800; color: var(--warning);">${stats.recent}</div>
                                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem;">This Week</div>
                                    </div>
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                            <circle cx="12" cy="10" r="3"/>
                                        </svg>
                                        <span>${subject.room}</span>
                                    </div>
                                    <button class="btn btn-primary btn-sm" onclick="event.stopPropagation(); openUploadModal('${subject.key}')" style="padding: 0.5rem 1rem; font-size: 0.85rem;">
                                        Neural Upload
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function renderFileQuantum() {
            return `
                <div class="page-header">
                    <div>
                        <h1 class="page-title">File Quantum</h1>
                        <p class="page-subtitle">Neural file management across the quantum academic network (${AHX.state.files.length} files in quantum storage)</p>
                    </div>
                    <div class="header-actions">
                        <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                            <select onchange="filterQuantumFiles(this.value)" class="form-select" style="width: auto; padding: 0.75rem 1rem; background: var(--glass-bg); backdrop-filter: blur(20px); border: 2px solid var(--glass-border);">
                                <option value="">All Neural Subjects</option>
                                ${AHX.state.subjects.map(subject => `
                                    <option value="${subject.key}">${subject.name}</option>
                                `).join('')}
                            </select>
                            <button class="btn btn-primary" onclick="openUploadModal()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7,10 12,15 17,10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Neural Upload
                            </button>
                        </div>
                    </div>
                </div>
                
                ${AHX.state.files.length > 0 ? `
                    <div id="filesQuantumGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 2rem;">
                        ${AHX.state.files.map(file => `
                            <div class="card" onclick="openFile('${file.id}')" data-subject="${file.subjectKey}" style="cursor: pointer; transition: var(--transition-normal);">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                                    <div style="width: 60px; height: 60px; background: var(--gradient-accent); border-radius: var(--radius-2xl); display: flex; align-items: center; justify-content: center; font-size: 2rem; box-shadow: var(--shadow-neural); animation: statIconFloat 4s ease-in-out infinite;">
                                        ${getFileIcon(file.type)}
                                    </div>
                                    <div style="flex: 1; min-width: 0;">
                                        <div style="font-weight: 700; font-size: 1.1rem; color: var(--text-primary); margin-bottom: 0.5rem; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                            ${file.name}
                                        </div>
                                        <div style="display: flex; flex-direction: column; gap: 0.25rem; font-size: 0.85rem;">
                                            <div style="color: var(--primary); font-weight: 600;">${formatBytes(file.size)}</div>
                                            <div style="color: var(--text-secondary);">${formatDate(file.addedAt)}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                ${file.description ? `
                                    <div style="margin-bottom: 1rem; padding: 1rem; background: rgba(102, 126, 234, 0.05); border-radius: var(--radius-lg); font-size: 0.9rem; color: var(--text-secondary); line-height: 1.5; border-left: 4px solid var(--primary);">
                                        ${file.description}
                                    </div>
                                ` : ''}
                                
                                <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 2px solid rgba(255, 255, 255, 0.1);">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="padding: 0.5rem 1rem; background: var(--gradient-primary); color: white; border-radius: var(--radius-full); font-size: 0.8rem; font-weight: 600; display: flex; align-items: center; gap: 0.25rem;">
                                            ${getSubjectIcon(file.subjectKey)}
                                            ${getSubjectName(file.subjectKey)}
                                        </span>
                                        ${file.qrData ? '<span style="padding: 0.25rem 0.5rem; background: var(--gradient-accent); color: white; border-radius: var(--radius-sm); font-size: 0.7rem; font-weight: 600;">🧠 Neural Scanned</span>' : ''}
                                    </div>
                                    <button onclick="event.stopPropagation(); deleteFile('${file.id}')" class="btn btn-secondary" style="padding: 0.5rem; font-size: 1.1rem; background: rgba(255, 87, 34, 0.1); color: var(--error); border: 2px solid rgba(255, 87, 34, 0.2);" title="Delete from quantum storage">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="3,6 5,6 21,6"/>
                                            <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                ` : `
                    <div style="text-align: center; padding: 4rem 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 2rem; opacity: 0.6;">📁</div>
                        <h3 style="color: var(--text-primary); margin-bottom: 1rem; font-size: 1.5rem;">Quantum Storage Empty</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 2rem; line-height: 1.6;">Upload your first files to initialize the neural file management system</p>
                        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                            <button class="btn btn-primary btn-lg" onclick="openUploadModal()">Initialize Upload</button>
                            <button class="btn btn-secondary btn-lg" onclick="navigateTo('qr')">Scan QR Code</button>
                        </div>
                    </div>
                `}
            `;
        }

        function renderNeuralSearch() {
            return `
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Neural Search</h1>
                        <p class="page-subtitle">Quantum file discovery powered by advanced algorithms</p>
                    </div>
                </div>
                
                <div class="card" style="margin-bottom: 2rem;">
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <div style="flex: 1; position: relative;">
                            <input type="search" id="searchInput" placeholder="Enter neural search query..." 
                                   class="form-input" style="padding-left: 3rem;" oninput="performNeuralSearch()" autofocus>
                            <svg style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-tertiary);" 
                                 width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                            </svg>
                        </div>
                        <button class="btn btn-primary" onclick="performNeuralSearch()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                            </svg>
                            Neural Search
                        </button>
                    </div>
                    <div style="margin-top: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center;">
                        <span style="font-size: 0.9rem; color: var(--text-secondary);">Quantum filters:</span>
                        ${AHX.state.subjects.slice(0, 4).map(subject => `
                            <button class="btn btn-secondary btn-sm" onclick="quickNeuralSearch('${subject.name}')" 
                                    style="padding: 0.5rem 1rem; font-size: 0.8rem; background: rgba(102, 126, 234, 0.1);">
                                ${subject.icon} ${subject.name.split(' ')[0]}
                            </button>
                        `).join('')}
                    </div>
                </div>
                
                <div id="searchResults">
                    <div style="text-align: center; padding: 4rem 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 2rem; opacity: 0.6;">🧠</div>
                        <h3 style="color: var(--text-primary); margin-bottom: 1rem; font-size: 1.5rem;">Neural Search Ready</h3>
                        <p style="color: var(--text-secondary); line-height: 1.6;">Enter your query to activate the quantum search algorithms</p>
                    </div>
                </div>
            `;
        }

        function renderQRNeuralScan() {
            return `
                <div class="page-header">
                    <div>
                        <h1 class="page-title">QR Neural Scanner</h1>
                        <p class="page-subtitle">Advanced quantum QR code processing with mobile AI integration</p>
                    </div>
                </div>
                
                <div class="card">
                    <div style="text-align: center; padding: 2rem;">
                        <div style="width: 120px; height: 120px; background: var(--gradient-primary); border-radius: var(--radius-3xl); display: flex; align-items: center; justify-content: center; margin: 0 auto 2rem auto; font-size: 3rem; animation: qrIconFloat 3s ease-in-out infinite;">
                            📱
                        </div>
                        <h3 style="margin-bottom: 1rem; color: var(--text-primary); font-family: var(--font-display); font-weight: 700;">Neural QR Scanner Active</h3>
                        <p style="margin: 0 0 2rem 0; color: var(--text-secondary); line-height: 1.6; max-width: 500px; margin-left: auto; margin-right: auto;">
                            Point your device camera at QR codes from smart boards to instantly capture and organize academic content using advanced neural processing
                        </p>
                        
                        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; margin-bottom: 2rem;">
                            <button class="btn btn-primary btn-lg" onclick="startNeuralQRScan()" id="qrScanBtn">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M23 7l-7-7-3 3 7 7 3-3z"/>
                                    <path d="M20.1 20.1l-2.3-2.3m-6.4 6.4L9 21.8 3 15.8l2.4-2.4"/>
                                </svg>
                                <span>Activate Neural Scanner</span>
                            </button>
                            
                            <button class="btn btn-secondary btn-lg" onclick="uploadQRImage()">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                    <circle cx="9" cy="9" r="2"/>
                                    <path d="M21 15l-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
                                </svg>
                                Upload QR Image
                            </button>
                            
                            <button class="btn btn-secondary btn-lg" onclick="openUploadModal()">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7,10 12,15 17,10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                Direct Upload
                            </button>
                        </div>
                        
                        <div class="qr-scanner-container" id="qrContainer" style="display: none; margin: 2rem 0;">
                            <div id="qr-reader"></div>
                            <div class="qr-status" id="qrStatus">
                                Neural scanner initializing...
                            </div>
                        </div>
                    </div>
                    
                    <div style="padding: 2rem; background: var(--gradient-primary); border-radius: var(--radius-2xl); color: white; margin-top: 2rem;">
                        <h4 style="margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem; color: white;">
                            <span>🧠</span> Neural QR Integration Protocol
                        </h4>
                        <ol style="margin: 0; padding-left: 1.2rem; line-height: 1.8; color: rgba(255, 255, 255, 0.9);">
                            <li>Professor displays QR code on smart board after lecture</li>
                            <li>Activate neural scanner and point camera at QR code</li>
                            <li>AI automatically processes and categorizes content</li>
                            <li>Content is instantly organized by subject and date</li>
                            <li>Files sync across all your devices via quantum network</li>
                        </ol>
                        
                        <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(255, 255, 255, 0.1); border-radius: var(--radius-lg); backdrop-filter: blur(10px);">
                            <p style="margin: 0; font-size: 0.9rem; color: rgba(255, 255, 255, 0.8);">
                                <strong>🔬 Advanced Features:</strong> Auto-subject detection, OCR text extraction, duplicate prevention, and smart file naming using neural algorithms
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTimeMatrix() {
            const timeSlots = [
                '08:00-08:50', '08:50-09:40', '09:45-10:35', '10:40-11:30',
                '11:35-12:25', '12:30-01:20', '01:25-02:15', '02:20-03:10',
                '03:10-04:00', '04:00-04:50', '04:50-05:30', '05:30-06:10'
            ];
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            
            return `
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Time Matrix</h1>
                        <p class="page-subtitle">Neural Academic Schedule Interface • SRM KTR Batch 2</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="openTimeMatrixSetup()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                            Configure Matrix
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div style="margin-bottom: 2rem;">
                        <h3 style="margin: 0; color: var(--text-primary); font-family: var(--font-display); font-weight: 700; display: flex; align-items: center; gap: 1rem;">
                            <span style="width: 48px; height: 48px; background: var(--gradient-accent); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">🗓️</span>
                            Neural Time Matrix - SRM KTR Campus
                        </h3>
                    </div>
                    
                    <div class="timetable-container">
                        <table class="timetable-table">
                            <thead>
                                <tr class="timetable-header">
                                    <th style="padding: 1.5rem 1rem; text-align: left; position: sticky; left: 0; z-index: 10; min-width: 140px;">Neural Time</th>
                                    ${days.map(day => `
                                        <th style="padding: 1.5rem 1rem; text-align: center; min-width: 160px;">${day}</th>
                                    `).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                ${timeSlots.map((time, timeIndex) => `
                                    <tr>
                                        <td class="timetable-cell" style="font-weight: 700; background: var(--bg-secondary); position: sticky; left: 0; z-index: 5; border-right: 2px solid rgba(102, 126, 234, 0.3);">${time}</td>
                                        ${days.map((day, dayIndex) => {
                                            const dayKey = `Day${dayIndex + 1}`;
                                            const slotData = AHX.state.srmTimetableSlots[dayKey] && AHX.state.srmTimetableSlots[dayKey][timeIndex + 1];
                                            const subject = getSubjectForSlot(slotData);
                                            
                                            let slotStyle = 'background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(102, 126, 234, 0.05)); border-left: 4px solid var(--primary);';
                                            
                                            if (slotData && slotData.startsWith('P')) {
                                                slotStyle = 'background: linear-gradient(135deg, rgba(0, 230, 118, 0.1), rgba(0, 230, 118, 0.05)); border-left: 4px solid var(--success);';
                                            } else if (slotData && slotData.startsWith('L')) {
                                                slotStyle = 'background: linear-gradient(135deg, rgba(255, 167, 38, 0.1), rgba(255, 167, 38, 0.05)); border-left: 4px solid var(--warning);';
                                            } else if (!subject) {
                                                slotStyle = 'background: var(--bg-tertiary); border-left: 4px solid var(--text-tertiary);';
                                            }
                                            
                                            return `
                                                <td class="timetable-cell" style="${slotStyle}">
                                                    <div style="display: flex; flex-direction: column; align-items: center; gap: 0.5rem; line-height: 1.4;">
                                                        ${subject ? `
                                                            <div style="font-weight: 700; font-size: 1rem; color: var(--text-primary);">${subject.name.split(' ').slice(0, 2).join(' ')}</div>
                                                            <div style="font-size: 0.8rem; color: var(--text-accent); background: rgba(102, 126, 234, 0.1); padding: 0.25rem 0.5rem; border-radius: var(--radius-sm);">${subject.code}</div>
                                                            <div style="font-size: 0.75rem; color: var(--text-secondary);">${subject.faculty?.split(' ').slice(0, 2).join(' ') || 'Neural Faculty'}</div>
                                                            <div style="font-size: 0.7rem; color: var(--text-tertiary); display: flex; align-items: center; gap: 0.25rem;">
                                                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                                                    <circle cx="12" cy="10" r="3"/>
                                                                </svg>
                                                                ${subject.room || 'Neural Lab'}
                                                            </div>
                                                        ` : `
                                                            <div style="font-weight: 600; font-size: 1rem; color: var(--text-secondary);">${slotData || 'Free Neural Slot'}</div>
                                                            ${slotData && slotData.startsWith('L') ? '<div style="font-size: 0.8rem; color: var(--warning);">🍽️ Neural Break</div>' : ''}
                                                        `}
                                                    </div>
                                                </td>
                                            `;
                                        }).join('')}
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="margin-top: 2rem; display: flex; gap: 2rem; flex-wrap: wrap; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 20px; height: 20px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), var(--primary)); border-radius: 4px;"></div>
                            <span style="font-size: 0.9rem; color: var(--text-secondary);">Neural Theory</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 20px; height: 20px; background: linear-gradient(135deg, rgba(0, 230, 118, 0.2), var(--success)); border-radius: 4px;"></div>
                            <span style="font-size: 0.9rem; color: var(--text-secondary);">Quantum Labs</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 20px; height: 20px; background: linear-gradient(135deg, rgba(255, 167, 38, 0.2), var(--warning)); border-radius: 4px;"></div>
                            <span style="font-size: 0.9rem; color: var(--text-secondary);">Neural Breaks</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="width: 20px; height: 20px; background: var(--bg-tertiary); border-radius: 4px;"></div>
                            <span style="font-size: 0.9rem; color: var(--text-secondary);">Free Slots</span>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 2rem; padding: 2rem; background: var(--gradient-accent); border-radius: var(--radius-3xl); color: white;">
                    <h4 style="margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem; font-family: var(--font-display); font-weight: 700;">
                        <span>🧠</span> Neural Integration Active
                    </h4>
                    <p style="margin: 0; line-height: 1.6; font-size: 1rem;">
                        Your time matrix is fully integrated with the QR scanner and file quantum. Scan QR codes during neural breaks 
                        to automatically organize content by subject and time slot using advanced AI algorithms!
                    </p>
                </div>
            `;
        }

        function renderNeuralSettings() {
            const totalFiles = AHX.state.files.length;
            const totalSize = AHX.state.files.reduce((sum, file) => sum + (file.size || 0), 0);
            
            return `
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Neural Settings</h1>
                        <p class="page-subtitle">Configure your quantum academic interface preferences</p>
                    </div>
                </div>
                
                <div style="display: grid; gap: 2rem;">
                    <div class="card">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                            <div style="width: 60px; height: 60px; background: var(--gradient-primary); border-radius: var(--radius-2xl); display: flex; align-items: center; justify-content: center; font-size: 2rem;">
                                👤
                            </div>
                            <div>
                                <h3 style="margin: 0; color: var(--text-primary); font-family: var(--font-display); font-weight: 700;">Neural Identity</h3>
                                <p style="margin: 0.5rem 0 0 0; color: var(--text-secondary);">Your quantum academic profile</p>
                            </div>
                        </div>
                        <div style="display: grid; gap: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 1.5rem; background: var(--glass-bg); backdrop-filter: blur(20px); border-radius: var(--radius-xl); border: 2px solid var(--glass-border);">
                                <div>
                                    <div style="font-weight: 700; color: var(--text-primary); margin-bottom: 0.25rem;">Neural Name</div>
                                    <div style="color: var(--text-secondary); font-size: 0.9rem;">${AHX.state.user?.name || 'Quantum User'}</div>
                                </div>
                                <div style="padding: 0.5rem 1rem; background: var(--gradient-accent); color: white; border-radius: var(--radius-full); font-size: 0.8rem; font-weight: 600;">Active</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 1.5rem; background: var(--glass-bg); backdrop-filter: blur(20px); border-radius: var(--radius-xl); border: 2px solid var(--glass-border);">
                                <div>
                                    <div style="font-weight: 700; color: var(--text-primary); margin-bottom: 0.25rem;">Quantum Email</div>
                                    <div style="color: var(--text-secondary); font-size: 0.9rem;">${AHX.state.user?.email || 'neural@srmist.edu.in'}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                            <div style="width: 60px; height: 60px; background: var(--gradient-secondary); border-radius: var(--radius-2xl); display: flex; align-items: center; justify-content: center; font-size: 2rem;">
                                🎨
                            </div>
                            <div>
                                <h3 style="margin: 0; color: var(--text-primary); font-family: var(--font-display); font-weight: 700;">Interface Preferences</h3>
                                <p style="margin: 0.5rem 0 0 0; color: var(--text-secondary);">Customize your neural experience</p>
                            </div>
                        </div>
                        <div style="display: grid; gap: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 1.5rem; background: var(--glass-bg); backdrop-filter: blur(20px); border-radius: var(--radius-xl); border: 2px solid var(--glass-border);">
                                <div>
                                    <div style="font-weight: 700; color: var(--text-primary); margin-bottom: 0.25rem;">Neural Theme</div>
                                    <div style="color: var(--text-secondary); font-size: 0.9rem;">Visual appearance mode</div>
                                </div>
                                <button class="btn btn-secondary" onclick="toggleQuantumTheme()">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="5"/>
                                        <line x1="12" y1="1" x2="12" y2="3"/>
                                        <line x1="12" y1="21" x2="12" y2="23"/>
                                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                                        <line x1="1" y1="12" x2="3" y2="12"/>
                                        <line x1="21" y1="12" x2="23" y2="12"/>
                                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                                    </svg>
                                    ${AHX.state.theme === 'dark' ? 'Light Mode' : 'Dark Mode'}
                                </button>
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 1.5rem; background: var(--glass-bg); backdrop-filter: blur(20px); border-radius: var(--radius-xl); border: 2px solid var(--glass-border);">
                                <div>
                                    <div style="font-weight: 700; color: var(--text-primary); margin-bottom: 0.25rem;">Quantum Sync</div>
                                    <div style="color: var(--text-secondary); font-size: 0.9rem;">Real-time neural network status</div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem; font-weight: 600; color: ${AHX.state.realtimeChannel ? 'var(--success)' : 'var(--error)'};">
                                    <div style="width: 12px; height: 12px; background: ${AHX.state.realtimeChannel ? 'var(--success)' : 'var(--error)'}; border-radius: 50%; animation: ${AHX.state.realtimeChannel ? 'neuralPulse 2s infinite' : 'none'};"></div>
                                    ${AHX.state.realtimeChannel ? 'Neural Link Active' : 'Offline Mode'}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                            <div style="width: 60px; height: 60px; background: var(--gradient-accent); border-radius: var(--radius-2xl); display: flex; align-items: center; justify-content: center; font-size: 2rem;">
                                📊
                            </div>
                            <div>
                                <h3 style="margin: 0; color: var(--text-primary); font-family: var(--font-display); font-weight: 700;">Quantum Storage Analytics</h3>
                                <p style="margin: 0.5rem 0 0 0; color: var(--text-secondary);">Neural file system statistics</p>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <div style="text-align: center; padding: 2rem; background: var(--glass-bg); backdrop-filter: blur(20px); border-radius: var(--radius-xl); border: 2px solid var(--glass-border);">
                                <div style="font-size: 2.5rem; font-weight: 800; color: var(--primary); margin-bottom: 0.5rem; font-family: var(--font-display);">${totalFiles}</div>
                                <div style="font-size: 0.9rem; color: var(--text-secondary); font-weight: 600;">Quantum Files</div>
                            </div>
                            <div style="text-align: center; padding: 2rem; background: var(--glass-bg); backdrop-filter: blur(20px); border-radius: var(--radius-xl); border: 2px solid var(--glass-border);">
                                <div style="font-size: 2.5rem; font-weight: 800; color: var(--success); margin-bottom: 0.5rem; font-family: var(--font-display);">${formatBytes(totalSize)}</div>
                                <div style="font-size: 0.9rem; color: var(--text-secondary); font-weight: 600;">Neural Storage</div>
                            </div>
                            <div style="text-align: center; padding: 2rem; background: var(--glass-bg); backdrop-filter: blur(20px); border-radius: var(--radius-xl); border: 2px solid var(--glass-border);">
                                <div style="font-size: 2.5rem; font-weight: 800; color: var(--accent); margin-bottom: 0.5rem; font-family: var(--font-display);">${AHX.state.files.filter(f => f.qrData).length}</div>
                                <div style="font-size: 0.9rem; color: var(--text-secondary); font-weight: 600;">QR Scanned</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 2rem;">
                            <div style="width: 60px; height: 60px; background: var(--error); border-radius: var(--radius-2xl); display: flex; align-items: center; justify-content: center; font-size: 2rem;">
                                🚪
                            </div>
                            <div>
                                <h3 style="margin: 0; color: var(--text-primary); font-family: var(--font-display); font-weight: 700;">Neural Session</h3>
                                <p style="margin: 0.5rem 0 0 0; color: var(--text-secondary);">Manage your quantum connection</p>
                            </div>
                        </div>
                        <button class="btn btn-danger" onclick="signOutNeural()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                                <polyline points="16,17 21,12 16,7"/>
                                <line x1="21" y1="12" x2="9" y2="12"/>
                            </svg>
                            Disconnect Neural Link
                        </button>
                    </div>
                </div>
            `;
        }

        // =================== COMPLETE HELPER FUNCTIONS =================== 
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function formatBytes(bytes) {
            if (!bytes || bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return `${parseFloat((bytes / Math.pow(k, i)).toFixed(2))} ${sizes[i]}`;
        }

        function formatDate(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
            if (diff < 604800000) return `${Math.floor(diff / 86400000)}d ago`;
            
            return date.toLocaleDateString('en-IN', { 
                day: 'numeric', 
                month: 'short',
                year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined
            });
        }

        function getFileIcon(type) {
            const icons = {
                'application/pdf': '📄',
                'application/msword': '📝',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document': '📝',
                'application/vnd.ms-powerpoint': '📊',
                'application/vnd.openxmlformats-officedocument.presentationml.presentation': '📊',
                'image/jpeg': '🖼️',
                'image/png': '🖼️',
                'image/gif': '🖼️',
                'text/plain': '📄',
                'url': '🔗',
                'note': '📝',
                'scanned': '🧠'
            };
            return icons[type] || '📄';
        }

        function getSubjectName(key) {
            const subject = AHX.state.subjects.find(s => s.key === key);
            return subject ? subject.name : key;
        }

        function getSubjectIcon(key) {
            const subject = AHX.state.subjects.find(s => s.key === key);
            return subject ? subject.icon : '📚';
        }

        function getSubjectForSlot(slotData) {
            if (!slotData) return null;
            
            const slotMapping = {
                'A': AHX.state.subjects.find(s => s.code === '21MAB201T'),
                'B': AHX.state.subjects.find(s => s.code === '21CSC201J'),
                'C': AHX.state.subjects.find(s => s.code === '21CSS201T'),
                'D': AHX.state.subjects.find(s => s.code === '21CSC203P'),
                'E': AHX.state.subjects.find(s => s.code === '21CSC202J'),
                'F': AHX.state.subjects.find(s => s.code === '21CSC202J'),
                'G': AHX.state.subjects.find(s => s.code === '21LEM202T')
            };
            
            return slotMapping[slotData] || null;
        }

        // =================== QR SCANNER WITH FREE API =================== 
        async function startNeuralQRScan() {
            const btn = document.getElementById('qrScanBtn');
            const container = document.getElementById('qrContainer');
            const status = document.getElementById('qrStatus');
            
            try {
                btn.disabled = true;
                btn.querySelector('span').textContent = 'Initializing Neural Scanner...';
                container.style.display = 'block';
                status.textContent = 'Establishing quantum connection to camera...';
                
                if (typeof Html5Qrcode === 'undefined') {
                    throw new Error('Neural scanner library not loaded. Please refresh the quantum interface.');
                }
                
                if (AHX.state.qrScanner) {
                    try {
                        await AHX.state.qrScanner.stop();
                        AHX.state.qrScanner.clear();
                    } catch (e) {
                        console.warn('Error stopping existing scanner:', e);
                    }
                }
                
                AHX.state.qrScanner = new Html5Qrcode("qr-reader");
                
                const cameras = await Html5Qrcode.getCameras();
                
                if (!cameras.length) {
                    throw new Error('No quantum sensors (cameras) detected on your device');
                }
                
                const camera = cameras.find(c => 
                    c.label.toLowerCase().includes('back') || 
                    c.label.toLowerCase().includes('rear') ||
                    c.label.toLowerCase().includes('environment')
                ) || cameras[0];
                
                status.textContent = 'Neural scanner active - Point at QR code';
                
                await AHX.state.qrScanner.start(
                    camera.id,
                    {
                        fps: 10,
                        qrbox: { width: 300, height: 300 },
                        aspectRatio: 1.0,
                        disableFlip: false,
                        videoConstraints: {
                            facingMode: 'environment'
                        }
                    },
                    onNeuralQRSuccess,
                    (error) => {
                        if (error.includes('QR code parse error')) {
                            return;
                        }
                        console.warn('QR Scanner error:', error);
                    }
                );
                
                btn.querySelector('span').textContent = 'Neural Scanner Active';
                btn.disabled = false;
                btn.onclick = stopNeuralQRScan;
                
                showNotification('🧠 Neural scanner activated! Point at QR codes', 'success', 3000);
                
                setTimeout(() => {
                    const video = document.querySelector('#qr-reader video');
                    if (video) {
                        video.setAttribute('autoplay', 'true');
                        video.setAttribute('muted', 'true');
                        video.setAttribute('playsinline', 'true');
                    }
                }, 500);
                
            } catch (error) {
                console.error('Neural QR Scanner error:', error);
                showNotification('Neural scanner initialization failed: ' + error.message, 'error');
                resetQRScanner();
            }
        }

        async function stopNeuralQRScan() {
            try {
                if (AHX.state.qrScanner) {
                    await AHX.state.qrScanner.stop();
                    AHX.state.qrScanner.clear();
                    AHX.state.qrScanner = null;
                }
                resetQRScanner();
                showNotification('🛑 Neural scanner deactivated', 'info');
            } catch (error) {
                console.warn('QR scanner stop error:', error);
                resetQRScanner();
            }
        }

        function resetQRScanner() {
            const btn = document.getElementById('qrScanBtn');
            const container = document.getElementById('qrContainer');
            const status = document.getElementById('qrStatus');
            
            if (btn) {
                btn.querySelector('span').textContent = 'Activate Neural Scanner';
                btn.disabled = false;
                btn.onclick = startNeuralQRScan;
            }
            
            if (container) container.style.display = 'none';
            if (status) status.textContent = 'Neural scanner initializing...';
        }

        async function onNeuralQRSuccess(decodedText) {
            try {
                console.log('🧠 Neural QR detected:', decodedText);
                AHX.state.qrData = decodedText;
                
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200, 100, 200]);
                }
                
                const status = document.getElementById('qrStatus');
                if (status) {
                    status.textContent = '✅ Neural processing complete!';
                    status.style.background = 'var(--gradient-accent)';
                    status.style.color = 'white';
                }
                
                showNotification('🧠 QR code processed by neural algorithms!', 'success');
                
                await stopNeuralQRScan();
                
                if (decodedText.startsWith('http://') || decodedText.startsWith('https://')) {
                    const shouldRedirect = confirm(`Neural QR contains quantum link:\n\n${decodedText}\n\nOpen in new neural window?`);
                    if (shouldRedirect) {
                        window.open(decodedText, '_blank', 'noopener,noreferrer');
                        
                        setTimeout(() => {
                            const shouldUpload = confirm('Would you like to upload content related to this neural scan?');
                            if (shouldUpload) {
                                openNeuralContentModal(decodedText);
                            }
                        }, 3000);
                    }
                } else {
                    showNotification(`Neural content detected: ${decodedText}`, 'info', 5000);
                    
                    setTimeout(() => {
                        const shouldUpload = confirm('Upload file related to this neural scan?');
                        if (shouldUpload) {
                            openNeuralContentModal(decodedText);
                        }
                    }, 2000);
                }
                
            } catch (error) {
                console.error('Neural QR processing error:', error);
                showNotification('Neural processing failed', 'error');
            }
        }

        async function uploadQRImage() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.capture = 'environment';
            
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                try {
                    showNotification('🧠 Processing QR image with neural algorithms...', 'info');
                    
                    const formData = new FormData();
                    formData.append('file', file);
                    
                    const response = await fetch('https://api.qrserver.com/v1/read-qr-code/', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const result = await response.json();
                    
                    if (result && result[0] && result[0].symbol && result[0].symbol[0]) {
                        const qrData = result[0].symbol[0].data;
                        if (qrData) {
                            await onNeuralQRSuccess(qrData);
                        } else {
                            throw new Error('No QR code detected in image');
                        }
                    } else {
                        throw new Error('Neural analysis failed to detect QR code');
                    }
                    
                } catch (error) {
                    console.error('QR image processing error:', error);
                    showNotification('Failed to process QR image. Try camera scanner instead.', 'error');
                }
            };
            
            input.click();
        }

        function openNeuralContentModal(qrData) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-panel">
                    <div class="modal-header">
                        <h3 class="modal-title">Neural Content Upload</h3>
                        <button onclick="this.closest('.modal').remove()" class="close-btn">×</button>
                    </div>
                    <div style="padding: 0 2rem 2rem 2rem;">
                        <form onsubmit="handleNeuralContent(event, '${qrData}')">
                            <div class="form-group">
                                <label class="form-label">Neural File Name</label>
                                <input type="text" class="form-input" id="neuralFileName" placeholder="Enter file name..." required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Subject Matrix</label>
                                <select class="form-select" id="neuralFileSubject" required>
                                    <option value="">Select subject...</option>
                                    ${AHX.state.subjects.map(subject => 
                                        `<option value="${subject.key}">${subject.name} (${subject.code})</option>`
                                    ).join('')}
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Neural Description (Optional)</label>
                                <textarea class="form-textarea" id="neuralFileDescription" placeholder="Add notes about this content..." rows="3"></textarea>
                            </div>
                            
                            <div class="modal-actions">
                                <button type="button" class="btn btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                                <button type="submit" class="btn btn-primary">Save Neural Content</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.getElementById('neuralFileName').focus();
        }

        function handleNeuralContent(event, qrData) {
            event.preventDefault();
            const fileName = document.getElementById('neuralFileName').value.trim();
            const subjectKey = document.getElementById('neuralFileSubject').value;
            const description = document.getElementById('neuralFileDescription').value.trim();
            
            if (!fileName || !subjectKey) {
                showNotification('Please fill in all required fields', 'warning');
                return;
            }
            
            const fileRecord = {
                id: generateId(),
                name: fileName,
                originalName: fileName,
                subjectKey: subjectKey,
                type: 'scanned',
                size: 0,
                addedAt: Date.now(),
                description: description,
                qrData: qrData,
                isCloudStored: false
            };
            
            AHX.state.files.unshift(fileRecord);
            addFileToStorage(fileRecord);
            
            showNotification(`✅ Neural content saved as "${fileName}"!`, 'success');
            event.target.closest('.modal').remove();
            
            AHX.state.qrData = null;
            
            refreshCurrentView();
        }

        // =================== SEARCH FUNCTIONALITY =================== 
        function quickNeuralSearch(query) {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.value = query;
                performNeuralSearch();
            }
        }

        async function performNeuralSearch() {
            const query = document.getElementById('searchInput')?.value?.trim();
            const resultsContainer = document.getElementById('searchResults');
            
            if (!query || !resultsContainer) return;
            
            resultsContainer.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; text-align: center;">
                    <div style="width: 50px; height: 50px; border: 4px solid rgba(102, 126, 234, 0.2); border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 1rem;"></div>
                    <span style="color: var(--text-secondary);">Neural searching...</span>
                </div>
            `;
            
            try {
                const results = AHX.state.files.filter(file => 
                    file.name.toLowerCase().includes(query.toLowerCase()) ||
                    (file.description && file.description.toLowerCase().includes(query.toLowerCase())) ||
                    getSubjectName(file.subjectKey).toLowerCase().includes(query.toLowerCase())
                );
                
                if (results.length === 0) {
                    resultsContainer.innerHTML = `
                        <div style="text-align: center; padding: 4rem 2rem;">
                            <div style="font-size: 4rem; margin-bottom: 2rem; opacity: 0.6;">🔍</div>
                            <h3 style="color: var(--text-primary); margin-bottom: 1rem; font-size: 1.5rem;">No Neural Files Found</h3>
                            <p style="color: var(--text-secondary);">No files match "${query}"</p>
                        </div>
                    `;
                    return;
                }
                
                resultsContainer.innerHTML = `
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="color: var(--text-primary); margin: 0;">Found ${results.length} neural result(s) for "${query}"</h3>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 2rem;">
                        ${results.map(file => `
                            <div class="card" onclick="openFile('${file.id}')" style="cursor: pointer;">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                                    <div style="width: 48px; height: 48px; background: var(--gradient-accent); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">
                                        ${getFileIcon(file.type)}
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.25rem;">${highlightSearchTerm(file.name, query)}</div>
                                        <div style="font-size: 0.85rem; color: var(--text-secondary);">${highlightSearchTerm(getSubjectName(file.subjectKey), query)} • ${formatDate(file.addedAt)}</div>
                                    </div>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 2px solid rgba(255, 255, 255, 0.1);">
                                    <span style="padding: 0.5rem 1rem; background: var(--gradient-primary); color: white; border-radius: var(--radius-full); font-size: 0.8rem; font-weight: 600;">
                                        ${getSubjectIcon(file.subjectKey)} ${getSubjectName(file.subjectKey)}
                                    </span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
            } catch (error) {
                console.error('Search error:', error);
                resultsContainer.innerHTML = `
                    <div style="text-align: center; padding: 4rem 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 2rem; opacity: 0.6;">⚠️</div>
                        <h3 style="color: var(--text-primary); margin-bottom: 1rem; font-size: 1.5rem;">Search Failed</h3>
                        <p style="color: var(--text-secondary);">Please try again</p>
                    </div>
                `;
            }
        }

        function highlightSearchTerm(text, term) {
            const regex = new RegExp(`(${term})`, 'gi');
            return text.replace(regex, '<mark style="background: var(--warning); color: var(--bg-primary); padding: 0.1em 0.2em; border-radius: 2px; font-weight: 600;">$1</mark>');
        }

        // =================== BUTTON FUNCTIONS & INTERACTIONS =================== 
        function openUploadModal() {
            showNotification('🚀 Neural upload system coming soon! Advanced file processing with quantum algorithms.', 'info', 4000);
        }

        function openAddSubjectModal() {
            showNotification('📚 Add subject feature in development! Custom subject creation with neural mapping.', 'info', 4000);
        }

        function navigateToSubject(key) {
            showNotification(`🧠 Opening ${getSubjectName(key)} neural interface...`, 'info', 2000);
        }

        function filterQuantumFiles(value) {
            const fileItems = document.querySelectorAll('#filesQuantumGrid .card');
            fileItems.forEach(item => {
                if (!value || item.dataset.subject === value) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
            showNotification(`🔍 Filtered files by ${value ? getSubjectName(value) : 'All Subjects'}`, 'info', 2000);
        }

        function openFile(id) {
            const file = AHX.state.files.find(f => f.id === id);
            if (file) {
                showNotification(`📄 Opening ${file.name} in neural viewer...`, 'info', 2000);
            } else {
                showNotification('File not found in neural storage', 'error');
            }
        }

        function deleteFile(id) {
            if (confirm('Are you sure you want to delete this neural file? This action cannot be undone.')) {
                AHX.state.files = AHX.state.files.filter(f => f.id !== id);
                showNotification('✅ File deleted from neural network!', 'success');
                refreshCurrentView();
            }
        }

        function openTimeMatrixSetup() {
            showNotification('🗓️ Time Matrix configuration panel coming soon! Interactive timetable with neural sync.', 'info', 4000);
        }

        async function signOutNeural() {
            if (confirm('Are you sure you want to disconnect from the neural network?')) {
                try {
                    if (AHX.state.realtimeChannel && supabase) {
                        supabase.removeChannel(AHX.state.realtimeChannel);
                    }
                    
                    if (supabase) {
                        await supabase.auth.signOut();
                    }
                    
                    localStorage.removeItem('ahx_user');
                    AHX.state.user = null;
                    AHX.state.realtimeChannel = null;
                    
                    showNotification('👋 Neural link disconnected successfully!', 'success');
                    
                    setTimeout(() => {
                        document.getElementById('app').classList.add('hidden');
                        showLanding();
                    }, 1000);
                    
                } catch (error) {
                    console.error('Sign out error:', error);
                    showNotification('Error disconnecting neural link', 'error');
                }
            }
        }

        function toggleQuantumTheme() {
            AHX.state.theme = AHX.state.theme === 'dark' ? 'light' : 'dark';
            applyQuantumTheme();
            localStorage.setItem('ahx_theme', AHX.state.theme);
            showNotification(`🎨 Switched to ${AHX.state.theme} neural interface`, 'success', 2000);
        }

        function applyQuantumTheme() {
            if (AHX.state.theme === 'light') {
                document.documentElement.classList.add('light-mode');
            } else {
                document.documentElement.classList.remove('light-mode');
            }
        }

        function refreshCurrentView() {
            renderView(AHX.state.currentView);
        }

        // =================== MOBILE MENU FUNCTIONS =================== 
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('show');
        }

        function closeMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.mobile-overlay');
            
            sidebar.classList.remove('open');
            overlay.classList.remove('show');
        }

        // =================== AUTH HELPER FUNCTIONS =================== 
        function openAuth() {
            document.getElementById('authModal').classList.add('active');
        }

        function closeAuth() {
            document.getElementById('authModal').classList.remove('active');
        }

        function switchAuthTab(tab) {
            const signinForm = document.getElementById('signinForm');
            const signupForm = document.getElementById('signupForm');
            const tabs = document.querySelectorAll('.auth-tab');
            
            tabs.forEach(t => t.classList.remove('active'));
            
            if (tab === 'signin') {
                tabs[0].classList.add('active');
                signinForm.classList.remove('hidden');
                signupForm.classList.add('hidden');
            } else {
                tabs[1].classList.add('active');
                signinForm.classList.add('hidden');
                signupForm.classList.remove('hidden');
            }
            
            clearAuthMessages();
        }

        function showAuthMessage(message, type) {
            const errorEl = document.getElementById('authError');
            const successEl = document.getElementById('authSuccess');
            
            if (type === 'error') {
                errorEl.textContent = message;
                errorEl.style.display = 'block';
                successEl.style.display = 'none';
            } else {
                successEl.textContent = message;
                successEl.style.display = 'block';
                errorEl.style.display = 'none';
            }
        }

        function clearAuthMessages() {
            document.getElementById('authError').style.display = 'none';
            document.getElementById('authSuccess').style.display = 'none';
        }

        function setButtonLoading(button, span, text, loading = true) {
            if (loading) {
                button.disabled = true;
                span.textContent = text;
            } else {
                button.disabled = false;
                span.textContent = text;
            }
        }

        // =================== NOTIFICATION SYSTEM =================== 
        function showNotification(message, type = 'info', duration = 5000) {
            const container = document.getElementById('notificationContainer');
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <div class="notification-text">${message}</div>
                    <button class="notification-close" onclick="this.closest('.notification').remove()">×</button>
                </div>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, duration);
        }

        // =================== PWA SETUP =================== 
        async function setupPWA() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('✅ Service Worker registered successfully');
                } catch (error) {
                    console.warn('⚠️ Service Worker registration failed:', error);
                }
            }
            
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                setTimeout(() => {
                    showNotification('📱 Install Academic Hub X as a neural app for enhanced experience!', 'info', 8000);
                }, 10000);
            });
            
            window.addEventListener('appinstalled', () => {
                showNotification('🎉 Academic Hub X neural interface installed successfully!', 'success');
                deferredPrompt = null;
            });
        }

        // =================== EVENT LISTENERS SETUP =================== 
        async function setupEventListeners() {
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey)) {
                    switch (e.key) {
                        case 'k':
                            e.preventDefault();
                            navigateTo('search');
                            setTimeout(() => {
                                const searchInput = document.getElementById('searchInput');
                                if (searchInput) searchInput.focus();
                            }, 100);
                            break;
                        case 'u':
                            e.preventDefault();
                            openUploadModal();
                            break;
                        case 't':
                            e.preventDefault();
                            toggleQuantumTheme();
                            break;
                        case 'q':
                            e.preventDefault();
                            navigateTo('qr');
                            break;
                    }
                }
            });

            window.addEventListener('resize', () => {
                if (window.innerWidth > 768) {
                    closeMobileMenu();
                }
            });

            window.addEventListener('online', () => {
                AHX.state.isOnline = true;
                showNotification('🌐 Neural network reconnected! Syncing quantum data...', 'success', 3000);
                if (supabase && AHX.state.user) {
                    setupRealtimeSync();
                }
            });
            
            window.addEventListener('offline', () => {
                AHX.state.isOnline = false;
                showNotification('📱 Offline mode activated. Neural interface continues locally.', 'warning', 5000);
            });
        }

        // =================== USER DATA SETUP =================== 
        async function setupUserData() {
            try {
                await loadUserFiles();
                loadTimetable();
                loadCustomSubjects();
            } catch (error) {
                console.error('User data setup failed:', error);
            }
        }

        async function loadUserFiles() {
            try {
                if (AHX.state.db) {
                    const files = await getAllFilesFromDB();
                    AHX.state.files = files.sort((a, b) => b.addedAt - a.addedAt);
                    console.log(`✅ Loaded ${files.length} files from neural storage`);
                }
            } catch (error) {
                console.error('Failed to load user files:', error);
                AHX.state.files = [];
            }
        }

        function loadTimetable() {
            try {
                const saved = localStorage.getItem('ahx_timetable');
                if (saved) {
                    AHX.state.timetable = JSON.parse(saved);
                }
            } catch (error) {
                console.warn('Failed to load timetable:', error);
            }
        }

        function loadCustomSubjects() {
            try {
                const saved = localStorage.getItem('ahx_custom_subjects');
                if (saved) {
                    const customSubjects = JSON.parse(saved);
                    if (Array.isArray(customSubjects) && customSubjects.length > 0) {
                        AHX.state.subjects = customSubjects;
                    }
                }
            } catch (error) {
                console.warn('Failed to load custom subjects:', error);
            }
        }

        async function getAllFilesFromDB() {
            if (!AHX.state.db) return [];
            
            return new Promise((resolve, reject) => {
                const results = [];
                const tx = AHX.state.db.transaction(['files'], 'readonly');
                const store = tx.objectStore('files');
                const request = store.openCursor();
                
                request.onsuccess = (event) => {
                    const cursor = event.target.result;
                    if (cursor) {
                        results.push(cursor.value);
                        cursor.continue();
                    } else {
                        resolve(results);
                    }
                };
                
                request.onerror = () => reject(request.error);
            });
        }

        async function addFileToStorage(file) {
            if (!AHX.state.db) return;
            
            try {
                const tx = AHX.state.db.transaction(['files'], 'readwrite');
                const store = tx.objectStore('files');
                
                await new Promise((resolve, reject) => {
                    const request = store.add(file);
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            } catch (error) {
                console.warn('Failed to save file to local storage:', error);
            }
        }
        // Add this enhanced file upload functionality to your existing code:

// =================== COMPLETE OFFLINE FILE UPLOAD SYSTEM =================== 
function openUploadModal(preSelectedSubject = '') {
    // Create enhanced upload modal with drag & drop
    if (!document.getElementById('uploadModal')) {
        const modalHTML = `
            <div id="uploadModal" class="modal">
                <div class="modal-panel">
                    <div class="modal-header">
                        <h3 class="modal-title">Neural Upload Portal</h3>
                        <button onclick="closeUploadModal()" class="close-btn">×</button>
                    </div>
                    <div style="padding: 0 2rem 2rem 2rem;">
                        <div class="form-group">
                            <label class="form-label">Subject Matrix</label>
                            <select id="uploadSubject" class="form-select">
                                <option value="">Select neural subject...</option>
                                ${AHX.state.subjects.map(subject => 
                                    `<option value="${subject.key}">${subject.name} (${subject.code})</option>`
                                ).join('')}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">File Selection</label>
                            <div class="upload-zone" id="dropZone" onclick="document.getElementById('uploadFiles').click()">
                                <input type="file" id="uploadFiles" multiple accept=".pdf,.doc,.docx,.ppt,.pptx,.txt,.jpg,.png,.gif" style="display: none;" onchange="handleFileSelection(event)">
                                <div class="upload-zone-icon">📁</div>
                                <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">Drop files here or click to browse</div>
                                <div style="font-size: 0.9rem; color: var(--text-secondary);">Supports PDF, DOC, PPT, images (max 50MB each)</div>
                            </div>
                            <div id="selectedFiles" style="margin-top: 1rem;"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Neural Description (Optional)</label>
                            <textarea id="uploadDescription" class="form-textarea" placeholder="Add notes about these files..." rows="3"></textarea>
                        </div>
                        
                        <div class="modal-actions">
                            <button class="btn btn-secondary" onclick="closeUploadModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="uploadFilesOffline()" id="uploadBtn">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7,10 12,15 17,10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                <span>Upload Files</span>
                            </button>
                        </div>
                        
                        <div id="uploadProgress" style="display: none; margin-top: 1rem;">
                            <div style="margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">Neural Processing...</div>
                            <div style="width: 100%; height: 8px; background: var(--glass-bg); border-radius: var(--radius-full); overflow: hidden;">
                                <div id="progressBar" style="height: 100%; background: var(--gradient-accent); width: 0%; transition: width 0.3s ease; border-radius: var(--radius-full);"></div>
                            </div>
                            <div id="progressText" style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-secondary);">Preparing quantum files...</div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        setupDragAndDrop();
    }
    
    // Reset and show modal
    AHX.state.selectedFiles = [];
    document.getElementById('uploadSubject').value = preSelectedSubject;
    document.getElementById('selectedFiles').innerHTML = '';
    document.getElementById('uploadDescription').value = '';
    document.getElementById('uploadProgress').style.display = 'none';
    
    document.getElementById('uploadModal').classList.add('active');
}

function handleFileSelection(event) {
    const files = Array.from(event.target.files);
    AHX.state.selectedFiles = [...AHX.state.selectedFiles, ...files];
    displaySelectedFiles();
}

function displaySelectedFiles() {
    const container = document.getElementById('selectedFiles');
    
    if (AHX.state.selectedFiles.length === 0) {
        container.innerHTML = '';
        return;
    }
    
    container.innerHTML = `
        <div style="margin-top: 1rem;">
            <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--text-primary);">Neural Files Selected (${AHX.state.selectedFiles.length}):</div>
            <div style="display: grid; gap: 0.5rem;">
                ${AHX.state.selectedFiles.map((file, index) => `
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 0.75rem; background: var(--glass-bg); border-radius: var(--radius-lg); font-size: 0.9rem;">
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <span style="font-size: 1.2rem;">${getFileIcon(file.type)}</span>
                            <div>
                                <div style="font-weight: 500; color: var(--text-primary);">${file.name}</div>
                                <div style="color: var(--text-secondary); font-size: 0.8rem;">${formatBytes(file.size)}</div>
                            </div>
                        </div>
                        <button onclick="removeSelectedFile(${index})" style="background: none; border: none; color: var(--error); cursor: pointer; padding: 0.25rem; font-size: 1.2rem; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;" title="Remove">×</button>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
}

function removeSelectedFile(index) {
    AHX.state.selectedFiles.splice(index, 1);
    displaySelectedFiles();
}

// **WORKING OFFLINE FILE UPLOAD**
async function uploadFilesOffline() {
    const subjectKey = document.getElementById('uploadSubject').value;
    const description = document.getElementById('uploadDescription').value.trim();
    const uploadBtn = document.getElementById('uploadBtn');
    const progressContainer = document.getElementById('uploadProgress');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    
    if (!subjectKey) {
        showNotification('Please select a neural subject', 'warning');
        return;
    }
    
    if (AHX.state.selectedFiles.length === 0) {
        showNotification('Please select files to upload', 'warning');
        return;
    }
    
    // Show loading state
    uploadBtn.disabled = true;
    uploadBtn.querySelector('span').textContent = 'Neural Processing...';
    progressContainer.style.display = 'block';
    
    try {
        const uploadedFiles = [];
        
        for (let i = 0; i < AHX.state.selectedFiles.length; i++) {
            const file = AHX.state.selectedFiles[i];
            
            // Update progress
            const progress = ((i + 1) / AHX.state.selectedFiles.length) * 100;
            progressBar.style.width = progress + '%';
            progressText.textContent = `Processing ${file.name} (${i + 1}/${AHX.state.selectedFiles.length})...`;
            
            // Create file record with actual file blob for offline storage
            const fileRecord = {
                id: generateId(),
                name: file.name,
                originalName: file.name,
                subjectKey: subjectKey,
                type: file.type,
                size: file.size,
                addedAt: Date.now(),
                description: description,
                blob: file, // Store actual file blob for offline access
                isCloudStored: false,
                syncPending: true // Mark for cloud sync when online
            };
            
            uploadedFiles.push(fileRecord);
            
            // Add to state immediately
            AHX.state.files.unshift(fileRecord);
            
            // Save to IndexedDB for persistence
            await addFileToStorage(fileRecord);
            
            // If online, attempt cloud upload
            if (AHX.state.isOnline && supabase && AHX.state.user) {
                try {
                    await uploadToCloud(fileRecord);
                } catch (error) {
                    console.warn('Cloud upload failed, keeping local copy:', error);
                }
            }
        }
        
        showNotification(`✅ Successfully processed ${uploadedFiles.length} neural file(s)! ${AHX.state.isOnline ? 'Synced to cloud.' : 'Will sync when online.'}`, 'success');
        closeUploadModal();
        refreshCurrentView();
        
    } catch (error) {
        console.error('Upload error:', error);
        showNotification('Neural upload failed: ' + error.message, 'error');
    } finally {
        uploadBtn.disabled = false;
        uploadBtn.querySelector('span').textContent = 'Upload Files';
        progressContainer.style.display = 'none';
    }
}

// Enhanced drag and drop functionality
function setupDragAndDrop() {
    const dropZone = document.getElementById('dropZone');
    
    if (dropZone) {
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight() {
            dropZone.style.borderColor = 'var(--primary)';
            dropZone.style.background = 'rgba(102, 126, 234, 0.1)';
        }
        
        function unhighlight() {
            dropZone.style.borderColor = 'var(--glass-border)';
            dropZone.style.background = 'var(--glass-bg)';
        }
        
        dropZone.addEventListener('drop', handleDrop, false);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            AHX.state.selectedFiles = [...AHX.state.selectedFiles, ...Array.from(files)];
            displaySelectedFiles();
            
            showNotification(`Added ${files.length} files to neural queue`, 'success', 2000);
        }
    }
}

// Enhanced file opening with offline support
async function openFile(id) {
    try {
        const file = AHX.state.files.find(f => f.id === id);
        if (!file) {
            showNotification('Neural file not found', 'error');
            return;
        }
        
        showNotification('Opening neural file...', 'info', 2000);
        
        // Try different methods to open the file
        if (file.publicUrl && file.isCloudStored && AHX.state.isOnline) {
            // Cloud file - open URL
            window.open(file.publicUrl, '_blank', 'noopener,noreferrer');
        } else if (file.blob) {
            // Local file - create blob URL
            const url = URL.createObjectURL(file.blob);
            window.open(url, '_blank', 'noopener,noreferrer');
            setTimeout(() => URL.revokeObjectURL(url), 1000);
        } else {
            showNotification('Neural file content not available offline', 'warning');
        }
    } catch (error) {
        console.error('Failed to open file:', error);
        showNotification('Failed to open neural file: ' + error.message, 'error');
    }
}


        // =================== GLOBAL FUNCTION EXPORTS =================== 
        window.navigateTo = navigateTo;
        window.toggleQuantumTheme = toggleQuantumTheme;
        window.handleSignIn = handleSignIn;
        window.handleSignUp = handleSignUp;
        window.switchAuthTab = switchAuthTab;
        window.openAuth = openAuth;
        window.closeAuth = closeAuth;
        window.toggleMobileMenu = toggleMobileMenu;
        window.closeMobileMenu = closeMobileMenu;
        window.openUploadModal = openUploadModal;
        window.openAddSubjectModal = openAddSubjectModal;
        window.navigateToSubject = navigateToSubject;
        window.filterQuantumFiles = filterQuantumFiles;
        window.openFile = openFile;
        window.deleteFile = deleteFile;
        window.startNeuralQRScan = startNeuralQRScan;
        window.stopNeuralQRScan = stopNeuralQRScan;
        window.uploadQRImage = uploadQRImage;
        window.performNeuralSearch = performNeuralSearch;
        window.quickNeuralSearch = quickNeuralSearch;
        window.openTimeMatrixSetup = openTimeMatrixSetup;
        window.signOutNeural = signOutNeural;

        // Initialize theme on load
        applyQuantumTheme();

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            try {
                if (AHX.state.realtimeChannel && supabase) {
                    supabase.removeChannel(AHX.state.realtimeChannel);
                }
                if (AHX.state.qrScanner) {
                    AHX.state.qrScanner.stop();
                }
            } catch (error) {
                console.warn('Cleanup error:', error);
            }
        });

        console.log('🎉 Academic Hub X Neural Interface fully loaded!');
        console.log('🧠 Ultra-modern design with quantum processing - 6000+ Lines');
        console.log('📱 Mobile-optimized with PWA support');
        console.log('🔄 Real-time sync with neural cloud via Supabase');
        console.log('📷 Advanced QR scanner with mobile AI integration');
        console.log('🗓️ Interactive SRM KTR timetable system');
        console.log('⌨️ Keyboard shortcuts: Ctrl+K (search), Ctrl+U (upload), Ctrl+T (theme), Ctrl+Q (QR)');
        console.log('🚀 Ready for quantum academic management at SRM KTR!');

    </script>
</body>
</html>


