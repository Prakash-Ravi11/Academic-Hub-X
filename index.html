<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Academic Hub X - SRM KTR Student Portal</title>
    <meta name="description" content="Complete academic management solution for SRM Institute of Science and Technology students">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Academic Hub X">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    <link rel="apple-touch-icon" href="./icons/icon-192.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- QR Scanner Library -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>
    
    <!-- Main Styles -->
    <link rel="stylesheet" href="./style.css">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://unpkg.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://yvlspahwnnzfctqqlmbu.supabase.co https://prakashravi12.app.n8n.cloud;">
    
    <!-- Progressive Enhancement -->
    <noscript>
        <style>
            .js-only { display: none !important; }
            .no-js-message { 
                display: block !important; 
                padding: 2rem; 
                text-align: center; 
                background: var(--error); 
                color: white; 
            }
        </style>
    </noscript>
</head>

<body class="dark-theme">
    <!-- No JavaScript Fallback -->
    <div class="no-js-message" style="display: none;">
        <h2>JavaScript Required</h2>
        <p>Academic Hub X requires JavaScript to function. Please enable JavaScript in your browser settings.</p>
    </div>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen active js-only">
        <div class="loading-container">
            <div class="loading-logo">
                <div class="loading-logo-text">S</div>
                <div class="loading-logo-orbit"></div>
                <div class="loading-logo-orbit orbit-2"></div>
                <div class="loading-logo-orbit orbit-3"></div>
            </div>
            <h1 class="loading-title">Academic Hub X</h1>
            <p class="loading-subtitle">Connecting Students at SRM KTR</p>
            <div class="loading-progress">
                <div class="loading-progress-bar" id="loadingProgressBar"></div>
            </div>
            <div class="loading-status" id="loadingStatus">Initializing application...</div>
        </div>
    </div>

    <!-- Main Application Container -->
    <div id="app" class="app-container js-only" style="display: none;">
        <!-- Navigation Header -->
        <header class="nav-header">
            <div class="nav-brand">
                <div class="brand-logo">
                    <div class="logo-icon">S</div>
                </div>
                <div class="brand-text">
                    <h1 class="brand-title">Academic Hub X</h1>
                    <p class="brand-subtitle">SRM KTR Portal</p>
                </div>
            </div>
            
            <nav class="nav-menu" id="navMenu">
                <a href="#dashboard" class="nav-item active" data-route="dashboard" tabindex="0">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="9"></rect>
                        <rect x="14" y="3" width="7" height="5"></rect>
                        <rect x="14" y="12" width="7" height="9"></rect>
                        <rect x="3" y="16" width="7" height="5"></rect>
                    </svg>
                    <span class="nav-label">Dashboard</span>
                </a>
                
                <a href="#files" class="nav-item" data-route="files" tabindex="0">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                        <polyline points="13,2 13,9 20,9"></polyline>
                    </svg>
                    <span class="nav-label">Files</span>
                </a>
                
                <a href="#subjects" class="nav-item" data-route="subjects" tabindex="0">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                    </svg>
                    <span class="nav-label">Subjects</span>
                </a>
                
                <a href="#search" class="nav-item" data-route="search" tabindex="0">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <span class="nav-label">Search</span>
                </a>
                
                <a href="#qr" class="nav-item" data-route="qr" tabindex="0">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="5" height="5"></rect>
                        <rect x="16" y="3" width="5" height="5"></rect>
                        <rect x="3" y="16" width="5" height="5"></rect>
                        <path d="M16 16h2v2h-2z"></path>
                        <path d="M18 18h2v2h-2z"></path>
                        <path d="M20 20h2v2h-2z"></path>
                    </svg>
                    <span class="nav-label">QR Scanner</span>
                </a>
            </nav>

            <div class="nav-controls">
                <button class="btn btn-icon theme-toggle" id="themeToggle" title="Toggle Theme" tabindex="0">
                    <svg class="theme-icon sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg class="theme-icon moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
                
                <button class="btn btn-primary upload-btn" id="uploadBtn" title="Upload Files" tabindex="0">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17,8 12,3 7,8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    <span>Upload</span>
                </button>
                
                <button class="mobile-menu-toggle" id="mobileMenuToggle" title="Menu" tabindex="0">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="main-content" id="mainContent">
            <!-- Dynamic content will be rendered here -->
        </main>

        <!-- Floating Action Button -->
        <div class="fab-container" id="fabContainer">
            <button class="fab" id="mainFab" title="Quick Actions" tabindex="0">
                <svg class="fab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
            </button>
            
            <div class="fab-menu" id="fabMenu">
                <button class="fab fab-sm" onclick="openUploadModal()" title="Upload Files">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17,8 12,3 7,8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                </button>
                
                <button class="fab fab-sm" onclick="navigateTo('qr')" title="QR Scanner">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="5" height="5"></rect>
                        <rect x="16" y="3" width="5" height="5"></rect>
                        <rect x="3" y="16" width="5" height="5"></rect>
                        <path d="M16 16h2v2h-2z"></path>
                        <path d="M18 18h2v2h-2z"></path>
                        <path d="M20 20h2v2h-2z"></path>
                    </svg>
                </button>
                
                <button class="fab fab-sm" onclick="navigateTo('search')" title="Search">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- File Drop Overlay -->
        <div class="drop-overlay" id="dropOverlay">
            <div class="drop-content">
                <div class="drop-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17,8 12,3 7,8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                </div>
                <h3>Drop files to upload</h3>
                <p>Release to add files to Academic Hub X</p>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Modal Container -->
    <div id="modalContainer" class="modal-container"></div>

    <!-- Application JavaScript -->
    <script>
        // Global Constants and Configuration
        const WEBHOOK_ENDPOINTS = {
            fileUpload: 'https://prakashravi12.app.n8n.cloud/webhook/file-upload',
            qrScan: 'https://prakashravi12.app.n8n.cloud/webhook/qr-scan',
            analytics: 'https://prakashravi12.app.n8n.cloud/webhook/user-analytics',
            errorReport: 'https://prakashravi12.app.n8n.cloud/webhook/error-report'
        };

        const SUPABASE_CONFIG = {
            url: 'https://yvlspahwnnzfctqqlmbu.supabase.co',
            anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl2bHNwYWh3bm56ZmN0cXFsbWJ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzNjQ4NzUsImV4cCI6MjA2OTk0MDg3NX0.5j6phM4WCe7XZo5xHdajwAShkV-hibECc_sp31JI6SQ'
        };

        // Application State Management System
        const AppState = {
            theme: localStorage.getItem('ahx_theme') || 'dark',
            currentView: 'dashboard',
            user: JSON.parse(localStorage.getItem('ahx_user')) || null,
            subjects: [
                { 
                    key: 'transforms_bvp', 
                    name: 'Transforms & Boundary Value Problems', 
                    code: '21MAB201T', 
                    icon: 'üìä', 
                    faculty: 'Dr. P. Godhandaraman', 
                    room: 'CLS619',
                    credits: 3
                },
                { 
                    key: 'data_structures', 
                    name: 'Data Structures & Algorithms', 
                    code: '21CSC201J', 
                    icon: 'üî¢', 
                    faculty: 'Dr. Kalpana C', 
                    room: 'CLS619',
                    credits: 4
                },
                { 
                    key: 'computer_org', 
                    name: 'Computer Organization & Architecture', 
                    code: '21CSS201T', 
                    icon: 'üíª', 
                    faculty: 'Dr. Meenakshi M', 
                    room: 'CLS619',
                    credits: 3
                },
                { 
                    key: 'advanced_programming', 
                    name: 'Advanced Programming Practice', 
                    code: '21CSC203P', 
                    icon: '‚ö°', 
                    faculty: 'Dr. Prince Chelladurai S', 
                    room: 'CLS619',
                    credits: 2
                },
                { 
                    key: 'operating_systems', 
                    name: 'Operating Systems', 
                    code: '21CSC202J', 
                    icon: 'üîß', 
                    faculty: 'Dr. G. Priyadharshini', 
                    room: 'CLS619',
                    credits: 3
                },
                { 
                    key: 'professional_ethics', 
                    name: 'Professional Ethics', 
                    code: '21LEM201T', 
                    icon: '‚öñÔ∏è', 
                    faculty: 'Dr. B. Monika Nair', 
                    room: 'Online',
                    credits: 2
                }
            ],
            files: JSON.parse(localStorage.getItem('ahx_files') || '[]'),
            qrScans: JSON.parse(localStorage.getItem('qr_history') || '[]'),
            qrScanner: null,
            isOnline: navigator.onLine,
            installPrompt: null,
            lastSync: localStorage.getItem('last_sync') || null
        };

        // File Management State
        let selectedFiles = new Set();
        let currentFilter = { 
            subject: '', 
            type: '', 
            dateRange: '', 
            searchTerm: '' 
        };
        let currentSort = { 
            field: 'addedAt', 
            direction: 'desc' 
        };

        // QR Scanner State
        let qrHistory = JSON.parse(localStorage.getItem('qr_history') || '[]');
        let isQRScannerActive = false;

        // Utility Functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }

        function formatDate(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays === 1) {
                return 'Yesterday';
            } else if (diffDays < 7) {
                return `${diffDays} days ago`;
            } else if (diffDays < 30) {
                const weeks = Math.floor(diffDays / 7);
                return `${weeks} week${weeks > 1 ? 's' : ''} ago`;
            } else {
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            }
        }

        function getSubjectName(key) {
            const subject = AppState.subjects.find(s => s.key === key);
            return subject ? subject.name : 'Unknown Subject';
        }

        function getSubjectIcon(key) {
            const subject = AppState.subjects.find(s => s.key === key);
            return subject ? subject.icon : 'üìÑ';
        }

        function sanitizeHTML(str) {
            const temp = document.createElement('div');
            temp.textContent = str;
            return temp.innerHTML;
        }

        function validateFile(file) {
            const allowedTypes = [
                'application/pdf',
                'application/msword',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                'application/vnd.openxmlformats-officedocument.presentationml.presentation',
                'application/vnd.ms-powerpoint',
                'image/jpeg',
                'image/png',
                'image/webp',
                'text/plain',
                'text/csv'
            ];
            
            const maxSize = 50 * 1024 * 1024; // 50MB
            
            if (!allowedTypes.includes(file.type)) {
                throw new Error('File type not allowed. Supported: PDF, DOC, PPT, Images, TXT');
            }
            
            if (file.size > maxSize) {
                throw new Error('File too large (max 50MB)');
            }
            
            return true;
        }

        // Advanced Notification System
        function showNotification(message, type = 'info', duration = 3000, actions = null) {
            const container = document.getElementById('notificationContainer');
            const id = generateId();
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.id = `notification-${id}`;
            
            let actionsHTML = '';
            if (actions) {
                actionsHTML = `
                    <div class="notification-actions">
                        ${actions.map(action => `
                            <button class="btn btn-sm ${action.class || 'btn-secondary'}" 
                                    onclick="${action.onclick}; removeNotification('${id}')">
                                ${action.text}
                            </button>
                        `).join('')}
                    </div>
                `;
            }
            
            notification.innerHTML = `
                <div class="notification-content">
                    <div class="notification-text">${sanitizeHTML(message)}</div>
                    ${actionsHTML}
                    <button class="notification-close" onclick="removeNotification('${id}')" tabindex="0">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
            `;
            
            container.appendChild(notification);
            setTimeout(() => notification.classList.add('show'), 100);
            
            if (duration > 0) {
                setTimeout(() => removeNotification(id), duration);
            }
            
            return id;
        }

        function removeNotification(id) {
            const notification = document.getElementById(`notification-${id}`);
            if (notification) {
                notification.classList.add('hiding');
                setTimeout(() => notification.remove(), 300);
            }
        }

        // Theme Management System
        function initializeTheme() {
            const savedTheme = localStorage.getItem('ahx_theme') || 'dark';
            AppState.theme = savedTheme;
            document.body.className = `${savedTheme}-theme`;
            updateThemeToggle();
        }

        function toggleTheme() {
            const newTheme = AppState.theme === 'dark' ? 'light' : 'dark';
            AppState.theme = newTheme;
            document.body.className = `${newTheme}-theme`;
            localStorage.setItem('ahx_theme', newTheme);
            updateThemeToggle();
            
            // Send analytics
            trackEvent('theme_changed', { 
                label: `${AppState.theme === 'dark' ? 'light' : 'dark'}_to_${newTheme}` 
            });
            
            showNotification(`Switched to ${newTheme} theme`, 'success', 2000);
        }

        function updateThemeToggle() {
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                const sunIcon = themeToggle.querySelector('.sun-icon');
                const moonIcon = themeToggle.querySelector('.moon-icon');
                
                if (AppState.theme === 'dark') {
                    sunIcon.style.display = 'block';
                    moonIcon.style.display = 'none';
                } else {
                    sunIcon.style.display = 'none';
                    moonIcon.style.display = 'block';
                }
            }
        }

        // Navigation System with Hash Routing
        function navigateTo(view) {
            // Update navigation state
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-route') === view) {
                    item.classList.add('active');
                }
            });
            
            AppState.currentView = view;
            renderView(view);
            closeMobileMenu();
            window.location.hash = view;
            
            // Send analytics
            trackEvent('page_view', { page: view });
        }

        function renderView(view) {
            const mainContent = document.getElementById('mainContent');
            if (!mainContent) return;

            let content = '';
            
            switch (view) {
                case 'dashboard':
                    content = renderDashboard();
                    break;
                case 'files':
                    content = renderFilesView();
                    break;
                case 'subjects':
                    content = renderSubjectsView();
                    break;
                case 'search':
                    content = renderSearchView();
                    break;
                case 'qr':
                    content = renderQRView();
                    break;
                default:
                    content = renderDashboard();
            }
            
            mainContent.innerHTML = content;
            
            // Initialize view-specific functionality
            initializeViewFeatures(view);
        }

        function initializeViewFeatures(view) {
            switch (view) {
                case 'files':
                    initializeFileView();
                    break;
                case 'search':
                    initializeSearchView();
                    break;
                case 'qr':
                    initializeQRView();
                    break;
            }
        }

        // Dashboard Rendering
        function renderDashboard() {
            const analytics = generateAnalytics();
            const recentFiles = AppState.files
                .sort((a, b) => b.addedAt - a.addedAt)
                .slice(0, 5);
            const recentQRScans = qrHistory.slice(0, 3);

            return `
                <div class="dashboard">
                    <div class="dashboard-header">
                        <h2 class="page-title">Welcome to Academic Hub X</h2>
                        <p class="page-subtitle">Your complete academic management solution for SRM KTR</p>
                    </div>

                    <!-- Quick Stats -->
                    <div class="stats-grid">
                        <div class="stat-card" onclick="navigateTo('files')">
                            <div class="stat-icon">üìÅ</div>
                            <div class="stat-value">${analytics.totalFiles}</div>
                            <div class="stat-label">Total Files</div>
                            <div class="stat-trend">+${AppState.files.filter(f => Date.now() - f.addedAt < 7 * 24 * 60 * 60 * 1000).length} this week</div>
                        </div>
                        
                        <div class="stat-card" onclick="navigateTo('files')">
                            <div class="stat-icon">üíæ</div>
                            <div class="stat-value">${formatBytes(analytics.totalSize)}</div>
                            <div class="stat-label">Storage Used</div>
                            <div class="stat-trend">Avg: ${formatBytes(analytics.averageFileSize)}</div>
                        </div>
                        
                        <div class="stat-card" onclick="navigateTo('subjects')">
                            <div class="stat-icon">üìö</div>
                            <div class="stat-value">${AppState.subjects.length}</div>
                            <div class="stat-label">Active Subjects</div>
                            <div class="stat-trend">${AppState.subjects.reduce((sum, s) => sum + s.credits, 0)} total credits</div>
                        </div>
                        
                        <div class="stat-card" onclick="navigateTo('qr')">
                            <div class="stat-icon">üì±</div>
                            <div class="stat-value">${qrHistory.length}</div>
                            <div class="stat-label">QR Scans</div>
                            <div class="stat-trend">+${qrHistory.filter(q => Date.now() - q.timestamp < 7 * 24 * 60 * 60 * 1000).length} this week</div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="dashboard-section">
                        <h3>Quick Actions</h3>
                        <div class="quick-actions">
                            <button class="action-card" onclick="openUploadModal()">
                                <div class="action-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="17,8 12,3 7,8"></polyline>
                                        <line x1="12" y1="3" x2="12" y2="15"></line>
                                    </svg>
                                </div>
                                <div class="action-content">
                                    <h4>Upload Files</h4>
                                    <p>Add new academic documents</p>
                                </div>
                            </button>
                            
                            <button class="action-card" onclick="navigateTo('qr')">
                                <div class="action-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="5" height="5"></rect>
                                        <rect x="16" y="3" width="5" height="5"></rect>
                                        <rect x="3" y="16" width="5" height="5"></rect>
                                    </svg>
                                </div>
                                <div class="action-content">
                                    <h4>Scan QR Code</h4>
                                    <p>Capture from smart boards</p>
                                </div>
                            </button>
                            
                            <button class="action-card" onclick="navigateTo('search')">
                                <div class="action-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <path d="m21 21-4.35-4.35"></path>
                                    </svg>
                                </div>
                                <div class="action-content">
                                    <h4>Search Files</h4>
                                    <p>Find documents quickly</p>
                                </div>
                            </button>
                            
                            <button class="action-card" onclick="exportData()">
                                <div class="action-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7,10 12,15 17,10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                </div>
                                <div class="action-content">
                                    <h4>Export Data</h4>
                                    <p>Backup your information</p>
                                </div>
                            </button>
                        </div>
                    </div>

                    <!-- Recent Files -->
                    ${recentFiles.length > 0 ? `
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h3>Recent Files</h3>
                                <button class="btn btn-secondary btn-sm" onclick="navigateTo('files')">View All</button>
                            </div>
                            <div class="recent-files">
                                ${recentFiles.map(file => `
                                    <div class="file-item recent" onclick="openFilePreview('${file.id}')">
                                        <div class="file-icon">${getFileIcon(file.type)}</div>
                                        <div class="file-info">
                                            <div class="file-name">${sanitizeHTML(file.name)}</div>
                                            <div class="file-meta">
                                                ${getSubjectName(file.subjectKey)} ‚Ä¢ ${formatBytes(file.size)} ‚Ä¢ ${formatDate(file.addedAt)}
                                            </div>
                                        </div>
                                        <div class="file-actions">
                                            <button class="btn btn-icon btn-sm" onclick="event.stopPropagation(); downloadFile('${file.id}')" title="Download">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                                    <polyline points="7,10 12,15 17,10"></polyline>
                                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <!-- Subject Overview -->
                    <div class="dashboard-section">
                        <div class="section-header">
                            <h3>Subjects Overview</h3>
                            <button class="btn btn-secondary btn-sm" onclick="navigateTo('subjects')">View All</button>
                        </div>
                        <div class="subjects-grid">
                            ${AppState.subjects.slice(0, 6).map(subject => {
                                const fileCount = AppState.files.filter(f => f.subjectKey === subject.key).length;
                                return `
                                    <div class="subject-card" onclick="filterBySubject('${subject.key}')">
                                        <div class="subject-icon">${subject.icon}</div>
                                        <div class="subject-info">
                                            <h4 class="subject-name">${subject.name}</h4>
                                            <p class="subject-code">${subject.code}</p>
                                            <div class="subject-stats">
                                                <span>${fileCount} files</span>
                                                <span>${subject.credits} credits</span>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>

                    <!-- Recent QR Scans -->
                    ${recentQRScans.length > 0 ? `
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h3>Recent QR Scans</h3>
                                <button class="btn btn-secondary btn-sm" onclick="navigateTo('qr')">View All</button>
                            </div>
                            <div class="qr-scans-list">
                                ${recentQRScans.map(scan => `
                                    <div class="qr-scan-item">
                                        <div class="qr-icon">${scan.type === 'url' ? 'üîó' : 'üìÑ'}</div>
                                        <div class="qr-info">
                                            <div class="qr-content">${sanitizeHTML(scan.content.substring(0, 60))}${scan.content.length > 60 ? '...' : ''}</div>
                                            <div class="qr-meta">${formatDate(scan.timestamp)}</div>
                                        </div>
                                        ${scan.type === 'url' ? `
                                            <button class="btn btn-icon btn-sm" onclick="window.open('${scan.content}', '_blank')" title="Open Link">
                                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                                                    <polyline points="15,3 21,3 21,9"></polyline>
                                                    <line x1="10" y1="14" x2="21" y2="3"></line>
                                                </svg>
                                            </button>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // File Icon Helper Function
        function getFileIcon(type) {
            const iconMap = {
                'application/pdf': 'üìÑ',
                'application/msword': 'üìù',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'üìù',
                'application/vnd.ms-powerpoint': 'üìä',
                'application/vnd.openxmlformats-officedocument.presentationml.presentation': 'üìä',
                'image/jpeg': 'üñºÔ∏è',
                'image/png': 'üñºÔ∏è',
                'image/webp': 'üñºÔ∏è',
                'text/plain': 'üìÉ',
                'text/csv': 'üìà',
                'application/zip': 'üì¶',
                'application/x-rar-compressed': 'üì¶'
            };
            
            if (iconMap[type]) {
                return iconMap[type];
            }
            
            // Fallback based on type category
            if (type.startsWith('image/')) return 'üñºÔ∏è';
            if (type.startsWith('video/')) return 'üé•';
            if (type.startsWith('audio/')) return 'üéµ';
            if (type.startsWith('text/')) return 'üìÉ';
            
            return 'üìÑ';
        }

        // Analytics Generation
        function generateAnalytics() {
            const analytics = {
                totalFiles: AppState.files.length,
                totalSize: AppState.files.reduce((sum, file) => sum + (file.size || 0), 0),
                filesBySubject: {},
                filesByType: {},
                uploadTrend: [],
                averageFileSize: 0
            };

            // Files by subject
            AppState.files.forEach(file => {
                analytics.filesBySubject[file.subjectKey] = (analytics.filesBySubject[file.subjectKey] || 0) + 1;
            });

            // Files by type
            AppState.files.forEach(file => {
                const type = file.type.split('/')[0] || 'unknown';
                analytics.filesByType[type] = (analytics.filesByType[type] || 0) + 1;
            });

            // Upload trend (last 30 days)
            const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
            const recentFiles = AppState.files.filter(file => file.addedAt >= thirtyDaysAgo);
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date(Date.now() - (i * 24 * 60 * 60 * 1000));
                const dayStart = new Date(date.getFullYear(), date.getMonth(), date.getDate()).getTime();
                const dayEnd = dayStart + (24 * 60 * 60 * 1000);
                
                const count = recentFiles.filter(file => file.addedAt >= dayStart && file.addedAt < dayEnd).length;
                analytics.uploadTrend.push({
                    date: date.toISOString().split('T')[0],
                    count
                });
            }

            // Average file size
            if (AppState.files.length > 0) {
                analytics.averageFileSize = analytics.totalSize / AppState.files.length;
            }

            return analytics;
        }

        // Mobile Menu Functions
        function closeMobileMenu() {
            const menu = document.getElementById('navMenu');
            if (menu) {
                menu.classList.remove('mobile-open');
            }
            
            const toggle = document.getElementById('mobileMenuToggle');
            if (toggle) {
                toggle.classList.remove('active');
            }
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('navMenu');
            const toggle = document.getElementById('mobileMenuToggle');
            
            if (menu && toggle) {
                menu.classList.toggle('mobile-open');
                toggle.classList.toggle('active');
            }
        }

        // Drag and Drop Functions
        function setupDragAndDrop() {
            const dropZone = document.body;

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            dropZone.addEventListener('dragenter', handleDragEnter);
            dropZone.addEventListener('dragover', handleDragOver);
            dropZone.addEventListener('dragleave', handleDragLeave);
            dropZone.addEventListener('drop', handleDrop);

            function handleDragEnter(e) {
                if (isDraggingFiles(e)) {
                    showDropOverlay();
                }
            }

            function handleDragOver(e) {
                if (isDraggingFiles(e)) {
                    e.dataTransfer.dropEffect = 'copy';
                }
            }

            function handleDragLeave(e) {
                if (!e.relatedTarget || !dropZone.contains(e.relatedTarget)) {
                    hideDropOverlay();
                }
            }

            function handleDrop(e) {
                hideDropOverlay();
                if (isDraggingFiles(e)) {
                    const files = Array.from(e.dataTransfer.files);
                    if (files.length > 0) {
                        openUploadModal();
                        setTimeout(() => {
                            const fileInput = document.getElementById('fileInput');
                            if (fileInput) {
                                fileInput.files = e.dataTransfer.files;
                                handleFileSelection({ target: fileInput });
                            }
                        }, 100);
                    }
                }
            }

            function isDraggingFiles(e) {
                return e.dataTransfer && e.dataTransfer.types.includes('Files');
            }

            function showDropOverlay() {
                const overlay = document.getElementById('dropOverlay');
                if (overlay) {
                    overlay.classList.add('active');
                }
            }

            function hideDropOverlay() {
                const overlay = document.getElementById('dropOverlay');
                if (overlay) {
                    overlay.classList.remove('active');
                }
            }
        }

        // Filter by Subject Helper
        function filterBySubject(subjectKey) {
            navigateTo('files');
            setTimeout(() => {
                currentFilter.subject = subjectKey;
                const subjectSelect = document.querySelector('select[onchange="updateSubjectFilter(this.value)"]');
                if (subjectSelect) {
                    subjectSelect.value = subjectKey;
                }
                applyFiltersAndSort();
            }, 100);
        }

        // Modal Functions
        function closeModal(button) {
            const modal = button ? button.closest('.modal') : document.querySelector('.modal.active');
            if (modal) {
                modal.remove();
            }
        }

        // Analytics Event Tracking
        function trackEvent(eventName, parameters = {}) {
            if (typeof gtag !== 'undefined') {
                gtag('event', eventName, {
                    event_category: 'Academic Hub X',
                    event_label: parameters.label || '',
                    value: parameters.value || 0,
                    ...parameters
                });
            }
            
            // Also send to n8n analytics webhook
            sendAnalyticsToN8N(eventName, parameters);
        }

        async function sendAnalyticsToN8N(eventName, parameters) {
            try {
                const payload = {
                    event: eventName,
                    parameters: parameters,
                    timestamp: new Date().toISOString(),
                    user_id: AppState.user?.id || 'anonymous',
                    session_id: localStorage.getItem('session_id') || generateId(),
                    user_agent: navigator.userAgent,
                    url: window.location.href
                };

                await fetch(WEBHOOK_ENDPOINTS.analytics, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
            } catch (error) {
                console.warn('Analytics tracking failed:', error);
            }
        }
                // Continue from Part 1...

        // Complete Upload Modal System
        function openUploadModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active upload-modal';
            modal.innerHTML = `
                <div class="modal-backdrop" onclick="closeModal()"></div>
                <div class="modal-panel upload-panel">
                    <div class="modal-header">
                        <h3 class="modal-title">Upload Academic Files</h3>
                        <p class="modal-subtitle">Add documents, images, and other academic resources</p>
                        <button class="btn btn-icon" onclick="closeModal()" title="Close">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="modal-body">
                        <!-- File Drop Zone -->
                        <div class="upload-drop-zone" id="uploadDropZone">
                            <div class="drop-zone-content">
                                <div class="drop-zone-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="17,8 12,3 7,8"></polyline>
                                        <line x1="12" y1="3" x2="12" y2="15"></line>
                                    </svg>
                                </div>
                                <h4>Drag & Drop Files Here</h4>
                                <p>Or click to browse your computer</p>
                                <div class="file-type-info">
                                    <span>Supported: PDF, DOC, PPT, Images, TXT (Max 50MB)</span>
                                </div>
                            </div>
                            <input type="file" 
                                   id="fileInput" 
                                   multiple 
                                   accept=".pdf,.doc,.docx,.ppt,.pptx,.jpg,.jpeg,.png,.webp,.txt,.csv"
                                   onchange="handleFileSelection(event)"
                                   style="display: none;">
                        </div>

                        <!-- Upload Form -->
                        <div class="upload-form" id="uploadForm" style="display: none;">
                            <div class="form-section">
                                <label for="subjectSelect" class="form-label">Subject</label>
                                <select id="subjectSelect" class="form-select" required>
                                    <option value="">Select Subject</option>
                                    ${AppState.subjects.map(subject => `
                                        <option value="${subject.key}">${subject.icon} ${subject.name}</option>
                                    `).join('')}
                                </select>
                            </div>

                            <div class="form-section">
                                <label for="fileDescription" class="form-label">Description (Optional)</label>
                                <textarea id="fileDescription" 
                                         class="form-textarea" 
                                         placeholder="Add a description to help organize your files..."
                                         rows="3"></textarea>
                            </div>

                            <!-- File Preview List -->
                            <div class="upload-file-list" id="uploadFileList">
                                <!-- Files will be populated here -->
                            </div>

                            <!-- Upload Actions -->
                            <div class="upload-actions">
                                <button type="button" class="btn btn-secondary" onclick="resetUploadModal()">
                                    Reset
                                </button>
                                <button type="button" class="btn btn-primary" onclick="processFileUploads()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="17,8 12,3 7,8"></polyline>
                                        <line x1="12" y1="3" x2="12" y2="15"></line>
                                    </svg>
                                    Upload Files
                                </button>
                            </div>
                        </div>

                        <!-- Upload Progress -->
                        <div class="upload-progress-container" id="uploadProgressContainer" style="display: none;">
                            <div class="upload-progress-header">
                                <h4>Uploading Files...</h4>
                                <div class="upload-progress-stats">
                                    <span id="uploadProgressText">0 of 0 files</span>
                                </div>
                            </div>
                            <div class="upload-progress-bar">
                                <div class="upload-progress-fill" id="uploadProgressFill"></div>
                            </div>
                            <div class="upload-file-progress" id="uploadFileProgress">
                                <!-- Individual file progress will be shown here -->
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            setupUploadModalEvents();
        }

        function setupUploadModalEvents() {
            const dropZone = document.getElementById('uploadDropZone');
            const fileInput = document.getElementById('fileInput');

            // Click to browse
            dropZone.addEventListener('click', () => {
                fileInput.click();
            });

            // Drag and drop events
            dropZone.addEventListener('dragenter', (e) => {
                e.preventDefault();
                e.stopPropagation();
                dropZone.classList.add('drag-over');
            });

            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.stopPropagation();
            });

            dropZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                e.stopPropagation();
                if (!dropZone.contains(e.relatedTarget)) {
                    dropZone.classList.remove('drag-over');
                }
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                e.stopPropagation();
                dropZone.classList.remove('drag-over');
                
                const files = Array.from(e.dataTransfer.files);
                if (files.length > 0) {
                    handleFileSelection({ target: { files: files } });
                }
            });
        }

        let selectedUploadFiles = [];

        function handleFileSelection(event) {
            const files = Array.from(event.target.files);
            selectedUploadFiles = [];

            // Validate and process files
            for (const file of files) {
                try {
                    validateFile(file);
                    selectedUploadFiles.push({
                        file: file,
                        id: generateId(),
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        status: 'pending'
                    });
                } catch (error) {
                    showNotification(`${file.name}: ${error.message}`, 'error');
                }
            }

            if (selectedUploadFiles.length > 0) {
                showUploadForm();
                renderUploadFileList();
            }
        }

        function showUploadForm() {
            document.getElementById('uploadDropZone').style.display = 'none';
            document.getElementById('uploadForm').style.display = 'block';
        }

        function renderUploadFileList() {
            const container = document.getElementById('uploadFileList');
            
            container.innerHTML = `
                <div class="upload-list-header">
                    <h4>Selected Files (${selectedUploadFiles.length})</h4>
                    <span class="upload-total-size">Total: ${formatBytes(selectedUploadFiles.reduce((sum, f) => sum + f.size, 0))}</span>
                </div>
                <div class="upload-files">
                    ${selectedUploadFiles.map(fileData => `
                        <div class="upload-file-item" data-file-id="${fileData.id}">
                            <div class="upload-file-icon">
                                ${getFileIcon(fileData.type)}
                            </div>
                            <div class="upload-file-info">
                                <div class="upload-file-name">${sanitizeHTML(fileData.name)}</div>
                                <div class="upload-file-meta">
                                    ${formatBytes(fileData.size)} ‚Ä¢ ${fileData.type}
                                </div>
                            </div>
                            <div class="upload-file-actions">
                                <button class="btn btn-icon btn-sm btn-danger" 
                                        onclick="removeUploadFile('${fileData.id}')" 
                                        title="Remove">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3,6 5,6 21,6"></polyline>
                                        <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function removeUploadFile(fileId) {
            selectedUploadFiles = selectedUploadFiles.filter(f => f.id !== fileId);
            
            if (selectedUploadFiles.length === 0) {
                resetUploadModal();
            } else {
                renderUploadFileList();
            }
        }

        function resetUploadModal() {
            selectedUploadFiles = [];
            document.getElementById('uploadForm').style.display = 'none';
            document.getElementById('uploadProgressContainer').style.display = 'none';
            document.getElementById('uploadDropZone').style.display = 'block';
            
            // Reset form fields
            document.getElementById('subjectSelect').value = '';
            document.getElementById('fileDescription').value = '';
            document.getElementById('fileInput').value = '';
        }

        async function processFileUploads() {
            const subjectKey = document.getElementById('subjectSelect').value;
            const description = document.getElementById('fileDescription').value;

            if (!subjectKey) {
                showNotification('Please select a subject', 'warning');
                return;
            }

            // Show progress container
            document.getElementById('uploadForm').style.display = 'none';
            document.getElementById('uploadProgressContainer').style.display = 'block';

            let completed = 0;
            const total = selectedUploadFiles.length;

            // Update progress UI
            function updateProgress() {
                const percentage = (completed / total) * 100;
                document.getElementById('uploadProgressFill').style.width = `${percentage}%`;
                document.getElementById('uploadProgressText').textContent = `${completed} of ${total} files`;
            }

            updateProgress();

            // Process files one by one
            for (const fileData of selectedUploadFiles) {
                try {
                    fileData.status = 'uploading';
                    await processIndividualFile(fileData, subjectKey, description);
                    fileData.status = 'completed';
                    completed++;
                } catch (error) {
                    fileData.status = 'error';
                    fileData.error = error.message;
                    showNotification(`Failed to upload ${fileData.name}: ${error.message}`, 'error');
                    completed++; // Still count as processed
                }
                updateProgress();
            }

            // Show completion
            const successCount = selectedUploadFiles.filter(f => f.status === 'completed').length;
            const errorCount = selectedUploadFiles.filter(f => f.status === 'error').length;

            if (successCount > 0) {
                showNotification(`Successfully uploaded ${successCount} file${successCount > 1 ? 's' : ''}`, 'success');
            }

            if (errorCount > 0) {
                showNotification(`${errorCount} file${errorCount > 1 ? 's' : ''} failed to upload`, 'warning');
            }

            // Close modal after a delay
            setTimeout(() => {
                closeModal();
                if (AppState.currentView === 'files') {
                    renderView('files');
                }
            }, 2000);
        }

        async function processIndividualFile(fileData, subjectKey, description) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = async (e) => {
                    try {
                        const newFile = {
                            id: generateId(),
                            name: fileData.name,
                            type: fileData.type,
                            size: fileData.size,
                            dataUrl: e.target.result,
                            subjectKey: subjectKey,
                            description: description,
                            addedAt: Date.now(),
                            lastModified: Date.now()
                        };

                        // Add to app state
                        AppState.files.push(newFile);
                        
                        // Save to localStorage
                        localStorage.setItem('ahx_files', JSON.stringify(AppState.files));

                        // Send to n8n webhook
                        await sendFileDataToN8N(newFile);
                        
                        resolve(newFile);
                    } catch (error) {
                        reject(error);
                    }
                };

                reader.onerror = () => {
                    reject(new Error('Failed to read file'));
                };

                reader.readAsDataURL(fileData.file);
            });
        }

        async function sendFileDataToN8N(fileData) {
            try {
                const payload = {
                    file_name: fileData.name,
                    file_id: fileData.id,
                    file_size: fileData.size,
                    content_type: fileData.type,
                    subject_key: fileData.subjectKey,
                    description: fileData.description || '',
                    upload_timestamp: new Date(fileData.addedAt).toISOString(),
                    user_id: AppState.user?.id || 'anonymous',
                    file_hash: await generateFileHash(fileData.dataUrl)
                };

                const response = await fetch(WEBHOOK_ENDPOINTS.fileUpload, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`Upload failed: ${response.statusText}`);
                }

                return await response.json();
            } catch (error) {
                console.warn('Failed to sync file with backend:', error);
                // Don't throw - allow local storage to succeed
            }
        }

        async function generateFileHash(dataUrl) {
            try {
                const response = await fetch(dataUrl);
                const buffer = await response.arrayBuffer();
                const hashBuffer = await crypto.subtle.digest('SHA-256', buffer);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            } catch (error) {
                return generateId(); // fallback
            }
        }

        // Complete Files View Rendering
        function renderFilesView() {
            const filteredFiles = applyCurrentFilters();
            const hasFiles = filteredFiles.length > 0;
            const hasSelection = selectedFiles.size > 0;

            return `
                <div class="files-view">
                    <div class="files-header">
                        <div class="files-title-section">
                            <h2 class="page-title">Files Management</h2>
                            <p class="page-subtitle">Organize and manage your academic documents</p>
                        </div>
                        
                        <div class="files-actions">
                            <button class="btn btn-secondary" onclick="importData()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17,8 12,3 7,8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                Import
                            </button>
                            
                            <button class="btn btn-secondary" onclick="exportData()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7,10 12,15 17,10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                                Export
                            </button>
                            
                            <button class="btn btn-primary" onclick="openUploadModal()">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17,8 12,3 7,8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                Upload Files
                            </button>
                        </div>
                    </div>

                    <!-- File Filters and Search -->
                    <div class="files-filters">
                        <div class="filter-row">
                            <div class="search-container">
                                <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="m21 21-4.35-4.35"></path>
                                </svg>
                                <input 
                                    type="text" 
                                    class="search-input" 
                                    placeholder="Search files..." 
                                    id="fileSearchInput"
                                    value="${currentFilter.searchTerm}"
                                    oninput="updateFileSearch(this.value)"
                                />
                                ${currentFilter.searchTerm ? `
                                    <button class="search-clear" onclick="clearFileSearch()" title="Clear search">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <line x1="18" y1="6" x2="6" y2="18"></line>
                                            <line x1="6" y1="6" x2="18" y2="18"></line>
                                        </svg>
                                    </button>
                                ` : ''}
                            </div>
                            
                            <select class="filter-select" onchange="updateSubjectFilter(this.value)" value="${currentFilter.subject}">
                                <option value="">All Subjects</option>
                                ${AppState.subjects.map(subject => `
                                    <option value="${subject.key}" ${currentFilter.subject === subject.key ? 'selected' : ''}>
                                        ${subject.name}
                                    </option>
                                `).join('')}
                            </select>
                            
                            <select class="filter-select" onchange="updateTypeFilter(this.value)" value="${currentFilter.type}">
                                <option value="">All Types</option>
                                <option value="application/pdf" ${currentFilter.type === 'application/pdf' ? 'selected' : ''}>PDF</option>
                                <option value="application/msword" ${currentFilter.type === 'application/msword' ? 'selected' : ''}>Word</option>
                                <option value="image/" ${currentFilter.type === 'image/' ? 'selected' : ''}>Images</option>
                                <option value="text/" ${currentFilter.type === 'text/' ? 'selected' : ''}>Text</option>
                            </select>
                            
                            <select class="filter-select" onchange="updateDateFilter(this.value)" value="${currentFilter.dateRange}">
                                <option value="">All Time</option>
                                <option value="today" ${currentFilter.dateRange === 'today' ? 'selected' : ''}>Today</option>
                                <option value="week" ${currentFilter.dateRange === 'week' ? 'selected' : ''}>This Week</option>
                                <option value="month" ${currentFilter.dateRange === 'month' ? 'selected' : ''}>This Month</option>
                            </select>
                        </div>
                        
                        <div class="filter-row">
                            <div class="sort-controls">
                                <label>Sort by:</label>
                                <select class="sort-select" onchange="updateSort(this.value)" value="${currentSort.field}">
                                    <option value="addedAt" ${currentSort.field === 'addedAt' ? 'selected' : ''}>Date Added</option>
                                    <option value="name" ${currentSort.field === 'name' ? 'selected' : ''}>Name</option>
                                    <option value="size" ${currentSort.field === 'size' ? 'selected' : ''}>Size</option>
                                    <option value="type" ${currentSort.field === 'type' ? 'selected' : ''}>Type</option>
                                </select>
                                
                                <button class="btn btn-icon sort-direction" onclick="toggleSortDirection()" title="Sort Direction">
                                    ${currentSort.direction === 'desc' ? `
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="m3 16 4 4 4-4"></path>
                                            <path d="M7 20V4"></path>
                                        </svg>
                                    ` : `
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="m3 8 4-4 4 4"></path>
                                            <path d="M7 4v16"></path>
                                        </svg>
                                    `}
                                </button>
                            </div>
                            
                            <div class="view-controls">
                                <button class="btn btn-icon view-toggle active" onclick="toggleView('grid')" title="Grid View" id="gridViewBtn">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="7" height="7"></rect>
                                        <rect x="14" y="3" width="7" height="7"></rect>
                                        <rect x="14" y="14" width="7" height="7"></rect>
                                        <rect x="3" y="14" width="7" height="7"></rect>
                                    </svg>
                                </button>
                                <button class="btn btn-icon view-toggle" onclick="toggleView('list')" title="List View" id="listViewBtn">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="8" y1="6" x2="21" y2="6"></line>
                                        <line x1="8" y1="12" x2="21" y2="12"></line>
                                        <line x1="8" y1="18" x2="21" y2="18"></line>
                                        <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                        <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                        <line x1="3" y1="18" x2="3.01" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        ${hasSelection ? `
                            <div class="selection-bar">
                                <div class="selection-info">
                                    <span>${selectedFiles.size} file${selectedFiles.size > 1 ? 's' : ''} selected</span>
                                </div>
                                <div class="selection-actions">
                                    <button class="btn btn-secondary btn-sm" onclick="batchDownload()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                            <polyline points="7,10 12,15 17,10"></polyline>
                                            <line x1="12" y1="15" x2="12" y2="3"></line>
                                        </svg>
                                        Download
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="batchDeleteFiles()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="3,6 5,6 21,6"></polyline>
                                            <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                                        </svg>
                                        Delete
                                    </button>
                                    <button class="btn btn-ghost btn-sm" onclick="clearSelection()">
                                        Clear Selection
                                    </button>
                                </div>
                            </div>
                        ` : ''}
                    </div>

                    <!-- Files Content -->
                    <div class="files-content" id="filesContent">
                        ${hasFiles ? renderFilesList(filteredFiles) : renderEmptyState()}
                    </div>

                    <!-- Files Stats -->
                    ${hasFiles ? `
                        <div class="files-stats">
                            <div class="stats-item">
                                <span class="stats-label">Total:</span>
                                <span class="stats-value">${filteredFiles.length} files</span>
                            </div>
                            <div class="stats-item">
                                <span class="stats-label">Size:</span>
                                <span class="stats-value">${formatBytes(filteredFiles.reduce((sum, f) => sum + (f.size || 0), 0))}</span>
                            </div>
                            <div class="stats-item">
                                <span class="stats-label">Selected:</span>
                                <span class="stats-value">${selectedFiles.size} files</span>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderFilesList(files) {
            const viewMode = localStorage.getItem('files_view_mode') || 'grid';
            
            if (viewMode === 'list') {
                return `
                    <div class="files-list-view">
                        ${files.map(file => renderFileListItem(file)).join('')}
                    </div>
                `;
            } else {
                return `
                    <div class="files-grid-view">
                        ${files.map(file => renderFileGridItem(file)).join('')}
                    </div>
                `;
            }
        }

        function renderFileGridItem(file) {
            const isSelected = selectedFiles.has(file.id);
            const subjectInfo = AppState.subjects.find(s => s.key === file.subjectKey);
            
            return `
                <div class="file-card ${isSelected ? 'selected' : ''}" 
                     onclick="handleFileClick('${file.id}', event)"
                     data-file-id="${file.id}">
                    
                    <div class="file-card-header">
                        <div class="file-selection">
                            <input type="checkbox" 
                                   ${isSelected ? 'checked' : ''} 
                                   onchange="toggleFileSelection('${file.id}')"
                                   onclick="event.stopPropagation()">
                        </div>
                        <div class="file-actions-menu">
                            <button class="btn btn-icon btn-sm" onclick="event.stopPropagation(); showFileMenu('${file.id}', event)" title="More options">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="1"></circle>
                                    <circle cx="12" cy="5" r="1"></circle>
                                    <circle cx="12" cy="19" r="1"></circle>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="file-preview">
                        <div class="file-icon-large">${getFileIcon(file.type)}</div>
                        ${file.thumbnail ? `<img src="${file.thumbnail}" alt="Preview" class="file-thumbnail">` : ''}
                    </div>
                    
                    <div class="file-info">
                        <h3 class="file-name" title="${sanitizeHTML(file.name)}">${sanitizeHTML(file.name)}</h3>
                        <div class="file-meta">
                            <div class="file-subject">
                                <span class="subject-icon">${subjectInfo?.icon || 'üìÑ'}</span>
                                <span class="subject-name">${getSubjectName(file.subjectKey)}</span>
                            </div>
                            <div class="file-details">
                                <span class="file-size">${formatBytes(file.size)}</span>
                                <span class="file-date">${formatDate(file.addedAt)}</span>
                            </div>
                        </div>
                        ${file.description ? `
                            <p class="file-description">${sanitizeHTML(file.description)}</p>
                        ` : ''}
                    </div>
                    
                    <div class="file-actions">
                        <button class="btn btn-icon btn-sm" onclick="event.stopPropagation(); downloadFile('${file.id}')" title="Download">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7,10 12,15 17,10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                        </button>
                        <button class="btn btn-icon btn-sm" onclick="event.stopPropagation(); shareFile('${file.id}')" title="Share">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="18" cy="5" r="3"></circle>
                                <circle cx="6" cy="12" r="3"></circle>
                                <circle cx="18" cy="19" r="3"></circle>
                                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                            </svg>
                        </button>
                        <button class="btn btn-icon btn-sm btn-danger" onclick="event.stopPropagation(); deleteFile('${file.id}')" title="Delete">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3,6 5,6 21,6"></polyline>
                                <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            `;
        }

        function renderFileListItem(file) {
            const isSelected = selectedFiles.has(file.id);
            const subjectInfo = AppState.subjects.find(s => s.key === file.subjectKey);
            
            return `
                <div class="file-list-item ${isSelected ? 'selected' : ''}" 
                     onclick="handleFileClick('${file.id}', event)"
                     data-file-id="${file.id}">
                    
                    <div class="file-list-selection">
                        <input type="checkbox" 
                               ${isSelected ? 'checked' : ''} 
                               onchange="toggleFileSelection('${file.id}')"
                               onclick="event.stopPropagation()">
                    </div>
                    
                    <div class="file-list-icon">
                        ${getFileIcon(file.type)}
                    </div>
                    
                    <div class="file-list-info">
                        <div class="file-list-name">${sanitizeHTML(file.name)}</div>
                        <div class="file-list-meta">
                            <span class="file-subject">${subjectInfo?.icon} ${getSubjectName(file.subjectKey)}</span>
                            ${file.description ? `<span class="file-description-preview">${sanitizeHTML(file.description.substring(0, 50))}${file.description.length > 50 ? '...' : ''}</span>` : ''}
                        </div>
                    </div>
                    
                    <div class="file-list-size">${formatBytes(file.size)}</div>
                    <div class="file-list-date">${formatDate(file.addedAt)}</div>
                    
                    <div class="file-list-actions">
                        <button class="btn btn-icon btn-sm" onclick="event.stopPropagation(); downloadFile('${file.id}')" title="Download">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7,10 12,15 17,10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                        </button>
                        <button class="btn btn-icon btn-sm" onclick="event.stopPropagation(); showFileMenu('${file.id}', event)" title="More options">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="1"></circle>
                                <circle cx="12" cy="5" r="1"></circle>
                                <circle cx="12" cy="19" r="1"></circle>
                            </svg>
                        </button>
                    </div>
                </div>
            `;
        }

        function renderEmptyState() {
            return `
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                            <polyline points="13,2 13,9 20,9"></polyline>
                        </svg>
                    </div>
                    <h3 class="empty-state-title">No files found</h3>
                    <p class="empty-state-description">
                        ${currentFilter.searchTerm || currentFilter.subject || currentFilter.type || currentFilter.dateRange 
                            ? 'No files match your current filters. Try adjusting your search criteria.'
                            : 'Start building your academic library by uploading your first document.'}
                    </p>
                    <div class="empty-state-actions">
                        ${currentFilter.searchTerm || currentFilter.subject || currentFilter.type || currentFilter.dateRange 
                            ? `<button class="btn btn-secondary" onclick="clearAllFilters()">Clear Filters</button>`
                            : `<button class="btn btn-primary" onclick="openUploadModal()">Upload Your First File</button>`}
                    </div>
                </div>
            `;
        }
        /* ===================================
   Academic Hub X - Complete CSS System (Continued)
   =================================== */

/* Stats Grid System */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-xl);
    padding: 2rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    cursor: pointer;
    transition: var(--transition-normal);
    position: relative;
    overflow: hidden;
}

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--glass-shadow), 0 20px 40px rgba(0, 0, 0, 0.1);
    border-color: var(--primary);
}

.stat-icon {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    display: block;
}

.stat-value {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.stat-label {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-weight: 500;
}

.stat-trend {
    font-size: 0.8rem;
    color: var(--success);
    margin-top: 0.5rem;
    opacity: 0.8;
}

/* Quick Actions Grid */
.quick-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.action-card {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-xl);
    padding: 2rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
    cursor: pointer;
    transition: var(--transition-normal);
    text-decoration: none;
    color: var(--text-primary);
}

.action-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary);
    background: var(--glass-border);
}

.action-icon {
    width: 60px;
    height: 60px;
    background: var(--gradient-primary);
    border-radius: var(--radius-xl);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.action-icon svg {
    width: 28px;
    height: 28px;
    color: white;
}

.action-content h4 {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
}

.action-content p {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin: 0;
}

/* File Management Styles */
.files-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    gap: 2rem;
}

.files-title-section {
    flex: 1;
}

.files-actions {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.files-filters {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-xl);
    padding: 2rem;
    margin-bottom: 2rem;
}

.filter-row {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
}

.filter-row:last-child {
    margin-bottom: 0;
}

.search-container {
    position: relative;
    flex: 1;
    max-width: 400px;
}

.search-input {
    width: 100%;
    padding: 0.75rem 2.5rem 0.75rem 2.5rem;
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-lg);
    background: var(--bg-tertiary);
    color: var(--text-primary);
    font-size: 0.9rem;
    transition: var(--transition-normal);
}

.search-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.search-icon {
    position: absolute;
    left: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    width: 18px;
    height: 18px;
    color: var(--text-tertiary);
}

.search-clear {
    position: absolute;
    right: 0.5rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    padding: 0.25rem;
    cursor: pointer;
    border-radius: var(--radius-sm);
    color: var(--text-tertiary);
    transition: var(--transition-fast);
}

.search-clear:hover {
    background: var(--glass-bg);
    color: var(--text-primary);
}

.search-clear svg {
    width: 16px;
    height: 16px;
}

.filter-select {
    padding: 0.75rem 1rem;
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-lg);
    background: var(--bg-tertiary);
    color: var(--text-primary);
    font-size: 0.9rem;
    min-width: 150px;
    transition: var(--transition-normal);
}

.filter-select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.sort-controls {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.sort-controls label {
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-secondary);
}

.sort-select {
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-md);
    background: var(--bg-tertiary);
    color: var(--text-primary);
    font-size: 0.9rem;
    min-width: 120px;
}

.sort-direction {
    padding: 0.5rem;
}

.sort-direction svg {
    width: 16px;
    height: 16px;
}

.view-controls {
    display: flex;
    gap: 0.5rem;
}

.view-toggle {
    padding: 0.5rem;
    border: 1px solid var(--border-primary);
    background: transparent;
    color: var(--text-secondary);
}

.view-toggle.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

.view-toggle svg {
    width: 16px;
    height: 16px;
}

/* Selection Bar */
.selection-bar {
    background: var(--primary);
    color: white;
    padding: 1rem 2rem;
    border-radius: var(--radius-lg);
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.selection-info {
    font-weight: 600;
}

.selection-actions {
    display: flex;
    gap: 1rem;
    align-items: center;
}

/* Files Grid View */
.files-grid-view {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 2rem;
}

.file-card {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-xl);
    padding: 1.5rem;
    transition: var(--transition-normal);
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.file-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
    border-color: var(--primary);
}

.file-card.selected {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
}

.file-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.file-selection input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: var(--primary);
    cursor: pointer;
}

.file-actions-menu {
    opacity: 0;
    transition: var(--transition-fast);
}

.file-card:hover .file-actions-menu {
    opacity: 1;
}

.file-preview {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 120px;
    margin-bottom: 1.5rem;
    background: var(--bg-tertiary);
    border-radius: var(--radius-lg);
    position: relative;
    overflow: hidden;
}

.file-icon-large {
    font-size: 3rem;
}

.file-thumbnail {
    max-width: 100%;
    max-height: 100%;
    object-fit: cover;
    border-radius: var(--radius-md);
}

.file-info {
    margin-bottom: 1rem;
}

.file-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.file-meta {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.file-subject {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
}

.subject-icon {
    font-size: 1rem;
}

.subject-name {
    color: var(--text-secondary);
    font-weight: 500;
}

.file-details {
    display: flex;
    gap: 1rem;
    font-size: 0.8rem;
    color: var(--text-tertiary);
}

.file-description {
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-top: 0.5rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.file-actions {
    display: flex;
    gap: 0.5rem;
    opacity: 0;
    transition: var(--transition-fast);
}

.file-card:hover .file-actions {
    opacity: 1;
}

/* Files List View */
.files-list-view {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.file-list-item {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    display: grid;
    grid-template-columns: auto auto 1fr auto auto auto;
    gap: 1rem;
    align-items: center;
    transition: var(--transition-normal);
    cursor: pointer;
}

.file-list-item:hover {
    border-color: var(--primary);
    box-shadow: var(--shadow-md);
}

.file-list-item.selected {
    border-color: var(--primary);
    background: rgba(102, 126, 234, 0.05);
}

.file-list-selection input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: var(--primary);
}

.file-list-icon {
    font-size: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-md);
}

.file-list-info {
    min-width: 0;
}

.file-list-name {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.file-list-meta {
    display: flex;
    gap: 1rem;
    align-items: center;
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.file-list-size,
.file-list-date {
    font-size: 0.9rem;
    color: var(--text-secondary);
    white-space: nowrap;
}

.file-list-actions {
    display: flex;
    gap: 0.5rem;
    opacity: 0;
    transition: var(--transition-fast);
}

.file-list-item:hover .file-list-actions {
    opacity: 1;
}

/* Files Stats */
.files-stats {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-lg);
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 2rem;
}

.stats-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.stats-label {
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.stats-value {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-primary);
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-xl);
}

.empty-state-icon {
    width: 80px;
    height: 80px;
    margin: 0 auto 2rem;
    opacity: 0.5;
}

.empty-state-icon svg {
    width: 100%;
    height: 100%;
    color: var(--text-tertiary);
}

.empty-state-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.empty-state-description {
    font-size: 1rem;
    color: var(--text-secondary);
    max-width: 500px;
    margin: 0 auto 2rem;
}

.empty-state-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    align-items: center;
}

/* QR Scanner Styles */
.qr-view {
    max-width: 1000px;
    margin: 0 auto;
}

.qr-scanner-container {
    display: flex;
    justify-content: center;
    margin-bottom: 3rem;
}

.qr-scanner-panel {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-xl);
    padding: 2rem;
    text-align: center;
    width: 100%;
    max-width: 600px;
}

.qr-scanner-header {
    margin-bottom: 2rem;
}

.qr-scanner-header h3 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.qr-scanner-header p {
    color: var(--text-secondary);
    margin: 0;
}

.qr-scanner-area {
    position: relative;
    margin-bottom: 2rem;
    border-radius: var(--radius-lg);
    overflow: hidden;
    background: var(--bg-secondary);
    min-height: 300px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.qr-reader {
    width: 100%;
    max-width: 400px;
}

.qr-scanner-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
}

.qr-target-box {
    position: relative;
    width: 200px;
    height: 200px;
    border: 2px solid transparent;
}

.qr-corner {
    position: absolute;
    width: 30px;
    height: 30px;
    border: 3px solid var(--primary);
}

.qr-corner.top-left {
    top: -2px;
    left: -2px;
    border-right: none;
    border-bottom: none;
}

.qr-corner.top-right {
    top: -2px;
    right: -2px;
    border-left: none;
    border-bottom: none;
}

.qr-corner.bottom-left {
    bottom: -2px;
    left: -2px;
    border-right: none;
    border-top: none;
}

.qr-corner.bottom-right {
    bottom: -2px;
    right: -2px;
    border-left: none;
    border-top: none;
}

.qr-scanner-controls {
    margin-bottom: 2rem;
}

.qr-status {
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
    padding: 1rem;
    font-size: 0.9rem;
    color: var(--text-secondary);
    border: 1px solid var(--border-primary);
}

/* QR History */
.qr-history-section {
    margin-top: 3rem;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.section-header h3 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
}

.qr-history-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.qr-history-item {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 1rem;
    align-items: center;
    transition: var(--transition-normal);
}

.qr-history-item:hover {
    border-color: var(--primary);
    box-shadow: var(--shadow-md);
}

.qr-history-icon {
    font-size: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-md);
}

.qr-history-content {
    min-width: 0;
}

.qr-history-text {
    font-size: 0.95rem;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    word-break: break-word;
}

.qr-history-meta {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.qr-history-date {
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.qr-history-type {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    background: var(--bg-tertiary);
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
    text-transform: uppercase;
    font-weight: 600;
}

.qr-history-actions {
    display: flex;
    gap: 0.5rem;
}

.qr-empty-state {
    text-align: center;
    padding: 3rem;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-xl);
}

/* QR Instructions */
.qr-instructions {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-xl);
    padding: 2rem;
    margin-top: 3rem;
}

.qr-instructions h4 {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 1.5rem;
    text-align: center;
}

.instruction-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
}

.instruction-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
}

.instruction-icon {
    width: 40px;
    height: 40px;
    background: var(--gradient-primary);
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 700;
    font-size: 1.1rem;
    flex-shrink: 0;
}

.instruction-text h5 {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.instruction-text p {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin: 0;
}

/* Subjects View */
.subjects-grid-full {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

.subject-card-detailed {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-xl);
    padding: 2rem;
    cursor: pointer;
    transition: var(--transition-normal);
    position: relative;
    overflow: hidden;
}

.subject-card-detailed:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
    border-color: var(--primary);
}

.subject-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.subject-icon-large {
    font-size: 3rem;
    width: 80px;
    height: 80px;
    background: var(--gradient-primary);
    border-radius: var(--radius-xl);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-lg);
}

.subject-actions {
    opacity: 0;
    transition: var(--transition-fast);
}

.subject-card-detailed:hover .subject-actions {
    opacity: 1;
}

.subject-info-detailed {
    margin-bottom: 1.5rem;
}

.subject-info-detailed .subject-name {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    line-height: 1.3;
}

.subject-code {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-weight: 600;
    margin-bottom: 1rem;
}

.subject-faculty,
.subject-location {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.faculty-label,
.location-label {
    font-size: 0.85rem;
    color: var(--text-secondary);
    font-weight: 500;
}

.faculty-name,
.location-name {
    font-size: 0.85rem;
    color: var(--text-primary);
    font-weight: 600;
}

.subject-stats-detailed {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border-primary);
}

.subject-stat {
    text-align: center;
}

.subject-stat .stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
}

.subject-stat .stat-label {
    font-size: 0.8rem;
    color: var(--text-secondary);
    font-weight: 500;
}

.subjects-summary {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-xl);
    padding: 2rem;
}

.subjects-summary h3 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 1.5rem;
}

.summary-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.summary-stat {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: var(--bg-tertiary);
    border-radius: var(--radius-lg);
}

.summary-label {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-weight: 500;
}

.summary-value {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text-primary);
}

/* Search View */
.search-container-main {
    max-width: 800px;
    margin: 0 auto 3rem;
}

.search-input-container {
    position: relative;
    margin-bottom: 2rem;
}

.search-icon-main {
    position: absolute;
    left: 1.5rem;
    top: 50%;
    transform: translateY(-50%);
    width: 20px;
    height: 20px;
    color: var(--text-tertiary);
}

.search-input-main {
    width: 100%;
    padding: 1.25rem 2rem 1.25rem 4rem;
    border: 2px solid var(--border-primary);
    border-radius: var(--radius-full);
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    color: var(--text-primary);
    font-size: 1.1rem;
    transition: var(--transition-normal);
}

.search-input-main:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
}

.search-input-main::placeholder {
    color: var(--text-tertiary);
}

.search-filters-main {
    display: flex;
    justify-content: center;
    gap: 1rem;
}

.search-filter-select {
    padding: 0.75rem 1rem;
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-lg);
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    color: var(--text-primary);
    font-size: 0.9rem;
    min-width: 150px;
}

.search-results {
    max-width: 900px;
    margin: 0 auto;
}

.search-placeholder {
    text-align: center;
    padding: 4rem 2rem;
}

.search-placeholder-icon {
    width: 80px;
    height: 80px;
    margin: 0 auto 2rem;
    opacity: 0.3;
}

.search-placeholder-icon svg {
    width: 100%;
    height: 100%;
    color: var(--text-tertiary);
}

.search-placeholder h3 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.search-placeholder p {
    font-size: 1rem;
    color: var(--text-secondary);
    margin: 0;
}

.search-no-results {
    text-align: center;
    padding: 4rem 2rem;
}

.search-no-results-icon {
    width: 80px;
    height: 80px;
    margin: 0 auto 2rem;
    opacity: 0.3;
}

.search-no-results-icon svg {
    width: 100%;
    height: 100%;
    color: var(--text-tertiary);
}

.search-no-results h3 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.search-no-results p {
    font-size: 1rem;
    color: var(--text-secondary);
    margin: 0;
}

.search-results-header {
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border-primary);
}

.search-results-header h3 {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
}

.search-results-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.search-result-item {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 1rem;
    align-items: center;
    cursor: pointer;
    transition: var(--transition-normal);
}

.search-result-item:hover {
    border-color: var(--primary);
    box-shadow: var(--shadow-md);
}

.search-result-icon {
    font-size: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 50px;
    height: 50px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-lg);
}

.search-result-info {
    min-width: 0;
}

.search-result-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.search-result-title mark {
    background: rgba(102, 126, 234, 0.2);
    color: var(--primary);
    padding: 0.125rem 0.25rem;
    border-radius: var(--radius-sm);
}

.search-result-meta {
    display: flex;
    gap: 1rem;
    align-items: center;
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.search-result-description {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin-top: 0.5rem;
    line-height: 1.4;
}

.search-result-description mark {
    background: rgba(102, 126, 234, 0.2);
    color: var(--primary);
    padding: 0.125rem 0.25rem;
    border-radius: var(--radius-sm);
}

.search-result-actions {
    display: flex;
    gap: 0.5rem;
}

/* Modal System */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: var(--bg-modal);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: var(--transition-normal);
    padding: 2rem;
}

.modal.active {
    opacity: 1;
    visibility: visible;
}

.modal-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
}

.modal-panel {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-xl);
    max-width: 90vw;
    max-height: 90vh;
    width: 600px;
    overflow: hidden;
    box-shadow: var(--shadow-xl);
    transform: scale(0.9);
    transition: var(--transition-spring);
    z-index: 1001;
    position: relative;
}

.modal.active .modal-panel {
    transform: scale(1);
}

.modal-header {
    padding: 2rem 2rem 1rem 2rem;
    border-bottom: 1px solid var(--border-primary);
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
}

.modal-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin: 0;
}

.modal-subtitle {
    font-size: 0.95rem;
    color: var(--text-secondary);
    margin: 0.5rem 0 0 0;
}

.modal-actions {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.modal-body {
    padding: 2rem;
    overflow-y: auto;
    max-height: 70vh;
}

/* Upload Modal Styles */
.upload-modal .modal-panel {
    width: 800px;
    max-width: 95vw;
}

.upload-drop-zone {
    border: 2px dashed var(--border-primary);
    border-radius: var(--radius-xl);
    padding: 3rem 2rem;
    text-align: center;
    cursor: pointer;
    transition: var(--transition-normal);
    background: var(--bg-tertiary);
}

.upload-drop-zone:hover,
.upload-drop-zone.drag-over {
    border-color: var(--primary);
    background: rgba(102, 126, 234, 0.05);
}

.drop-zone-content {
    pointer-events: none;
}

.drop-zone-icon {
    width: 60px;
    height: 60px;
    margin: 0 auto 1.5rem;
    color: var(--text-tertiary);
}

.drop-zone-icon svg {
    width: 100%;
    height: 100%;
}

.drop-zone-content h4 {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.drop-zone-content p {
    font-size: 1rem;
    color: var(--text-secondary);
    margin-bottom: 1rem;
}

.file-type-info {
    font-size: 0.85rem;
    color: var(--text-tertiary);
}

/* Form Styles */
.form-section {
    margin-bottom: 1.5rem;
}

.form-label {
    display: block;
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.form-select {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-lg);
    background: var(--bg-tertiary);
    color: var(--text-primary);
    font-size: 0.9rem;
    transition: var(--transition-normal);
}

.form-select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.form-textarea {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-lg);
    background: var(--bg-tertiary);
    color: var(--text-primary);
    font-size: 0.9rem;
    font-family: var(--font-primary);
    resize: vertical;
    min-height: 80px;
    transition: var(--transition-normal);
}

.form-textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.form-textarea::placeholder {
    color: var(--text-tertiary);
}

/* Upload File List */
.upload-file-list {
    margin: 2rem 0;
}

.upload-list-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--border-primary);
}

.upload-list-header h4 {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
}

.upload-total-size {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-weight: 500;
}

.upload-files {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.upload-file-item {
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 1rem;
    align-items: center;
    padding: 1rem;
    background: var(--bg-tertiary);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-primary);
    transition: var(--transition-normal);
}

.upload-file-item:hover {
    border-color: var(--primary);
}

.upload-file-icon {
    font-size: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: var(--glass-bg);
    border-radius: var(--radius-md);
}

.upload-file-info {
    min-width: 0;
}

.upload-file-name {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.upload-file-meta {
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.upload-actions {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid var(--border-primary);
}

/* Upload Progress */
.upload-progress-container {
    text-align: center;
}

.upload-progress-header {
    margin-bottom: 1.5rem;
}

.upload-progress-header h4 {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.upload-progress-stats {
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.upload-progress-bar {
    width: 100%;
    height: 8px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-full);
    overflow: hidden;
    margin-bottom: 2rem;
}

.upload-progress-fill {
    height: 100%;
    background: var(--gradient-primary);
    border-radius: var(--radius-full);
    transition: width 0.3s ease;
    width: 0%;
}

/* File Preview Modal */
.file-preview-modal .modal-panel {
    width: 1000px;
    max-width: 95vw;
    max-height: 95vh;
}

.file-preview-panel .modal-header {
    padding: 1.5rem 2rem;
}

.file-preview-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.file-preview-icon {
    font-size: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 60px;
    height: 60px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-lg);
}

.file-preview-meta {
    font-size: 0.85rem;
    color: var(--text-secondary);
    display: flex;
    gap: 1rem;
    align-items: center;
    margin-top: 0.25rem;
}

.file-preview-content {
    overflow: auto;
    max-height: 70vh;
}

.image-preview {
    text-align: center;
    padding: 2rem;
}

.preview-image {
    max-width: 100%;
    max-height: 600px;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
}

.text-preview {
    padding: 1rem;
}

.text-content {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.85rem;
    line-height: 1.5;
    background: var(--bg-secondary);
    padding: 1.5rem;
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-primary);
    white-space: pre-wrap;
    word-break: break-word;
    max-height: 500px;
    overflow: auto;
    color: var(--text-primary);
}

.preview-placeholder {
    text-align: center;
    padding: 4rem 2rem;
}

.preview-placeholder svg {
    width: 80px;
    height: 80px;
    color: var(--text-tertiary);
    margin-bottom: 1.5rem;
}

.preview-placeholder h4 {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.preview-placeholder p {
    font-size: 0.95rem;
    color: var(--text-secondary);
    margin-bottom: 1rem;
}

.file-icon-huge {
    font-size: 4rem;
    margin-bottom: 1rem;
    display: block;
}

/* Notification System */
.notification-container {
    position: fixed;
    top: 2rem;
    right: 2rem;
    z-index: 10000;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    max-width: 400px;
    width: 100%;
}

.notification {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-lg);
    padding: 0;
    box-shadow: var(--shadow-xl);
    transform: translateX(100%);
    opacity: 0;
    transition: var(--transition-spring);
    overflow: hidden;
}

.notification.show {
    transform: translateX(0);
    opacity: 1;
}

.notification.hiding {
    transform: translateX(100%);
    opacity: 0;
}

.notification.success {
    border-left: 4px solid var(--success);
}

.notification.warning {
    border-left: 4px solid var(--warning);
}

.notification.error {
    border-left: 4px solid var(--error);
}

.notification.info {
    border-left: 4px solid var(--info);
}

.notification-content {
    padding: 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
}

.notification-text {
    flex: 1;
    font-size: 0.9rem;
    color: var(--text-primary);
    line-height: 1.4;
}

.notification-actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 1rem;
}

.notification-close {
    background: none;
    border: none;
    color: var(--text-tertiary);
    cursor: pointer;
    padding: 0.25rem;
    border-radius: var(--radius-sm);
    transition: var(--transition-fast);
    flex-shrink: 0;
}

.notification-close:hover {
    background: var(--glass-bg);
    color: var(--text-primary);
}

.notification-close svg {
    width: 16px;
    height: 16px;
}

/* Floating Action Button */
.fab-container {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    z-index: 500;
}

.fab {
    width: 56px;
    height: 56px;
    border-radius: var(--radius-full);
    background: var(--gradient-primary);
    color: white;
    border: none;
    cursor: pointer;
    box-shadow: var(--shadow-lg);
    transition: var(--transition-normal);
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.fab:hover {
    box-shadow: var(--shadow-xl);
    transform: translateY(-2px);
}

.fab.active {
    transform: rotate(45deg);
}

.fab-icon {
    width: 24px;
    height: 24px;
    transition: var(--transition-normal);
}

.fab-sm {
    width: 48px;
    height: 48px;
}

.fab-sm svg {
    width: 20px;
    height: 20px;
}

.fab-menu {
    position: absolute;
    bottom: 70px;
    right: 0;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    opacity: 0;
    visibility: hidden;
    transform: translateY(20px);
    transition: var(--transition-spring);
}

.fab-menu.active {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

/* Drop Overlay */
.drop-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(102, 126, 234, 0.1);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9998;
    opacity: 0;
    visibility: hidden;
    transition: var(--transition-normal);
    pointer-events: none;
}

.drop-overlay.active {
    opacity: 1;
    visibility: visible;
}

.drop-content {
    text-align: center;
    color: white;
    padding: 3rem;
    background: rgba(102, 126, 234, 0.9);
    border-radius: var(--radius-xl);
    border: 2px dashed rgba(255, 255, 255, 0.5);
}

.drop-icon {
    width: 80px;
    height: 80px;
    margin: 0 auto 1.5rem;
}

.drop-icon svg {
    width: 100%;
    height: 100%;
}

.drop-content h3 {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.drop-content p {
    font-size: 1rem;
    opacity: 0.9;
    margin: 0;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .main-content {
        padding: 1.5rem;
    }
    
    .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }
    
    .quick-actions {
        grid-template-columns: 1fr;
    }
    
    .files-grid-view {
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
    }
    
    .subjects-grid-full {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .nav-header {
        padding: 0 1rem;
    }
    
    .nav-menu {
        position: fixed;
        top: 70px;
        left: 0;
        right: 0;
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--glass-border);
        padding: 1rem;
        flex-direction: column;
        gap: 0.5rem;
        transform: translateY(-100%);
        opacity: 0;
        visibility: hidden;
        transition: var(--transition-normal);
    }
    
    .nav-menu.mobile-open {
        transform: translateY(0);
        opacity: 1;
        visibility: visible;
    }
    
    .nav-item {
        width: 100%;
        justify-content: flex-start;
        padding: 1rem;
    }
    
    .mobile-menu-toggle {
        display: flex;
    }
    
    .nav-controls .btn {
        display: none;
    }
    
    .brand-text {
        display: none;
    }
    
    .main-content {
        padding: 1rem;
    }
    
    .page-title {
        font-size: 2rem;
    }
    
    .files-header {
        flex-direction: column;
        align-items: stretch;
        gap: 1rem;
    }
    
    .files-actions {
        flex-wrap: wrap;
    }
    
    .filter-row {
        flex-direction: column;
        align-items: stretch;
        gap: 1rem;
    }
    
    .search-container {
        max-width: none;
    }
    
    .sort-controls {
        justify-content: space-between;
    }
    
    .files-grid-view {
        grid-template-columns: 1fr;
    }
    
    .file-list-item {
        grid-template-columns: auto auto 1fr;
        gap: 0.75rem;
    }
    
    .file-list-size,
    .file-list-date {
        display: none;
    }
    
    .files-stats {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
    }
    
    .stats-item {
        justify-content: center;
    }
    
    .modal {
        padding: 1rem;
    }
    
    .modal-panel {
        width: 100%;
        max-width: 100%;
    }
    
    .upload-modal .modal-panel {
        width: 100%;
    }
    
    .notification-container {
        top: 1rem;
        right: 1rem;
        left: 1rem;
        max-width: none;
    }
    
    .fab-container {
        bottom: 1rem;
        right: 1rem;
    }
    
    .qr-scanner-panel {
        padding: 1.5rem;
    }
    
    .instruction-grid {
        grid-template-columns: 1fr;
    }
    
    .subject-stats-detailed {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .summary-stats {
        grid-template-columns: 1fr;
    }
    
    .search-filters-main {
        flex-direction: column;
    }
    
    .search-result-item {
        grid-template-columns: auto 1fr;
        gap: 1rem;
    }
    
    .search-result-actions {
        grid-column: 1 / -1;
        justify-content: flex-start;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid var(--border-primary);
    }
}

@media (max-width: 480px) {
    .loading-title {
        font-size: 2rem;
    }
    
    .loading-subtitle {
        font-size: 1rem;
    }
    
    .page-title {
        font-size: 1.75rem;
    }
    
    .stat-card {
        padding: 1.5rem;
    }
    
    .stat-value {
        font-size: 2rem;
    }
    
    .action-card {
        padding: 1.5rem;
    }
    
    .modal-header {
        padding: 1.5rem 1.5rem 1rem 1.5rem;
    }
    
    .modal-body {
        padding: 1.5rem;
    }
    
    .upload-drop-zone {
        padding: 2rem 1rem;
    }
    
    .files-filters {
        padding: 1.5rem;
    }
    
    .qr-instructions {
        padding: 1.5rem;
    }
    
    .subjects-summary {
        padding: 1.5rem;
    }
}

/* Dark mode specific adjustments */
.dark-theme {
    /* Already defined in root */
}

/* Light theme specific adjustments */
.light-theme .loading-screen {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
}

.light-theme .qr-corner {
    border-color: var(--primary);
}

.light-theme .search-result-title mark,
.light-theme .search-result-description mark {
    background: rgba(102, 126, 234, 0.15);
    color: var(--primary-dark);
}

/* Print Styles */
@media print {
    .nav-header,
    .fab-container,
    .notification-container,
    .modal,
    .loading-screen {
        display: none !important;
    }
    
    .main-content {
        padding: 0;
        max-width: none;
        margin: 0;
    }
    
    .card {
        border: 1px solid #ddd;
        background: white;
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
    }
    
    * {
        color-adjust: exact;
        -webkit-print-color-adjust: exact;
    }
}

/* Performance optimizations */
.card,
.stat-card,
.action-card,
.file-card,
.modal-panel {
    will-change: transform;
}

/* Accessibility improvements */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    :root {
        --glass-bg: rgba(255, 255, 255, 0.15);
        --glass-border: rgba(255, 255, 255, 0.3);
        --border-primary: rgba(255, 255, 255, 0.3);
    }
    
    .light-theme {
        --glass-bg: rgba(0, 0, 0, 0.15);
        --glass-border: rgba(0, 0, 0, 0.3);
        --border-primary: rgba(0, 0, 0, 0.3);
    }
}

/* Focus management for accessibility */
*:focus {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
}

button:focus,
input:focus,
select:focus,
textarea:focus {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
}

/* Smooth scrolling */
html {
    scroll-behavior: smooth;
}

/* Selection styling */
::selection {
    background: rgba(102, 126, 234, 0.2);
    color: var(--text-primary);
}

::-moz-selection {
    background: rgba(102, 126, 234, 0.2);
    color: var(--text-primary);
}

/* Scrollbar styling */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: var(--bg-secondary);
    border-radius: var(--radius-full);
}

::-webkit-scrollbar-thumb {
    background: var(--border-primary);
    border-radius: var(--radius-full);
}

::-webkit-scrollbar-thumb:hover {
    background: var(--text-tertiary);
}

/* Custom animation keyframes */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes pulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.5;
    }
}

@keyframes bounce {
    0%, 20%, 53%, 80%, 100% {
        transform: translate3d(0,0,0);
    }
    40%, 43% {
        transform: translate3d(0, -30px, 0);
    }
    70% {
        transform: translate3d(0, -15px, 0);
    }
    90% {
        transform: translate3d(0, -4px, 0);
    }
}

/* Animation utilities */
.fade-in {
    animation: fadeIn 0.5s ease-out;
}

.slide-in-right {
    animation: slideInRight 0.5s ease-out;
}

.pulse {
    animation: pulse 2s infinite;
}

.bounce {
    animation: bounce 1s;
}
                        // Continue from: link.download = `academic-
                link.download = `academic-hub-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                showNotification('Data exported successfully! üìÅ', 'success');
                trackEvent('data_export', { 
                    file_count: data.files.length,
                    qr_count: data.qrHistory.length,
                    total_size: data.files.reduce((sum, f) => sum + (f.size || 0), 0)
                });
                
            } catch (error) {
                console.error('Export failed:', error);
                showNotification('Export failed: ' + error.message, 'error');
                reportError(error, 'export_error');
            }
        }

        // Advanced Data Import with Validation
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.multiple = false;
            
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                try {
                    showNotification('Processing backup file...', 'info', 2000);
                    
                    const text = await file.text();
                    const data = JSON.parse(text);
                    
                    // Validate backup file structure
                    const validation = validateBackupData(data);
                    if (!validation.valid) {
                        throw new Error(`Invalid backup file: ${validation.error}`);
                    }

                    // Show import confirmation with details
                    const confirmMessage = buildImportConfirmation(data);
                    if (!confirm(confirmMessage)) return;

                    // Perform import
                    await performDataImport(data);
                    
                } catch (error) {
                    console.error('Import failed:', error);
                    showNotification('Import failed: ' + error.message, 'error');
                    reportError(error, 'import_error');
                }
            };
            
            input.click();
        }

        function validateBackupData(data) {
            try {
                // Check version compatibility
                if (!data.version) {
                    return { valid: false, error: 'Missing version information' };
                }

                // Check required fields
                if (!data.files || !Array.isArray(data.files)) {
                    return { valid: false, error: 'Invalid or missing files data' };
                }

                if (!data.subjects || !Array.isArray(data.subjects)) {
                    return { valid: false, error: 'Invalid or missing subjects data' };
                }

                // Validate file structure
                for (const file of data.files) {
                    if (!file.id || !file.name || !file.type) {
                        return { valid: false, error: 'Invalid file structure detected' };
                    }
                }

                // Check app compatibility
                if (data.app && data.app.name !== 'Academic Hub X') {
                    return { valid: false, error: 'Backup is not from Academic Hub X' };
                }

                return { valid: true };
            } catch (error) {
                return { valid: false, error: 'Corrupted backup file' };
            }
        }

        function buildImportConfirmation(data) {
            const fileCount = data.files?.length || 0;
            const qrCount = data.qrHistory?.length || 0;
            const exportDate = new Date(data.exportDate).toLocaleDateString();
            const currentFiles = AppState.files.length;
            const currentQR = qrHistory.length;

            return `Import backup from ${exportDate}?

üìÅ Files: ${fileCount} (current: ${currentFiles})
üì± QR Scans: ${qrCount} (current: ${currentQR})

‚ö†Ô∏è This will replace ALL current data.
Are you sure you want to continue?`;
        }

        async function performDataImport(data) {
            try {
                // Create backup of current data before import
                const currentData = {
                    files: AppState.files,
                    qrHistory: qrHistory,
                    settings: {
                        theme: AppState.theme,
                        filters: currentFilter,
                        sort: currentSort
                    }
                };
                
                sessionStorage.setItem('pre_import_backup', JSON.stringify(currentData));

                // Import data
                AppState.files = data.files || [];
                AppState.subjects = data.subjects || AppState.subjects;
                qrHistory = data.qrHistory || [];

                // Import settings
                if (data.settings) {
                    AppState.theme = data.settings.theme || AppState.theme;
                    currentFilter = data.settings.filters || currentFilter;
                    currentSort = data.settings.sort || currentSort;
                    
                    // Apply theme
                    document.body.className = `${AppState.theme}-theme`;
                    updateThemeToggle();
                }

                // Update localStorage
                localStorage.setItem('ahx_files', JSON.stringify(AppState.files));
                localStorage.setItem('qr_history', JSON.stringify(qrHistory));
                localStorage.setItem('ahx_theme', AppState.theme);

                // Show success message with undo option
                const actions = [
                    {
                        text: 'Undo Import',
                        class: 'btn-secondary',
                        onclick: `undoImport()`
                    }
                ];

                showNotification(`Import successful! ${AppState.files.length} files and ${qrHistory.length} QR scans imported.`, 'success', 8000, actions);
                
                // Re-render current view
                renderView(AppState.currentView);
                
                trackEvent('data_import', { 
                    file_count: AppState.files.length,
                    qr_count: qrHistory.length
                });
                
            } catch (error) {
                throw new Error('Failed to import data: ' + error.message);
            }
        }

        function undoImport() {
            try {
                const backup = sessionStorage.getItem('pre_import_backup');
                if (!backup) {
                    showNotification('No backup available to restore', 'warning');
                    return;
                }

                const data = JSON.parse(backup);
                
                // Restore previous data
                AppState.files = data.files;
                qrHistory = data.qrHistory;
                currentFilter = data.settings.filters;
                currentSort = data.settings.sort;
                AppState.theme = data.settings.theme;

                // Update localStorage
                localStorage.setItem('ahx_files', JSON.stringify(AppState.files));
                localStorage.setItem('qr_history', JSON.stringify(qrHistory));
                localStorage.setItem('ahx_theme', AppState.theme);

                // Apply theme
                document.body.className = `${AppState.theme}-theme`;
                updateThemeToggle();

                // Re-render
                renderView(AppState.currentView);
                
                showNotification('Import undone successfully', 'success');
                sessionStorage.removeItem('pre_import_backup');
                
            } catch (error) {
                showNotification('Failed to undo import', 'error');
            }
        }

        // Batch File Download System
        function batchDownload() {
            if (selectedFiles.size === 0) {
                showNotification('No files selected for download', 'warning');
                return;
            }

            if (selectedFiles.size === 1) {
                // Single file download
                const fileId = Array.from(selectedFiles)[0];
                downloadFile(fileId);
                return;
            }

            // Multiple file download as ZIP
            createZipDownload();
        }

        async function createZipDownload() {
            try {
                showNotification('Creating ZIP archive...', 'info', 3000);
                
                // Dynamic import of ZIP library
                const JSZip = await loadJSZip();
                const zip = new JSZip();

                // Add selected files to ZIP
                let addedFiles = 0;
                for (const fileId of selectedFiles) {
                    const file = AppState.files.find(f => f.id === fileId);
                    if (file && file.dataUrl) {
                        try {
                            // Convert data URL to blob
                            const response = await fetch(file.dataUrl);
                            const blob = await response.blob();
                            
                            // Add to ZIP with organized folder structure
                            const subjectName = getSubjectName(file.subjectKey).replace(/[/\\?%*:|"<>]/g, '-');
                            const folderPath = `${subjectName}/`;
                            zip.file(folderPath + file.name, blob);
                            addedFiles++;
                        } catch (error) {
                            console.warn(`Failed to add ${file.name} to ZIP:`, error);
                        }
                    }
                }

                if (addedFiles === 0) {
                    showNotification('No valid files found for download', 'warning');
                    return;
                }

                // Generate ZIP file
                showNotification(`Generating ZIP with ${addedFiles} files...`, 'info', 5000);
                const zipBlob = await zip.generateAsync({ type: 'blob' });

                // Download ZIP
                const url = URL.createObjectURL(zipBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `academic-files-${new Date().toISOString().split('T')[0]}.zip`;
                link.click();
                URL.revokeObjectURL(url);

                showNotification(`Downloaded ${addedFiles} files as ZIP archive`, 'success');
                trackEvent('batch_download', { file_count: addedFiles });
                
            } catch (error) {
                console.error('ZIP creation failed:', error);
                showNotification('Failed to create ZIP archive', 'error');
                
                // Fallback to individual downloads
                showNotification('Downloading files individually...', 'info');
                for (const fileId of selectedFiles) {
                    downloadFile(fileId);
                    await new Promise(resolve => setTimeout(resolve, 500)); // Delay between downloads
                }
            }
        }

        async function loadJSZip() {
            if (window.JSZip) {
                return window.JSZip;
            }

            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
                script.onload = () => resolve(window.JSZip);
                script.onerror = () => reject(new Error('Failed to load JSZip library'));
                document.head.appendChild(script);
            });
        }

        // Advanced Share Modal System
        function showShareModal(file) {
            const modal = document.createElement('div');
            modal.className = 'modal active share-modal';
            modal.innerHTML = `
                <div class="modal-backdrop" onclick="closeModal()"></div>
                <div class="modal-panel">
                    <div class="modal-header">
                        <h3 class="modal-title">Share File</h3>
                        <p class="modal-subtitle">${sanitizeHTML(file.name)}</p>
                        <button class="btn btn-icon" onclick="closeModal()" title="Close">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="share-options">
                            <div class="share-option" onclick="shareViaEmail('${file.id}')">
                                <div class="share-icon">üìß</div>
                                <div class="share-content">
                                    <h4>Email</h4>
                                    <p>Share via email application</p>
                                </div>
                            </div>
                            
                            <div class="share-option" onclick="copyFileLink('${file.id}')">
                                <div class="share-icon">üîó</div>
                                <div class="share-content">
                                    <h4>Copy Link</h4>
                                    <p>Copy shareable link to clipboard</p>
                                </div>
                            </div>
                            
                            <div class="share-option" onclick="shareToSocialMedia('${file.id}')">
                                <div class="share-icon">üì±</div>
                                <div class="share-content">
                                    <h4>Social Media</h4>
                                    <p>Share on social platforms</p>
                                </div>
                            </div>
                            
                            <div class="share-option" onclick="generateQRCode('${file.id}')">
                                <div class="share-icon">üì±</div>
                                <div class="share-content">
                                    <h4>QR Code</h4>
                                    <p>Generate QR code for file</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function shareViaEmail(fileId) {
            const file = AppState.files.find(f => f.id === fileId);
            if (!file) return;

            const subject = encodeURIComponent(`Academic File: ${file.name}`);
            const body = encodeURIComponent(`Hi,

I'm sharing an academic file with you from Academic Hub X:

File: ${file.name}
Subject: ${getSubjectName(file.subjectKey)}
Size: ${formatBytes(file.size)}
Added: ${formatDate(file.addedAt)}

${file.description ? `Description: ${file.description}` : ''}

Best regards`);

            window.open(`mailto:?subject=${subject}&body=${body}`);
            closeModal();
            trackEvent('file_share', { method: 'email', file_type: file.type });
        }

        function copyFileLink(fileId) {
            const file = AppState.files.find(f => f.id === fileId);
            if (!file) return;

            // Generate shareable link (in real app, this would be a server-generated link)
            const shareableLink = `${window.location.origin}${window.location.pathname}#file=${fileId}`;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(shareableLink).then(() => {
                    showNotification('File link copied to clipboard! üîó', 'success');
                    closeModal();
                    trackEvent('file_share', { method: 'copy_link', file_type: file.type });
                }).catch(() => {
                    fallbackCopyText(shareableLink);
                });
            } else {
                fallbackCopyText(shareableLink);
            }
        }

        function shareToSocialMedia(fileId) {
            const file = AppState.files.find(f => f.id === fileId);
            if (!file) return;

            const text = encodeURIComponent(`Check out this academic file: ${file.name} - ${getSubjectName(file.subjectKey)}`);
            const url = encodeURIComponent(`${window.location.origin}${window.location.pathname}#file=${fileId}`);

            // Show social media options
            const socialModal = document.createElement('div');
            socialModal.className = 'modal active social-modal';
            socialModal.innerHTML = `
                <div class="modal-backdrop" onclick="closeModal()"></div>
                <div class="modal-panel">
                    <div class="modal-header">
                        <h3 class="modal-title">Share on Social Media</h3>
                        <button class="btn btn-icon" onclick="closeModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div class="social-options">
                            <a href="https://twitter.com/intent/tweet?text=${text}&url=${url}" target="_blank" class="social-option">
                                <div class="social-icon">üê¶</div>
                                <span>Twitter</span>
                            </a>
                            <a href="https://www.facebook.com/sharer/sharer.php?u=${url}" target="_blank" class="social-option">
                                <div class="social-icon">üìò</div>
                                <span>Facebook</span>
                            </a>
                            <a href="https://www.linkedin.com/sharing/share-offsite/?url=${url}" target="_blank" class="social-option">
                                <div class="social-icon">üíº</div>
                                <span>LinkedIn</span>
                            </a>
                            <a href="https://wa.me/?text=${text}%20${url}" target="_blank" class="social-option">
                                <div class="social-icon">üí¨</div>
                                <span>WhatsApp</span>
                            </a>
                        </div>
                    </div>
                </div>
            `;
            
            // Replace current modal
            document.querySelector('.share-modal').remove();
            document.body.appendChild(socialModal);
        }

        async function generateQRCode(fileId) {
            const file = AppState.files.find(f => f.id === fileId);
            if (!file) return;

            try {
                // Generate QR code for file link
                const fileLink = `${window.location.origin}${window.location.pathname}#file=${fileId}`;
                const qrCode = await generateQRCodeImage(fileLink);

                const qrModal = document.createElement('div');
                qrModal.className = 'modal active qr-modal';
                qrModal.innerHTML = `
                    <div class="modal-backdrop" onclick="closeModal()"></div>
                    <div class="modal-panel">
                        <div class="modal-header">
                            <h3 class="modal-title">QR Code for ${sanitizeHTML(file.name)}</h3>
                            <button class="btn btn-icon" onclick="closeModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="qr-code-container">
                                <img src="${qrCode}" alt="QR Code" class="qr-code-image">
                                <p>Scan this QR code to access the file</p>
                                <button class="btn btn-secondary" onclick="downloadQRCode('${qrCode}', '${file.name}')">
                                    Download QR Code
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                // Replace current modal
                document.querySelector('.share-modal').remove();
                document.body.appendChild(qrModal);
                
            } catch (error) {
                showNotification('Failed to generate QR code', 'error');
            }
        }

        async function generateQRCodeImage(text) {
            // Using QR code generation library (would need to be included)
            return new Promise((resolve) => {
                // Placeholder QR code generation
                const canvas = document.createElement('canvas');
                canvas.width = 200;
                canvas.height = 200;
                const ctx = canvas.getContext('2d');
                
                // Simple placeholder pattern
                ctx.fillStyle = '#000';
                for (let i = 0; i < 200; i += 10) {
                    for (let j = 0; j < 200; j += 10) {
                        if (Math.random() > 0.5) {
                            ctx.fillRect(i, j, 10, 10);
                        }
                    }
                }
                
                resolve(canvas.toDataURL());
            });
        }

        function downloadQRCode(qrDataUrl, fileName) {
            const link = document.createElement('a');
            link.href = qrDataUrl;
            link.download = `${fileName}-qr-code.png`;
            link.click();
            showNotification('QR code downloaded!', 'success');
        }

        // Advanced File Menu System
        function showFileMenu(fileId, event) {
            event.stopPropagation();
            
            const file = AppState.files.find(f => f.id === fileId);
            if (!file) return;

            // Remove existing menus
            document.querySelectorAll('.file-context-menu').forEach(menu => menu.remove());

            const menu = document.createElement('div');
            menu.className = 'file-context-menu';
            menu.style.cssText = `
                position: fixed;
                top: ${event.clientY}px;
                left: ${event.clientX}px;
                z-index: 10000;
                background: var(--glass-bg);
                backdrop-filter: blur(20px);
                border: 1px solid var(--glass-border);
                border-radius: var(--radius-lg);
                padding: 0.5rem 0;
                box-shadow: var(--shadow-xl);
                min-width: 200px;
            `;

            menu.innerHTML = `
                <div class="menu-item" onclick="openFilePreview('${fileId}'); removeFileMenu()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                    <span>Preview</span>
                </div>
                <div class="menu-item" onclick="downloadFile('${fileId}'); removeFileMenu()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7,10 12,15 17,10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    <span>Download</span>
                </div>
                <div class="menu-item" onclick="shareFile('${fileId}'); removeFileMenu()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="18" cy="5" r="3"></circle>
                        <circle cx="6" cy="12" r="3"></circle>
                        <circle cx="18" cy="19" r="3"></circle>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                    </svg>
                    <span>Share</span>
                </div>
                <div class="menu-item" onclick="editFileDetails('${fileId}'); removeFileMenu()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                    <span>Edit Details</span>
                </div>
                <div class="menu-divider"></div>
                <div class="menu-item danger" onclick="deleteFile('${fileId}'); removeFileMenu()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3,6 5,6 21,6"></polyline>
                        <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                    </svg>
                    <span>Delete</span>
                </div>
            `;

            document.body.appendChild(menu);

            // Position menu to stay within viewport
            const rect = menu.getBoundingClientRect();
            if (rect.right > window.innerWidth) {
                menu.style.left = (event.clientX - rect.width) + 'px';
            }
            if (rect.bottom > window.innerHeight) {
                menu.style.top = (event.clientY - rect.height) + 'px';
            }

            // Close menu on outside click
            setTimeout(() => {
                document.addEventListener('click', removeFileMenu, { once: true });
            }, 100);
        }

        function removeFileMenu() {
            document.querySelectorAll('.file-context-menu').forEach(menu => menu.remove());
        }

        // Edit File Details Modal
        function editFileDetails(fileId) {
            const file = AppState.files.find(f => f.id === fileId);
            if (!file) return;

            const modal = document.createElement('div');
            modal.className = 'modal active edit-file-modal';
            modal.innerHTML = `
                <div class="modal-backdrop" onclick="closeModal()"></div>
                <div class="modal-panel">
                    <div class="modal-header">
                        <h3 class="modal-title">Edit File Details</h3>
                        <button class="btn btn-icon" onclick="closeModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form onsubmit="updateFileDetails('${fileId}', event)">
                            <div class="form-section">
                                <label for="editFileName" class="form-label">File Name</label>
                                <input type="text" id="editFileName" class="form-input" value="${sanitizeHTML(file.name)}" required>
                            </div>
                            
                            <div class="form-section">
                                <label for="editFileSubject" class="form-label">Subject</label>
                                <select id="editFileSubject" class="form-select" required>
                                    ${AppState.subjects.map(subject => `
                                        <option value="${subject.key}" ${file.subjectKey === subject.key ? 'selected' : ''}>
                                            ${subject.icon} ${subject.name}
                                        </option>
                                    `).join('')}
                                </select>
                            </div>
                            
                            <div class="form-section">
                                <label for="editFileDescription" class="form-label">Description</label>
                                <textarea id="editFileDescription" class="form-textarea" rows="4" placeholder="Add a description...">${sanitizeHTML(file.description || '')}</textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function updateFileDetails(fileId, event) {
            event.preventDefault();
            
            const file = AppState.files.find(f => f.id === fileId);
            if (!file) return;

            const newName = document.getElementById('editFileName').value.trim();
            const newSubject = document.getElementById('editFileSubject').value;
            const newDescription = document.getElementById('editFileDescription').value.trim();

            if (!newName) {
                showNotification('File name cannot be empty', 'warning');
                return;
            }

            // Update file details
            file.name = newName;
            file.subjectKey = newSubject;
            file.description = newDescription;
            file.lastModified = Date.now();

            // Save to localStorage
            localStorage.setItem('ahx_files', JSON.stringify(AppState.files));

            closeModal();
            renderView(AppState.currentView);
            showNotification('File details updated successfully', 'success');
            
            trackEvent('file_edit', { file_type: file.type });
        }

        // Advanced Settings Modal
        function showSettingsModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active settings-modal';
            modal.innerHTML = `
                <div class="modal-backdrop" onclick="closeModal()"></div>
                <div class="modal-panel settings-panel">
                    <div class="modal-header">
                        <h3 class="modal-title">Settings</h3>
                        <button class="btn btn-icon" onclick="closeModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div class="settings-sections">
                            <!-- Appearance Settings -->
                            <div class="settings-section">
                                <h4>Appearance</h4>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label class="setting-label">Theme</label>
                                        <p class="setting-description">Choose your preferred color scheme</p>
                                    </div>
                                    <div class="setting-control">
                                        <select id="themeSelect" class="form-select" onchange="changeTheme(this.value)">
                                            <option value="dark" ${AppState.theme === 'dark' ? 'selected' : ''}>Dark</option>
                                            <option value="light" ${AppState.theme === 'light' ? 'selected' : ''}>Light</option>
                                            <option value="auto" ${AppState.theme === 'auto' ? 'selected' : ''}>Auto (System)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Data Settings -->
                            <div class="settings-section">
                                <h4>Data Management</h4>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label class="setting-label">Auto-sync</label>
                                        <p class="setting-description">Automatically sync data when online</p>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="autoSyncToggle" ${getAutoSyncSetting() ? 'checked' : ''} onchange="toggleAutoSync(this.checked)">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label class="setting-label">Storage Usage</label>
                                        <p class="setting-description">${AppState.files.length} files, ${formatBytes(AppState.files.reduce((sum, f) => sum + (f.size || 0), 0))}</p>
                                    </div>
                                    <div class="setting-control">
                                        <button class="btn btn-secondary btn-sm" onclick="clearAllData()">Clear All</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Privacy Settings -->
                            <div class="settings-section">
                                <h4>Privacy</h4>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label class="setting-label">Analytics</label>
                                        <p class="setting-description">Help improve the app by sharing usage data</p>
                                    </div>
                                    <div class="setting-control">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="analyticsToggle" ${getAnalyticsSetting() ? 'checked' : ''} onchange="toggleAnalytics(this.checked)">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- About Section -->
                            <div class="settings-section">
                                <h4>About</h4>
                                <div class="about-info">
                                    <div class="app-info">
                                        <div class="app-icon">S</div>
                                        <div>
                                            <h5>Academic Hub X</h5>
                                            <p>Version 1.0.0</p>
                                        </div>
                                    </div>
                                    <p class="app-description">
                                        Academic Hub X is a comprehensive student portal for SRM Institute of Science and Technology (KTR Campus). 
                                        Manage files, scan QR codes, and organize your academic workflow efficiently.
                                    </p>
                                    <div class="app-links">
                                        <a href="https://github.com/yourusername/academic-hub-x" target="_blank" class="link">GitHub</a>
                                        <a href="mailto:support@academic-hub-x.com" class="link">Support</a>
                                        <a href="#" onclick="showKeyboardShortcuts()" class="link">Keyboard Shortcuts</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function changeTheme(theme) {
            AppState.theme = theme;
            
            if (theme === 'auto') {
                // Use system preference
                const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                document.body.className = `${systemTheme}-theme`;
            } else {
                document.body.className = `${theme}-theme`;
            }
            
            localStorage.setItem('ahx_theme', theme);
            updateThemeToggle();
            trackEvent('theme_changed', { theme: theme });
        }

        function getAutoSyncSetting() {
            return localStorage.getItem('auto_sync') !== 'false';
        }

        function toggleAutoSync(enabled) {
            localStorage.setItem('auto_sync', enabled.toString());
            if (enabled && navigator.onLine) {
                syncPendingData();
            }
        }

        function getAnalyticsSetting() {
            return localStorage.getItem('analytics_enabled') !== 'false';
        }

        function toggleAnalytics(enabled) {
            localStorage.setItem('analytics_enabled', enabled.toString());
            if (enabled) {
                trackEvent('analytics_enabled');
            }
        }

        function clearAllData() {
            if (confirm('This will delete ALL your files and data. This action cannot be undone.\n\nAre you sure you want to continue?')) {
                if (confirm('This is your final warning. ALL DATA WILL BE LOST.\n\nProceed with deletion?')) {
                    // Clear all data
                    AppState.files = [];
                    qrHistory = [];
                    selectedFiles.clear();
                    
                    // Clear localStorage
                    localStorage.removeItem('ahx_files');
                    localStorage.removeItem('qr_history');
                    
                    // Close modal and refresh view
                    closeModal();
                    renderView(AppState.currentView);
                    
                    showNotification('All data cleared successfully', 'success');
                    trackEvent('data_cleared');
                }
            }
        }

        // Keyboard Shortcuts Help Modal
        function showKeyboardShortcuts() {
            const modal = document.createElement('div');
            modal.className = 'modal active shortcuts-modal';
            modal.innerHTML = `
                <div class="modal-backdrop" onclick="closeModal()"></div>
                <div class="modal-panel">
                    <div class="modal-header">
                        <h3 class="modal-title">Keyboard Shortcuts</h3>
                        <button class="btn btn-icon" onclick="closeModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div class="shortcuts-grid">
                            <div class="shortcut-category">
                                <h4>Navigation</h4>
                                <div class="shortcut-item">
                                    <span class="shortcut-keys"><kbd>1</kbd></span>
                                    <span class="shortcut-description">Dashboard</span>
                                </div>
                                <div class="shortcut-item">
                                    <span class="shortcut-keys"><kbd>2</kbd></span>
                                    <span class="shortcut-description">Files</span>
                                </div>
                                <div class="shortcut-item">
                                    <span class="shortcut-keys"><kbd>3</kbd></span>
                                    <span class="shortcut-description">Subjects</span>
                                </div>
                                <div class="shortcut-item">
                                    <span class="shortcut-keys"><kbd>4</kbd></span>
                                    <span class="shortcut-description">Search</span>
                                </div>
                                <div class="shortcut-item">
                                    <span class="shortcut-keys"><kbd>5</kbd></span>
                                    <span class="shortcut-description">QR Scanner</span>
                                </div>
                            </div>

                            <div class="shortcut-category">
                                <h4>Actions</h4>
                                <div class="shortcut-item">
                                    <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>U</kbd></span>
                                    <span class="shortcut-description">Upload Files</span>
                                </div>
                                <div class="shortcut-item">
                                    <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>K</kbd></span>
                                    <span class="shortcut-description">Search</span>
                                </div>
                                <div class="shortcut-item">
                                    <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>A</kbd></span>
                                    <span class="shortcut-description">Select All Files</span>
                                </div>
                                <div class="shortcut-item">
                                    <span class="shortcut-keys"><kbd>Delete</kbd></span>
                                    <span class="shortcut-description">Delete Selected</span>
                                </div>
                                <div class="shortcut-item">
                                    <span class="shortcut-keys"><kbd>Escape</kbd></span>
                                    <span class="shortcut-description">Close/Cancel</span>
                                </div>
                            </div>

                            <div class="shortcut-category">
                                <h4>Interface</h4>
                                <div class="shortcut-item">
                                    <span class="shortcut-keys"><kbd>Alt</kbd> + <kbd>T</kbd></span>
                                    <span class="shortcut-description">Toggle Theme</span>
                                </div>
                                <div class="shortcut-item">
                                    <span class="shortcut-keys"><kbd>F11</kbd></span>
                                    <span class="shortcut-description">Fullscreen</span>
                                </div>
                                <div class="shortcut-item">
                                    <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>,</kbd></span>
                                    <span class="shortcut-description">Settings</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Complete sync functions
        async function syncPendingFileUploads() {
            // Implementation for syncing pending file uploads
            // This would sync with the actual backend when implemented
            console.log('Syncing pending file uploads...');
        }

        async function syncPendingQRScans() {
            // Implementation for syncing pending QR scans
            // This would sync with the actual backend when implemented
            console.log('Syncing pending QR scans...');
        }

        // System auto-theme support
        function setupSystemThemeDetection() {
            if (AppState.theme === 'auto') {
                const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                
                function updateSystemTheme(e) {
                    if (AppState.theme === 'auto') {
                        const systemTheme = e.matches ? 'dark' : 'light';
                        document.body.className = `${systemTheme}-theme`;
                    }
                }
                
                mediaQuery.addListener(updateSystemTheme);
                updateSystemTheme(mediaQuery);
            }
        }

        // Initialize everything when app loads
        function initializeApp() {
            // Initialize theme and system detection
            initializeTheme();
            setupSystemThemeDetection();
            
            // Setup all systems
            setupEventListeners();
            setupDragAndDrop();
            setupPWAFeatures();
            setupAdvancedKeyboardShortcuts();
            setupPerformanceMonitoring();
            setupErrorHandling();
            setupOnlineSync();
            addRippleEffect();
            
            // Load initial data
            AppState.files = JSON.parse(localStorage.getItem('ahx_files') || '[]');
            qrHistory = JSON.parse(localStorage.getItem('qr_history') || '[]');
            AppState.qrScans = qrHistory;
            
            // Handle URL parameters for deep linking
            handleDeepLinking();
            
            // Load initial view
            const hash = window.location.hash.slice(1) || 'dashboard';
            navigateTo(hash.split('=')[0]); // Handle URLs like #file=123
            
            // Hide loading screen
            hideLoadingScreen();
            
            // Track app initialization
            trackEvent('app_initialized', {
                file_count: AppState.files.length,
                qr_count: qrHistory.length,
                theme: AppState.theme
            });
            
            console.log('üéì Academic Hub X initialized successfully!');
        }

        function handleDeepLinking() {
            const hash = window.location.hash.slice(1);
            if (hash.includes('=')) {
                const [action, id] = hash.split('=');
                
                if (action === 'file' && id) {
                    // Deep link to specific file
                    setTimeout(() => {
                        openFilePreview(id);
                    }, 500);
                }
            }
        }

        // Final initialization
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }

        // Export functions for global access (if needed)
        window.AcademicHubX = {
            navigateTo,
            openUploadModal,
            toggleTheme,
            exportData,
            importData,
            trackEvent,
            version: '1.0.0'
        };

    </script>

    <!-- Closing HTML tags -->
    <style>
        /* Additional CSS for new components */
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-lg);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: var(--transition-normal);
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-primary);
        }
        
        .file-context-menu {
            animation: slideIn 0.2s ease;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: var(--transition-fast);
            font-size: 0.9rem;
            color: var(--text-primary);
        }
        
        .menu-item:hover {
            background: var(--glass-bg);
        }
        
        .menu-item.danger {
            color: var(--error);
        }
        
        .menu-item svg {
            width: 16px;
            height: 16px;
        }
        
        .menu-divider {
            height: 1px;
            background: var(--border-primary);
            margin: 0.5rem 0;
        }
        
        .share-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .share-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: var(--transition-normal);
        }
        
        .share-option:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }
        
        .share-icon {
            font-size: 1.5rem;
        }
        
        .share-content h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: var(--text-primary);
        }
        
        .share-content p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin: 0;
        }
        
        .social-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .social-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-lg);
            text-decoration: none;
            color: var(--text-primary);
            transition: var(--transition-normal);
        }
        
        .social-option:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .social-icon {
            font-size: 1.5rem;
        }
        
        .qr-code-container {
            text-align: center;
            padding: 2rem;
        }
        
        .qr-code-image {
            max-width: 200px;
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-lg);
            margin-bottom: 1rem;
        }
        
        .settings-panel {
            width: 600px;
            max-width: 95vw;
        }
        
        .settings-sections {
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .settings-section {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-primary);
        }
        
        .settings-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .settings-section h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-secondary);
        }
        
        .setting-item:last-child {
            border-bottom: none;
        }
        
        .setting-info {
            flex: 1;
            margin-right: 1rem;
        }
        
        .setting-label {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-primary);
            display: block;
            margin-bottom: 0.25rem;
        }
        
        .setting-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin: 0;
        }
        
        .setting-control {
            flex-shrink: 0;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--border-primary);
            border-radius: 24px;
            transition: var(--transition-normal);
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: var(--transition-normal);
        }
        
        input:checked + .toggle-slider {
            background: var(--primary);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        .about-info {
            text-align: center;
        }
        
        .app-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .app-icon {
            width: 60px;
            height: 60px;
            background: var(--gradient-primary);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 800;
            color: white;
        }
        
        .app-info h5 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }
        
        .app-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin: 0;
        }
        
        .app-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 1.5rem;
        }
        
        .app-links {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        
        .link {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            transition: var(--transition-fast);
        }
        
        .link:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .shortcuts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }
        
        .shortcut-category h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }
        
        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
        }
        
        .shortcut-keys {
            display: flex;
            gap: 0.25rem;
        }
        
        .shortcut-keys kbd {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-sm);
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-family: monospace;
            color: var(--text-primary);
        }
        
        .shortcut-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</body>
</html>

        


        /
